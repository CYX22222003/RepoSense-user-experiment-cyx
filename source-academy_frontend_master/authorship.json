[{"path":"src/features/game/action/GameActionConditionChecker.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { GameStateStorage } from \u0027../state/GameStateTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { ActionCondition } from \u0027./GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":" * This class checks for whether if-conditions are satisfied,","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":" * to determine whether or not game actions will be played out.","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"export default class ActionConditionChecker {","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"   * Checks whether all action conditions are met","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"   * @param actionConditions Array of action conditions","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"   * @returns {Promise\u003cboolean\u003e} True if all conditions are met","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"  public static async checkAllConditionsSatisfied(actionConditions: ActionCondition[]) {","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"    const allConditions \u003d await Promise.all(","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"      actionConditions.map(","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"        async actionCondition \u003d\u003e await this.checkConditionSatisfied(actionCondition)","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"      )","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"    return allConditions.every(condition \u003d\u003e condition \u003d\u003d\u003d true);","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"   * Checks whether one action conditions is met","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"   * Also stubs the user state","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"   * @param conditional The action condition","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"   * @returns {boolean} True if condition is met","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  public static async checkConditionSatisfied(conditional: ActionCondition) {","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"    const { state, conditionParams, boolean } \u003d conditional;","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"    switch (state) {","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"      case GameStateStorage.UserState:","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"        return (","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"          (await GameGlobalAPI.getInstance().isInUserState(","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"            conditionParams.userStateType,","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"            conditionParams.id","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"          )) \u003d\u003d\u003d boolean","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"        );","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"      case GameStateStorage.ChecklistState:","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"        return GameGlobalAPI.getInstance().isObjectiveComplete(conditionParams.id) \u003d\u003d\u003d boolean;","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"      case GameStateStorage.TasklistState:","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"        return GameGlobalAPI.getInstance().isTaskComplete(conditionParams.id) \u003d\u003d\u003d boolean;","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"CYX22222003"},"content":"      case GameStateStorage.AttemptedQuizState:","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"CYX22222003"},"content":"        return GameGlobalAPI.getInstance().isQuizAttempted(conditionParams.id) \u003d\u003d\u003d boolean;","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"CYX22222003"},"content":"      case GameStateStorage.PassedQuizState:","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"CYX22222003"},"content":"        return GameGlobalAPI.getInstance().isQuizComplete(conditionParams.id) \u003d\u003d\u003d boolean;","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"CYX22222003"},"content":"      case GameStateStorage.QuizScoreState:","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"CYX22222003"},"content":"        return (","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"CYX22222003"},"content":"          GameGlobalAPI.getInstance().getQuizScore(conditionParams.id) \u003e\u003d","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"            parseInt(conditionParams.score) \u003d\u003d\u003d","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"CYX22222003"},"content":"          boolean","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"CYX22222003"},"content":"        );","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"      default:","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"        return true;","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":10,"-":49}},{"path":"src/features/game/action/GameActionExecuter.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { Layer } from \u0027../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { GamePhaseType } from \u0027../phase/GamePhaseTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import { sleep } from \u0027../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { GameActionType } from \u0027./GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":" * This class executes game actions by calling the right functions","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":" * from global API","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"export default class GameActionExecuter {","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"   * Executes the game action based on given type and parameters","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"   * @param actionType the type of action that will be executed","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"   * @param actionParams an object containing all the parameters","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"  public static async executeGameAction(actionType: GameActionType, actionParams: any) {","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"    const globalAPI \u003d GameGlobalAPI.getInstance();","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"    switch (actionType) {","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"      case GameActionType.AddItem:","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"        globalAPI.addItem(actionParams.gameItemType, actionParams.locationId, actionParams.id);","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"      case GameActionType.RemoveItem:","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"        globalAPI.removeItem(actionParams.gameItemType, actionParams.locationId, actionParams.id);","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"      case GameActionType.AddLocationMode:","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"        globalAPI.addLocationMode(actionParams.locationId, actionParams.mode);","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"      case GameActionType.RemoveLocationMode:","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"        globalAPI.removeLocationMode(actionParams.locationId, actionParams.mode);","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"      case GameActionType.MoveCharacter:","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"        globalAPI.moveCharacter(actionParams.id, actionParams.locationId, actionParams.position);","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"      case GameActionType.UpdateCharacter:","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"        globalAPI.updateCharacter(actionParams.id, actionParams.expression);","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"      case GameActionType.ChangeBackground:","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"        globalAPI.renderBackgroundLayerContainer(actionParams.id);","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"      case GameActionType.StartAnimation:","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"        globalAPI.startAnimation(actionParams.id, actionParams.startFrame, actionParams.frameRate);","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"      case GameActionType.StopAnimation:","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"        globalAPI.stopAnimation(actionParams.id);","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"      case GameActionType.PreviewLocation:","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"        globalAPI.renderBackgroundLayerContainer(actionParams.id);","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"        globalAPI.renderObjectLayerContainer(actionParams.id);","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"        globalAPI.renderBBoxLayerContainer(actionParams.id);","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"      case GameActionType.ObtainCollectible:","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"        globalAPI.obtainCollectible(actionParams.id);","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"      case GameActionType.CompleteObjective:","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"        globalAPI.completeObjective(actionParams.id);","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"      case GameActionType.CompleteTask:","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"        globalAPI.completeTask(actionParams.id);","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"      case GameActionType.ShowTask:","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"        globalAPI.showTask(actionParams.id);","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"      case GameActionType.ShowDialogue:","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"        if (globalAPI.isCurrentPhase(GamePhaseType.Sequence)) {","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"          await globalAPI.showDialogueInSamePhase(actionParams.id);","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"        } else {","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"          await globalAPI.showDialogue(actionParams.id);","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"        }","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"      case GameActionType.AddPopup:","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"        await globalAPI.displayPopUp(","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"          actionParams.id,","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"          actionParams.position,","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"          actionParams.duration,","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"          actionParams.size","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"        );","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"      case GameActionType.MakeObjectBlink:","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"        await globalAPI.makeObjectBlink(actionParams.id, actionParams.turnOn);","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"      case GameActionType.MakeObjectGlow:","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"        await globalAPI.makeObjectGlow(actionParams.id, actionParams.turnOn);","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"      case GameActionType.PlayBGM:","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"        SourceAcademyGame.getInstance().getSoundManager().playBgMusic(actionParams.id);","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"      case GameActionType.PlaySFX:","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"        await SourceAcademyGame.getInstance().getSoundManager().playSound(actionParams.id);","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"      case GameActionType.ShowObjectLayer:","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"        if (actionParams.show) {","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"          globalAPI.showLayer(Layer.Objects);","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"        } else {","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"          globalAPI.hideLayer(Layer.Objects);","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"        }","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"      case GameActionType.NavigateToAssessment:","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"        await globalAPI.promptNavigateToAssessment(actionParams.assessmentId);","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"      case GameActionType.UpdateAssessmentStatus:","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"        await globalAPI.updateAssessmentState();","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"      case GameActionType.Delay:","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"        await sleep(actionParams.duration);","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"CYX22222003"},"content":"      case GameActionType.ShowQuiz:","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"CYX22222003"},"content":"        globalAPI.enableKeyboardInput(false);","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"CYX22222003"},"content":"        await globalAPI.showQuiz(actionParams.id);","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"CYX22222003"},"content":"        globalAPI.enableKeyboardInput(true);","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"CYX22222003"},"content":"        return;","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"      default:","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"   * Determines if action is state change action type","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"   * State-change actions are replayed at the start of every game","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"   * They are actions that modify that game map\u0027s original state","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"   * @param actionType - the type of action","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"  public static isStateChangeAction(actionType: GameActionType) {","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"    switch (actionType) {","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"      case GameActionType.AddItem:","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"      case GameActionType.RemoveItem:","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"      case GameActionType.AddLocationMode:","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"      case GameActionType.RemoveLocationMode:","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"      case GameActionType.MoveCharacter:","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"      case GameActionType.UpdateCharacter:","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"        return true;","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"      case GameActionType.NavigateToAssessment:","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"      case GameActionType.UpdateAssessmentStatus:","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"      case GameActionType.PreviewLocation:","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"      case GameActionType.ChangeBackground:","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"      case GameActionType.StartAnimation:","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"      case GameActionType.StopAnimation:","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"      case GameActionType.ObtainCollectible:","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"      case GameActionType.CompleteObjective:","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"      case GameActionType.CompleteTask:","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"      case GameActionType.ShowTask:","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"      case GameActionType.ShowDialogue:","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"      case GameActionType.AddPopup:","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"      case GameActionType.MakeObjectBlink:","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"-"},"content":"      case GameActionType.MakeObjectGlow:","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"-"},"content":"      case GameActionType.PlayBGM:","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"-"},"content":"      case GameActionType.PlaySFX:","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"-"},"content":"      case GameActionType.ShowObjectLayer:","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"-"},"content":"      case GameActionType.Delay:","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"CYX22222003"},"content":"      case GameActionType.ShowQuiz:","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"-"},"content":"        return false;","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":6,"-":151}},{"path":"src/features/game/action/GameActionTypes.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { ItemId, TrackInteraction } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { GameStateStorage } from \u0027../state/GameStateTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"export enum GameActionType {","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"  MoveCharacter \u003d \u0027MoveCharacter\u0027,","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"  UpdateCharacter \u003d \u0027UpdateCharacter\u0027,","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"  ObtainCollectible \u003d \u0027ObtainCollectible\u0027,","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"  CompleteObjective \u003d \u0027CompleteObjective\u0027,","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"  CompleteTask \u003d \u0027CompleteTask\u0027,","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"  ShowTask \u003d \u0027ShowTask\u0027,","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"  PreviewLocation \u003d \u0027PreviewLocation\u0027,","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"  AddItem \u003d \u0027AddItem\u0027,","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"  RemoveItem \u003d \u0027RemoveItem\u0027,","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"  ShowDialogue \u003d \u0027ShowDialogue\u0027,","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"  ChangeBackground \u003d \u0027ChangeBackground\u0027,","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"  StartAnimation \u003d \u0027StartAnimation\u0027,","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  StopAnimation \u003d \u0027StopAnimation\u0027,","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"  RemoveLocationMode \u003d \u0027RemoveLocationMode\u0027,","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"  AddLocationMode \u003d \u0027AddLocationMode\u0027,","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"  AddPopup \u003d \u0027AddPopup\u0027,","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"  MakeObjectBlink \u003d \u0027MakeObjectBlink\u0027,","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"  MakeObjectGlow \u003d \u0027MakeObjectGlow\u0027,","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"  PlayBGM \u003d \u0027PlayBGM\u0027,","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"  PlaySFX \u003d \u0027PlaySFX\u0027,","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"  ShowObjectLayer \u003d \u0027ShowObjectLayer\u0027,","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"  NavigateToAssessment \u003d \u0027NavigateToAssessment\u0027,","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"  UpdateAssessmentStatus \u003d \u0027UpdateAssessmentStatus\u0027,","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"CYX22222003"},"content":"  Delay \u003d \u0027Delay\u0027,","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"CYX22222003"},"content":"  ShowQuiz \u003d \u0027ShowQuiz\u0027","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":" * Interface for entities which can contain actions, including locations, objects, etc.","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"export interface IGameActionable {","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"  actionIds?: ItemId[];","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":" * Condition object which encapsulates data about an action condition,","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":" * which is the condition that needs to be satisfied before an action","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":" * can be played","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":" * @prop {GameStateStorage} state - the game state which needs to be checked to determine the truthiness of the condition","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":" * @prop {any} conditionParams - an object encapsulating more information about the condition,","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":" *                               such as itemId that needs to be checked for existence to satisfy the condition","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":" * @prop {boolean} boolean - whether the condition needs to match \"true\" or \"false\" before it is satisfied","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"export type ActionCondition \u003d {","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"  state: GameStateStorage;","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  conditionParams: any;","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"  boolean: boolean;","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":" * Action object which encapsulates data about an action,","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":" * that can be performed.","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":" * See Command Pattern/Redux actions.","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":" * @prop {GameActionType} actionType - the type of action that will be performed","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":" * @prop {any} actionParams - an object containing information about the parameters of the action such as which entity ID to perform this action on","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":" * @prop {Array\u003cActionCondition\u003e} actionConditions - a list of conditions that need to be satisfied in order for the action to be executed","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":" * @prop {isRepeatable} boolean - whether or not the action can be performed again when it is triggerd.","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"export type GameAction \u003d TrackInteraction \u0026 {","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"  actionType: GameActionType;","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"  actionParams: any;","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"  actionConditions: ActionCondition[];","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"  isRepeatable: boolean;","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"};","isFullCredit":false}],"authorContributionMap":{"CYX22222003":2,"-":68}},{"path":"src/features/game/dialogue/GameDialogueManager.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import SoundAssets from \u0027../assets/SoundAssets\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { promptWithChoices } from \u0027../effects/Prompt\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import { keyboardShortcuts } from \u0027../input/GameInputConstants\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import GameInputManager from \u0027../input/GameInputManager\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { Layer } from \u0027../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"import { textTypeWriterStyle } from \u0027./GameDialogueConstants\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"import DialogueGenerator from \u0027./GameDialogueGenerator\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"import DialogueRenderer from \u0027./GameDialogueRenderer\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"import DialogueSpeakerRenderer from \u0027./GameDialogueSpeakerRenderer\u0027;","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" * Given a dialogue Id, this manager renders the correct dialogue.","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":" * It displays the lines, speakers, and performs actions","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":" * whenever players click on the dialogue box","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"export default class DialogueManager {","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"  private speakerRenderer?: DialogueSpeakerRenderer;","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"  private dialogueRenderer?: DialogueRenderer;","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"  private dialogueGenerator?: DialogueGenerator;","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"  private gameInputManager?: GameInputManager \u003d new GameInputManager(","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().getGameManager()","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"  );","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"   * @param dialogueId the dialogue Id of the dialogue you want to play","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"   * @returns {Promise} the promise that resolves when the entire dialogue has been played","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  public async showDialogue(dialogueId: ItemId): Promise\u003cvoid\u003e {","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"    const dialogue \u003d GameGlobalAPI.getInstance().getDialogueById(dialogueId);","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"    this.dialogueRenderer \u003d new DialogueRenderer(textTypeWriterStyle);","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"    this.dialogueGenerator \u003d new DialogueGenerator(dialogue.content);","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"    this.speakerRenderer \u003d new DialogueSpeakerRenderer();","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().addToLayer(","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"      Layer.Dialogue,","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"      this.dialogueRenderer.getDialogueContainer()","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().fadeInLayer(Layer.Dialogue);","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"    await new Promise(resolve \u003d\u003e this.playWholeDialogue(resolve as () \u003d\u003e void));","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"    this.getDialogueRenderer().destroy();","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"    this.getSpeakerRenderer().changeSpeakerTo(null);","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"  private async playWholeDialogue(resolve: () \u003d\u003e void) {","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"    await this.showNextLine(resolve);","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"    // add keyboard listener for dialogue box","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"    this.getInputManager().registerKeyboardListener(keyboardShortcuts.Next, \u0027up\u0027, async () \u003d\u003e {","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"      // show the next line if dashboard or escape menu are not displayed","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"      if (","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"        !GameGlobalAPI.getInstance().getGameManager().getPhaseManager().isCurrentPhaseTerminal()","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"      ) {","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"        await this.showNextLine(resolve);","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"    this.getDialogueRenderer()","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"      .getDialogueBox()","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"      .on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP, async () \u003d\u003e {","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"        await this.showNextLine(resolve);","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"      });","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"  public async showNextLine(resolve: () \u003d\u003e void) {","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().playSound(SoundAssets.dialogueAdvance.key);","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"    const { line, speakerDetail, actionIds, prompt } \u003d","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"      await this.getDialogueGenerator().generateNextLine();","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"CYX22222003"},"content":"    const lineWithQuizScores \u003d this.makeLineWithQuizScores(line);","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"CYX22222003"},"content":"    const lineWithName \u003d lineWithQuizScores.replace(\u0027{name}\u0027, this.getUsername());","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"    this.getDialogueRenderer().changeText(lineWithName);","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"    this.getSpeakerRenderer().changeSpeakerTo(speakerDetail);","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"    // Store the current line into the storage","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().storeDialogueLine(lineWithName, speakerDetail);","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"    // Disable interactions while processing actions","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(), false);","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"CYX22222003"},"content":"    this.getInputManager().enableKeyboardInput(false);","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"    if (prompt) {","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"      // disable keyboard input to prevent continue dialogue","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"      this.getInputManager().enableKeyboardInput(false);","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"      const response \u003d await promptWithChoices(","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"        GameGlobalAPI.getInstance().getGameManager(),","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"        prompt.promptTitle,","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"        prompt.choices.map(choice \u003d\u003e choice[0])","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"      );","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"      this.getInputManager().enableKeyboardInput(true);","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"      this.getDialogueGenerator().updateCurrPart(prompt.choices[response][1]);","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"    await GameGlobalAPI.getInstance().processGameActionsInSamePhase(actionIds);","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(), true);","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"CYX22222003"},"content":"    this.getInputManager().enableKeyboardInput(true);","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"    if (!line) {","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"      // clear keyboard listeners when dialogue ends","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"      this.getInputManager().clearKeyboardListeners([keyboardShortcuts.Next]);","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"      resolve();","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"CYX22222003"},"content":"   * Hide all dialogue boxes, speaker boxes and speaker sprites","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"CYX22222003"},"content":"   * */","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"CYX22222003"},"content":"  public async hideAll() {","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"CYX22222003"},"content":"    await this.getDialogueRenderer().hide();","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"CYX22222003"},"content":"    await this.getSpeakerRenderer().hide();","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"CYX22222003"},"content":"   * Make all dialogue boxes, speaker boxes and speaker sprites visible","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"CYX22222003"},"content":"   * */","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"CYX22222003"},"content":"  public async showAll() {","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"CYX22222003"},"content":"    await this.getDialogueRenderer().show();","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"CYX22222003"},"content":"    await this.getSpeakerRenderer().show();","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"CYX22222003"},"content":"   * Find patterns of quiz score interpolation in a dialogue line,","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"CYX22222003"},"content":"   * and replace them by actual scores.","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"CYX22222003"},"content":"   * The pattern: \"{\u003cquizId\u003e.score}\"","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"CYX22222003"},"content":"   * @param line","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"CYX22222003"},"content":"   * @returns {string} the given line with all quiz score interpolation replaced by actual scores.","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"CYX22222003"},"content":"  public makeLineWithQuizScores(line: string) {","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"CYX22222003"},"content":"    const quizScores \u003d line.matchAll(/\\{(.+?)\\.score\\}/g);","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"CYX22222003"},"content":"    for (const match of quizScores) {","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"CYX22222003"},"content":"      line \u003d line.replace(match[0], GameGlobalAPI.getInstance().getQuizScore(match[1]).toString());","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"CYX22222003"},"content":"    return line;","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"  private getDialogueGenerator \u003d () \u003d\u003e this.dialogueGenerator as DialogueGenerator;","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"  private getDialogueRenderer \u003d () \u003d\u003e this.dialogueRenderer as DialogueRenderer;","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"  private getSpeakerRenderer \u003d () \u003d\u003e this.speakerRenderer as DialogueSpeakerRenderer;","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"  private getInputManager \u003d () \u003d\u003e this.gameInputManager as GameInputManager;","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"  public getUsername \u003d () \u003d\u003e SourceAcademyGame.getInstance().getAccountInfo().name;","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":34,"-":112}},{"path":"src/features/game/dialogue/GameDialogueRenderer.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import ImageAssets from \u0027../assets/ImageAssets\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { screenSize } from \u0027../commons/CommonConstants\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { blink, fadeAndDestroy } from \u0027../effects/FadeEffect\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import dialogueConstants from \u0027./GameDialogueConstants\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { createDialogueBox, createTypewriter } from \u0027./GameDialogueHelper\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":" * Class that manages the appearance of the dialogue box, which includes","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":" * the box itself, the text animations as well as the blinking diamond click prompt","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"class DialogueRenderer {","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"  private typewriter: any;","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"  private dialogueBox: Phaser.GameObjects.Image;","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"  private blinkingDiamond: any;","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"   * @param typewriterStyle the style of the typewriter you want to use","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"  constructor(typewriterStyle: Phaser.Types.GameObjects.Text.TextStyle) {","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"    const gameManager \u003d GameGlobalAPI.getInstance().getGameManager();","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"    this.dialogueBox \u003d createDialogueBox(gameManager).setInteractive({","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"      useHandCursor: true,","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"      pixelPerfect: true","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"    this.typewriter \u003d createTypewriter(gameManager, typewriterStyle);","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"    this.blinkingDiamond \u003d this.drawDiamond(gameManager);","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"   * @returns {Phaser.GameObjects.Container} returns the entire dialogueBox container","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"   * which can be added to the scene","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  public getDialogueContainer() {","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"    const gameManager \u003d GameGlobalAPI.getInstance().getGameManager();","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"    const container \u003d new Phaser.GameObjects.Container(gameManager, 0, 0);","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"    container.add([this.dialogueBox, this.blinkingDiamond.container, this.typewriter.container]);","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"    return container;","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"  private drawDiamond(scene: Phaser.Scene) {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"    const diamondSprite \u003d new Phaser.GameObjects.Image(","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"      scene,","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"      screenSize.x - dialogueConstants.prompt.x - dialogueConstants.prompt.xPad,","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"      screenSize.y - dialogueConstants.prompt.y - dialogueConstants.prompt.yPad,","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"      ImageAssets.diamond.key","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"    ).setDisplaySize(dialogueConstants.prompt.x, dialogueConstants.prompt.y);","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"    return { container: diamondSprite, clearBlink: blink(scene, diamondSprite) };","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"   * Obtains the green dialogue box","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"  public getDialogueBox() {","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"    return this.dialogueBox;","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"   * Destroyer for the dialogue box elements and interactivity","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"  public destroy() {","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"    const gameManager \u003d GameGlobalAPI.getInstance().getGameManager();","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"    this.typewriter.clearTyping();","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"    this.blinkingDiamond.clearBlink();","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"    this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP);","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"    fadeAndDestroy(gameManager, this.getDialogueContainer());","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"CYX22222003"},"content":"   * Hide the dialoguebox","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"CYX22222003"},"content":"  public async hide() {","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"CYX22222003"},"content":"    this.typewriter.container.setVisible(false);","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"CYX22222003"},"content":"    this.dialogueBox.setVisible(false);","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"CYX22222003"},"content":"    this.blinkingDiamond.container.setVisible(false);","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"CYX22222003"},"content":"   * Make the dialoguebox visible","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"CYX22222003"},"content":"  public async show() {","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"CYX22222003"},"content":"    this.typewriter.container.setVisible(true);","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"CYX22222003"},"content":"    this.dialogueBox.setVisible(true);","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"CYX22222003"},"content":"    this.blinkingDiamond.container.setVisible(true);","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"   * Change the text written in the box","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"  public changeText(message: string) {","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"    this.typewriter.changeLine(message);","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"export default DialogueRenderer;","isFullCredit":false}],"authorContributionMap":{"CYX22222003":18,"-":78}},{"path":"src/features/game/dialogue/GameDialogueSpeakerRenderer.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import ImageAssets from \u0027../assets/ImageAssets\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { SpeakerDetail } from \u0027../character/GameCharacterTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { screenCenter, screenSize } from \u0027../commons/CommonConstants\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import { GamePosition, ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import { Layer } from \u0027../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import StringUtils from \u0027../utils/StringUtils\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"import { createBitmapText } from \u0027../utils/TextUtils\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"import DialogueConstants, { speakerTextStyle } from \u0027./GameDialogueConstants\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":" * Class that manages speakerbox portion of the dialgoue box","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":" * And renders the characters in Speaker Layer","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"export default class DialogueSpeakerRenderer {","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"  private currentSpeakerId?: string;","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"CYX22222003"},"content":"  private speakerSprite?: Phaser.GameObjects.Image;","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"CYX22222003"},"content":"  private speakerSpriteBox?: Phaser.GameObjects.Container;","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"   * Changes the speaker shown in the speaker box and the speaker rendered on screen","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"   * @param newSpeakerDetail the details about the new speaker,","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"   * including his characaterId, expression and position.","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"   * Undefined - if no speaker changes are involved in the dialogue line.","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"   * Null - if there is no speaker for the line","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  public changeSpeakerTo(newSpeakerDetail?: SpeakerDetail | null) {","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"    if (newSpeakerDetail \u003d\u003d\u003d undefined) return;","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"    if (this.currentSpeakerId) {","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"      GameGlobalAPI.getInstance().clearSeveralLayers([Layer.Speaker, Layer.SpeakerBox]);","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"    this.showNewSpeaker(newSpeakerDetail);","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"  private showNewSpeaker(newSpeakerDetail: SpeakerDetail | null) {","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"    if (newSpeakerDetail) {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"      this.drawSpeakerSprite(newSpeakerDetail);","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"      this.drawSpeakerBox(newSpeakerDetail.speakerId);","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"  private drawSpeakerBox(speakerId: ItemId) {","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"    if (speakerId \u003d\u003d\u003d \u0027narrator\u0027) return;","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"    const speakerContainer \u003d","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"      speakerId \u003d\u003d\u003d \u0027you\u0027","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"        ? this.createSpeakerBox(this.getUsername(), GamePosition.Right)","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"        : this.createSpeakerBox(","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"            GameGlobalAPI.getInstance().getCharacterById(speakerId).name,","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"            GamePosition.Left","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"          );","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().addToLayer(Layer.SpeakerBox, speakerContainer);","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"  private drawSpeakerSprite({ speakerId, speakerPosition, expression }: SpeakerDetail) {","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"    this.currentSpeakerId \u003d speakerId;","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"    if (speakerId \u003d\u003d\u003d \u0027you\u0027 || speakerId \u003d\u003d\u003d \u0027narrator\u0027) {","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"      return;","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"    const speakerSprite \u003d GameGlobalAPI.getInstance().createCharacterSprite(","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"      speakerId,","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"      expression,","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"      speakerPosition","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"    this.speakerSprite \u003d speakerSprite;","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().addToLayer(Layer.Speaker, speakerSprite);","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"  private createSpeakerBox(text: string, position: GamePosition) {","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"    const gameManager \u003d GameGlobalAPI.getInstance().getGameManager();","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"    const container \u003d new Phaser.GameObjects.Container(gameManager, 0, 0);","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"    const rectangle \u003d new Phaser.GameObjects.Image(","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"      gameManager,","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"      screenCenter.x,","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"      screenCenter.y,","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"      ImageAssets.speakerBox.key","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"    ).setAlpha(0.8);","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"    const speakerText \u003d createBitmapText(","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"      gameManager,","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"      \u0027\u0027,","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"      DialogueConstants.speakerTextConfig,","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"      speakerTextStyle","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"    if (position \u003d\u003d\u003d GamePosition.Right) {","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"      rectangle.displayWidth *\u003d -1;","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"      speakerText.x \u003d screenSize.x - speakerText.x;","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"    container.add([rectangle, speakerText]);","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"    speakerText.text \u003d StringUtils.capitalize(text);","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"CYX22222003"},"content":"    this.speakerSpriteBox \u003d container;","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"    return container;","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"CYX22222003"},"content":"   * Hide the speaker box and sprite","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"CYX22222003"},"content":"  public async hide() {","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSprite().setVisible(false);","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSpriteBox().setVisible(false);","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"CYX22222003"},"content":"   * Show the hidden speaker box and sprite","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"CYX22222003"},"content":"  public async show() {","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSprite().setVisible(true);","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSpriteBox().setVisible(true);","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"  public getUsername \u003d () \u003d\u003e SourceAcademyGame.getInstance().getAccountInfo().name;","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"CYX22222003"},"content":"  private getSpeakerSprite \u003d () \u003d\u003e this.speakerSprite as Phaser.GameObjects.Image;","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"CYX22222003"},"content":"  private getSpeakerSpriteBox \u003d () \u003d\u003e this.speakerSpriteBox as Phaser.GameObjects.Container;","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":22,"-":98}},{"path":"src/features/game/layer/GameLayerTypes.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"export enum Layer {","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"  Effects,","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"  Background,","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"  Character,","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"  Speaker,","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"  PopUp,","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"  Dialogue,","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"  SpeakerBox,","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"  UI,","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"  Objects,","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"  BBox,","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"  Escape,","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"  Selector,","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"  Dashboard,","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"CYX22222003"},"content":"  WorkerMessage,","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":"  QuizSpeakerBox,","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"CYX22222003"},"content":"  QuizSpeaker","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"// Back to Front","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"export const defaultLayerSequence \u003d [","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"  Layer.Background,","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"  Layer.Selector,","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"  Layer.Objects,","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"  Layer.BBox,","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"  Layer.Character,","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"  Layer.Speaker,","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"CYX22222003"},"content":"  Layer.QuizSpeaker,","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"  Layer.PopUp,","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"  Layer.Dialogue,","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  Layer.SpeakerBox,","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"CYX22222003"},"content":"  Layer.QuizSpeakerBox,","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  Layer.Effects,","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  Layer.Dashboard,","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  Layer.Escape,","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"  Layer.UI,","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"  Layer.WorkerMessage","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"];","isFullCredit":false}],"authorContributionMap":{"CYX22222003":5,"-":33}},{"path":"src/features/game/location/GameMap.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { GameAction } from \u0027../action/GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { ImageAsset, SoundAsset } from \u0027../assets/AssetsTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { BBoxProperty } from \u0027../boundingBoxes/GameBoundingBoxTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import { Character } from \u0027../character/GameCharacterTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import { AssetKey, ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { Dialogue } from \u0027../dialogue/GameDialogueTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import { GameMode } from \u0027../mode/GameModeTypes\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import { ObjectProperty } from \u0027../objects/GameObjectTypes\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":"import { Quiz } from \u0027../quiz/GameQuizType\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"import { mandatory } from \u0027../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"import { AnyId, GameItemType, GameLocation, LocationId } from \u0027./GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":" * Game map is the class that encapsulates data about","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" * all the locations and items in the map in a checkpoint","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":" * Mainly used by game checkpoint.","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":" * All possible assets should be stored within the soundAssets","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":" * and mapAssets; while mapping from ItemId to other properties","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":" * are stored separately.","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":" * Lastly, the GameLocation should only refer to the ItemIDs,","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":" * and not the actual property.","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":" * GameManager, along other managers, will process this class","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":" * as when as its needed.","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"class GameMap {","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"  private soundAssets: SoundAsset[];","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  private mapAssets: Map\u003cAssetKey, ImageAsset\u003e;","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"  private locations: Map\u003cLocationId, GameLocation\u003e;","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  private dialogues: Map\u003cItemId, Dialogue\u003e;","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  private objects: Map\u003cItemId, ObjectProperty\u003e;","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  private boundingBoxes: Map\u003cItemId, BBoxProperty\u003e;","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"  private characters: Map\u003cItemId, Character\u003e;","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"  private actions: Map\u003cItemId, GameAction\u003e;","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"  private gameStartActions: ItemId[];","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"  private checkpointCompleteActions: ItemId[];","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"CYX22222003"},"content":"  private quizzes: Map\u003cItemId, Quiz\u003e;","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"  constructor() {","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"    this.soundAssets \u003d [];","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"    this.mapAssets \u003d new Map\u003cAssetKey, ImageAsset\u003e();","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"    this.locations \u003d new Map\u003cLocationId, GameLocation\u003e();","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"    this.dialogues \u003d new Map\u003cItemId, Dialogue\u003e();","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"    this.objects \u003d new Map\u003cItemId, ObjectProperty\u003e();","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"    this.boundingBoxes \u003d new Map\u003cItemId, BBoxProperty\u003e();","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"    this.characters \u003d new Map\u003cItemId, Character\u003e();","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"    this.actions \u003d new Map\u003cItemId, GameAction\u003e();","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"    this.quizzes \u003d new Map\u003cItemId, Quiz\u003e();","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"    this.gameStartActions \u003d [];","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"    this.checkpointCompleteActions \u003d [];","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"  public addSoundAsset(soundAsset: SoundAsset) {","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"    this.soundAssets.push(soundAsset);","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"  public addMapAsset(assetKey: AssetKey, imageAsset: ImageAsset) {","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"    this.mapAssets.set(assetKey, imageAsset);","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"  public getMapAssets(): Map\u003cAssetKey, ImageAsset\u003e {","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"    return this.mapAssets;","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"  public addLocation(locationId: LocationId, location: GameLocation): void {","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"    this.locations.set(locationId, location);","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"  public setModesAt(id: LocationId, modes: GameMode[]) {","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"    this.getLocationAtId(id).modes \u003d new Set(modes);","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"  public setNavigationFrom(id: LocationId, navigation: string[]) {","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"    this.getLocationAtId(id).navigation \u003d new Set(navigation);","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"  public getNavigationFrom(id: LocationId): Set\u003cstring\u003e | undefined {","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"    return this.getLocationAtId(id).navigation;","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"  public setGameStartActions(actionIds: ItemId[]) {","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"    this.gameStartActions \u003d actionIds;","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"  public setCheckpointCompleteActions(actionIds: ItemId[]) {","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"    this.checkpointCompleteActions \u003d actionIds;","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"  public getGameStartActions() {","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"    return this.gameStartActions;","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"  public getCheckpointCompleteActions() {","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"    return this.checkpointCompleteActions;","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"  public getLocations(): Map\u003cLocationId, GameLocation\u003e {","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"    return this.locations;","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"  public getObjectPropMap(): Map\u003cItemId, ObjectProperty\u003e {","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"    return this.objects;","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"  public getBBoxPropMap(): Map\u003cItemId, BBoxProperty\u003e {","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"    return this.boundingBoxes;","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"  public getDialogueMap(): Map\u003cItemId, Dialogue\u003e {","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"    return this.dialogues;","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"  public getCharacterMap(): Map\u003cItemId, Character\u003e {","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"    return this.characters;","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"  public getActionMap(): Map\u003cItemId, GameAction\u003e {","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"    return this.actions;","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"CYX22222003"},"content":"  public getQuizMap(): Map\u003cItemId, Quiz\u003e {","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"CYX22222003"},"content":"    return this.quizzes;","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"  public getSoundAssets(): SoundAsset[] {","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"    return this.soundAssets;","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"  public setItemInMap(gameItemType: GameItemType, itemId: string, item: any) {","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"    // @ts-expect-error TS 5.0, violating abstraction of class and object using .set","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"    this[gameItemType].set(itemId, item);","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"  public addItemToLocation(locId: LocationId, gameItemType: GameItemType, itemId: string) {","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"    const location \u003d this.getLocationAtId(locId);","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"    const items \u003d location[gameItemType as keyof typeof location];","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"    (items as Set\u003cany\u003e).add(itemId);","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"  public setBGMusicAt(locId: LocationId, soundKey: AssetKey) {","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"    this.getLocationAtId(locId).bgmKey \u003d soundKey;","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"-"},"content":"  public getLocationAtId \u003d (locId: LocationId) \u003d\u003e","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"-"},"content":"    mandatory(this.locations.get(locId), `Location ${locId} was not found!`);","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"-"},"content":"  public getAssetByKey \u003d (key: AssetKey) \u003d\u003e","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"-"},"content":"    mandatory(this.mapAssets.get(key), `Asset ${key} not found!`);","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"-"},"content":"  public getLocationIds(): LocationId[] {","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"-"},"content":"    return Array.from(this.locations.keys());","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":159,"author":{"gitId":"-"},"content":"  public getAssetKeyFromId(id: AnyId): AssetKey {","isFullCredit":false},{"lineNumber":160,"author":{"gitId":"-"},"content":"    return mandatory(","isFullCredit":false},{"lineNumber":161,"author":{"gitId":"-"},"content":"      this.objects.get(id)?.assetKey || this.locations.get(id)?.assetKey,","isFullCredit":false},{"lineNumber":162,"author":{"gitId":"-"},"content":"      `Id ${id} not found!`","isFullCredit":false},{"lineNumber":163,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":164,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":165,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":166,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":167,"author":{"gitId":"-"},"content":"export default GameMap;","isFullCredit":false}],"authorContributionMap":{"CYX22222003":7,"-":160}},{"path":"src/features/game/location/GameMapTypes.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { IGameActionable } from \u0027../action/GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { AssetKey, ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { GameMode } from \u0027../mode/GameModeTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":" * @typedef {string} LocationId - id that identifies a location","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"export type LocationId \u003d string;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":" * @typedef {LocationId | ItemId} AnyId - a general id type for a location or any object id","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"export type AnyId \u003d LocationId | ItemId;","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":" * @typedef {GameLocation} - encapsulates data about a location in a GameMap","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":" * @prop {ItemId[]} actionIds - ids of all actions that play when that location is visited","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":" * @prop {LocationId} id - the id to indentify that location","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":" * @prop {string} name - the name of the location as shown in the Move Menu","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":" * @prop {AssetKey} assetKey - the asset key for the background image of the location","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":" * @prop {Set\u003cGameMode\u003e} modes - the game modes that are available in the location","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":" * @prop {Set\u003cItemId\u003e} talkTopics - the dialogue id of topics that players can talk about in Talk menu of that location","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":" * @prop {Set\u003cItemId\u003e} objects - the object id of objects rendered in the location","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":" * @prop {Set\u003cItemId\u003e} boundingBoxes - the id of the bounding boxes (invisible rectangles) in that location","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":" * @prop {AssetKey} bgmKey - the asset key of background musicbeing played in that location","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"export type GameLocation \u003d IGameActionable \u0026 {","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  id: LocationId;","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"  name: string;","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"  assetKey: AssetKey;","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  previewKey: AssetKey | null;","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"  modes: Set\u003cGameMode\u003e;","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  navigation: Set\u003cLocationId\u003e;","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  talkTopics: Set\u003cItemId\u003e;","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  objects: Set\u003cItemId\u003e;","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"  boundingBoxes: Set\u003cItemId\u003e;","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"  bgmKey: AssetKey;","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"  characters: Set\u003cItemId\u003e;","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"export enum GameItemType {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"  navigation \u003d \u0027navigation\u0027,","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"  locations \u003d \u0027locations\u0027,","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"  talkTopics \u003d \u0027talkTopics\u0027,","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"  dialogues \u003d \u0027dialogues\u0027,","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"  objects \u003d \u0027objects\u0027,","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"  boundingBoxes \u003d \u0027boundingBoxes\u0027,","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"  characters \u003d \u0027characters\u0027,","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"  actions \u003d \u0027actions\u0027,","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  bgmKey \u003d \u0027bgmKey\u0027,","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"CYX22222003"},"content":"  collectibles \u003d \u0027collectibles\u0027,","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"  quizzes \u003d \u0027quizzes\u0027","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":2,"-":51}},{"path":"src/features/game/parser/ActionParser.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { GameAction, GameActionType } from \u0027../action/GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { GameItemType } from \u0027../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import StringUtils from \u0027../utils/StringUtils\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import ConditionParser from \u0027./ConditionParser\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import Parser from \u0027./Parser\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import ParserConverter from \u0027./ParserConverter\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import { GameEntityType } from \u0027./ParserValidator\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":" * The Action Parser parses actions for all entities.","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":" * This class takes in action strings to produce GameAction objects,","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":" * which store information about action type and","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":" * action params (much like React actions)","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"export default class ActionParser {","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"   * Parses many action strings, stores resulting Game Action objects","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"   * inside the game map, and returns the corresponding actionIds.","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"   * @param fullActionStrings raw action strings, eg [\"show_dialogue(done)\", \"change_location(room) if gamestate.finish\"]","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"   * @returns {Array\u003cItemId\u003e} returns actionIds of the parsed actions with actions are stored in the game map.","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"  public static parseActions(fullActionStrings: string[]): ItemId[] {","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"    return fullActionStrings.map(fullActionString \u003d\u003e this.parseAction(fullActionString));","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"   * Parses an action string, stores resulting Game Action object","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"   * inside the game map, and returns the corresponding actionId.","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"   * @param rawActionString raw action string eg \"show_dialogue(done) if gamestate.finish\"","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"   * @returns {ItemId} returns actionId of the parsed actions, as action is stored in the game map.","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  public static parseAction(rawActionString: string): ItemId {","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"    const [actionString, conditionalsString] \u003d StringUtils.splitByChar(rawActionString, \u0027if\u0027);","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"    const gameAction \u003d this.parseActionContent(actionString);","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"    if (conditionalsString) {","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"      gameAction.actionConditions \u003d StringUtils.splitByChar(conditionalsString, \u0027AND\u0027).map(","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"        condition \u003d\u003e ConditionParser.parse(condition)","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"      );","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"    Parser.checkpoint.map.setItemInMap(GameItemType.actions, gameAction.interactionId, gameAction);","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"    return gameAction.interactionId;","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"   * This funciton converts action strings eg \"show_dialogue(hello)\"","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"   * (excluding conditionals) into Game Action objects","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"   * Note that this function also validates the parameters to make","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"   * sure that they are used correctly.","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"   * @param actionString the action string to be parsed","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"   * @returns {GameAction} resulting action that can be stored in the game map","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"  public static parseActionContent(actionString: string): GameAction {","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"    const [action, actionParamString] \u003d StringUtils.splitByChar(actionString, \u0027(\u0027);","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"    let repeatable \u003d false;","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"    let actionType \u003d action;","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"    if (action[action.length - 1] \u003d\u003d\u003d \u0027*\u0027) {","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"      repeatable \u003d true;","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"      actionType \u003d actionType.slice(0, -1);","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"    const gameActionType \u003d ParserConverter.stringToActionType(actionType);","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"    const actionParams \u003d StringUtils.splitByChar(actionParamString.slice(0, -1), \u0027,\u0027);","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"    const actionParamObj: any \u003d {};","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"    switch (gameActionType) {","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"      case GameActionType.ObtainCollectible:","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"      case GameActionType.CompleteObjective:","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.objectives, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"      case GameActionType.CompleteTask:","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.tasks, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"      case GameActionType.ShowTask:","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.tasks, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"      case GameActionType.PreviewLocation:","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"      case GameActionType.ChangeBackground:","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"      case GameActionType.StartAnimation:","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"        actionParamObj.startFrame \u003d +actionParams[1];","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"        actionParamObj.frameRate \u003d +actionParams[2];","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"        actionParamObj.assetCategory \u003d actionParams[3];","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"        Parser.validator.assertAnimType(actionParams[0], actionType);","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"      case GameActionType.StopAnimation:","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"        Parser.validator.assertAnimType(actionParams[0], actionType);","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"      case GameActionType.ShowDialogue:","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"        Parser.validator.assertItemType(GameItemType.dialogues, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"      case GameActionType.AddItem:","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"      case GameActionType.RemoveItem:","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"        const gameItemType \u003d ParserConverter.stringToGameItemType(actionParams[0]);","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"        actionParamObj.gameItemType \u003d gameItemType;","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"        actionParamObj.locationId \u003d actionParams[1];","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[1], actionType);","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[2];","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"        Parser.validator.assertItemType(gameItemType, actionParams[2], actionType);","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"      case GameActionType.AddLocationMode:","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"      case GameActionType.RemoveLocationMode:","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"        actionParamObj.locationId \u003d actionParams[0];","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"        actionParamObj.mode \u003d ParserConverter.stringToGameMode(actionParams[1]);","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"      case GameActionType.AddPopup:","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"        Parser.validator.assertItemType(GameItemType.objects, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"        actionParamObj.position \u003d ParserConverter.stringToPosition(actionParams[1]);","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"        if (actionParams[2]) {","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"          actionParamObj.duration \u003d parseInt(actionParams[2]) * 1000;","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"        }","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"        if (actionParams[3]) {","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"          actionParamObj.size \u003d ParserConverter.stringToSize(actionParams[3]);","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"        }","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"      case GameActionType.MakeObjectBlink:","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"        Parser.validator.assertItemType(GameItemType.objects, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"-"},"content":"        actionParamObj.turnOn \u003d ParserConverter.stringToBoolean(actionParams[1]);","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"-"},"content":"      case GameActionType.MakeObjectGlow:","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"-"},"content":"        Parser.validator.assertItemType(GameItemType.objects, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"-"},"content":"        actionParamObj.turnOn \u003d ParserConverter.stringToBoolean(actionParams[1]);","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"-"},"content":"      case GameActionType.PlayBGM:","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":159,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.bgms, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":160,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":161,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":162,"author":{"gitId":"-"},"content":"      case GameActionType.PlaySFX:","isFullCredit":false},{"lineNumber":163,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":164,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.sfxs, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":165,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":166,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":167,"author":{"gitId":"-"},"content":"      case GameActionType.ShowObjectLayer:","isFullCredit":false},{"lineNumber":168,"author":{"gitId":"-"},"content":"        actionParamObj.show \u003d ParserConverter.stringToBoolean(actionParams[0]);","isFullCredit":false},{"lineNumber":169,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":170,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":171,"author":{"gitId":"-"},"content":"      case GameActionType.UpdateCharacter:","isFullCredit":false},{"lineNumber":172,"author":{"gitId":"-"},"content":"        Parser.validator.assertItemType(GameItemType.characters, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":173,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":174,"author":{"gitId":"-"},"content":"        actionParamObj.expression \u003d actionParams[1];","isFullCredit":false},{"lineNumber":175,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":176,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":177,"author":{"gitId":"-"},"content":"      case GameActionType.MoveCharacter:","isFullCredit":false},{"lineNumber":178,"author":{"gitId":"-"},"content":"        Parser.validator.assertItemType(GameItemType.characters, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":179,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.locations, actionParams[1], actionType);","isFullCredit":false},{"lineNumber":180,"author":{"gitId":"-"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":181,"author":{"gitId":"-"},"content":"        actionParamObj.locationId \u003d actionParams[1];","isFullCredit":false},{"lineNumber":182,"author":{"gitId":"-"},"content":"        actionParamObj.position \u003d ParserConverter.stringToPosition(actionParams[2]);","isFullCredit":false},{"lineNumber":183,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":184,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":185,"author":{"gitId":"-"},"content":"      case GameActionType.NavigateToAssessment:","isFullCredit":false},{"lineNumber":186,"author":{"gitId":"-"},"content":"        actionParamObj.assessmentId \u003d actionParams[0];","isFullCredit":false},{"lineNumber":187,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":188,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":189,"author":{"gitId":"-"},"content":"      case GameActionType.Delay:","isFullCredit":false},{"lineNumber":190,"author":{"gitId":"-"},"content":"        actionParamObj.duration \u003d parseInt(actionParams[0]) * 1000;","isFullCredit":false},{"lineNumber":191,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":192,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":193,"author":{"gitId":"CYX22222003"},"content":"      case GameActionType.ShowQuiz:","isFullCredit":false},{"lineNumber":194,"author":{"gitId":"CYX22222003"},"content":"        actionParamObj.id \u003d actionParams[0];","isFullCredit":false},{"lineNumber":195,"author":{"gitId":"CYX22222003"},"content":"        Parser.validator.assertItemType(GameItemType.quizzes, actionParams[0], actionType);","isFullCredit":false},{"lineNumber":196,"author":{"gitId":"CYX22222003"},"content":"        break;","isFullCredit":false},{"lineNumber":197,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":198,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":199,"author":{"gitId":"-"},"content":"    const actionId \u003d Parser.generateActionId();","isFullCredit":false},{"lineNumber":200,"author":{"gitId":"-"},"content":"    return {","isFullCredit":false},{"lineNumber":201,"author":{"gitId":"-"},"content":"      actionType: gameActionType,","isFullCredit":false},{"lineNumber":202,"author":{"gitId":"-"},"content":"      actionParams: actionParamObj,","isFullCredit":false},{"lineNumber":203,"author":{"gitId":"-"},"content":"      actionConditions: [],","isFullCredit":false},{"lineNumber":204,"author":{"gitId":"-"},"content":"      interactionId: actionId,","isFullCredit":false},{"lineNumber":205,"author":{"gitId":"-"},"content":"      isInteractive: false,","isFullCredit":false},{"lineNumber":206,"author":{"gitId":"-"},"content":"      isRepeatable: repeatable","isFullCredit":false},{"lineNumber":207,"author":{"gitId":"-"},"content":"    };","isFullCredit":false},{"lineNumber":208,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":209,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":5,"-":204}},{"path":"src/features/game/parser/ConditionParser.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { ActionCondition } from \u0027../action/GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"CYX22222003"},"content":"import { GameItemType } from \u0027../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { GameStateStorage } from \u0027../state/GameStateTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import StringUtils from \u0027../utils/StringUtils\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import Parser from \u0027./Parser\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import ParserConverter from \u0027./ParserConverter\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import { GameEntityType } from \u0027./ParserValidator\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":" * This parser is in charge of parsing conditionals","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"export default class ConditionParser {","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"   * This function creates an ActionCondition object, given a condition string","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"   * @param conditionDetails A conditional string such as \"!if userstate.assessments.301\"","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"   * @returns {ActionCondition} encapsulating the information on the conditional","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"  public static parse(conditionDetails: string): ActionCondition {","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"    const hasExclamation \u003d conditionDetails[0] \u003d\u003d\u003d \u0027!\u0027;","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"    if (hasExclamation) {","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"      conditionDetails \u003d conditionDetails.slice(1);","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"    const [gameStateStorage, ...condParams] \u003d StringUtils.splitByChar(conditionDetails, \u0027.\u0027);","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"    switch (ParserConverter.stringToGameStateStorage(gameStateStorage)) {","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"      case GameStateStorage.ChecklistState:","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.objectives, condParams[0]);","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"        return {","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"          state: GameStateStorage.ChecklistState,","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"          conditionParams: {","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"            id: condParams[0]","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"          },","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"          boolean: !hasExclamation","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"        };","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"      case GameStateStorage.TasklistState:","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.tasks, condParams[0]);","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"        return {","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"          state: GameStateStorage.TasklistState,","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"          conditionParams: {","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"            id: condParams[0]","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"          },","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"          boolean: !hasExclamation","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"        };","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"      case GameStateStorage.UserState:","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"        return {","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"          state: GameStateStorage.UserState,","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"          conditionParams: {","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"            userStateType: ParserConverter.stringToUserStateType(condParams[0]),","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"            id: condParams[1]","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"          },","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"          boolean: !hasExclamation","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"        };","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"CYX22222003"},"content":"      case GameStateStorage.AttemptedQuizState:","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"CYX22222003"},"content":"        Parser.validator.assertItemType(GameItemType.quizzes, condParams[0]);","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"CYX22222003"},"content":"        return {","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"CYX22222003"},"content":"          state: GameStateStorage.AttemptedQuizState,","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"CYX22222003"},"content":"          conditionParams: {","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"CYX22222003"},"content":"            id: condParams[0]","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"CYX22222003"},"content":"          },","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"CYX22222003"},"content":"          boolean: !hasExclamation","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"CYX22222003"},"content":"        };","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"CYX22222003"},"content":"      case GameStateStorage.PassedQuizState:","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"CYX22222003"},"content":"        Parser.validator.assertItemType(GameItemType.quizzes, condParams[0]);","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"CYX22222003"},"content":"        return {","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"          state: GameStateStorage.PassedQuizState,","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"CYX22222003"},"content":"          conditionParams: {","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"CYX22222003"},"content":"            id: condParams[0]","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"CYX22222003"},"content":"          },","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"CYX22222003"},"content":"          boolean: !hasExclamation","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"CYX22222003"},"content":"        };","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"CYX22222003"},"content":"      case GameStateStorage.QuizScoreState:","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"CYX22222003"},"content":"        Parser.validator.assertItemType(GameItemType.quizzes, condParams[0]);","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"CYX22222003"},"content":"        if (Number.isNaN(parseInt(condParams[1]))) {","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"CYX22222003"},"content":"          throw new Error(\u0027Parsing error: quiz score condition requires number as second param\u0027);","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"CYX22222003"},"content":"        }","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"CYX22222003"},"content":"        return {","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"CYX22222003"},"content":"          state: GameStateStorage.QuizScoreState,","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"CYX22222003"},"content":"          conditionParams: {","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"CYX22222003"},"content":"            id: condParams[0],","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"CYX22222003"},"content":"            score: condParams[1]","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"CYX22222003"},"content":"          },","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"CYX22222003"},"content":"          boolean: !hasExclamation","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"CYX22222003"},"content":"        };","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"      default:","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"        throw new Error(\u0027Parsing error: Invalid condition param\u0027);","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":36,"-":58}},{"path":"src/features/game/parser/DialogueParser.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"CYX22222003"},"content":"import { Dialogue, DialogueLine, DialogueObject, PartName } from \u0027../dialogue/GameDialogueTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { GameItemType } from \u0027../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { mapValues } from \u0027../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import StringUtils from \u0027../utils/StringUtils\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import ActionParser from \u0027./ActionParser\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import ConditionParser from \u0027./ConditionParser\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import Parser from \u0027./Parser\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import PromptParser from \u0027./PromptParser\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"import SpeakerParser from \u0027./SpeakerParser\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":" * This class parses dialogues and creates","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":" * Dialogue Objects which can be read by the","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":" * Dialogue Generator","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"export default class DialogueParser {","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"   * This function reads the entire text under the \"dialogue\" heading,","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"   * converts dialogues listed underneath into Dialogue entities,","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"   * and stores these dialogues in the game map.","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"   * @param dialogueText the entire dialogue text beneath Dialogue","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"  public static parse(dialogueText: string[]) {","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"    const dialoguesParagraphs \u003d StringUtils.splitToParagraph(dialogueText);","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"    dialoguesParagraphs.forEach(([dialogueDetails, dialogueBody]: [string, string[]]) \u003d\u003e {","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"      if (dialogueBody.length \u003d\u003d\u003d 0) {","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"        console.error(\u0027No dialogue found for dialogueId\u0027);","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"        return;","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"      this.parseDialogue(dialogueDetails, dialogueBody);","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"   * This function parses one dialogue and stores it into the game map","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"   * @param dialogueDetails the string containing dialogue Id and/or dialouge title","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"   * @param dialogueBody the body of the dialogue containing its contents","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"  private static parseDialogue(dialogueDetails: string, dialogueBody: string[]) {","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"    const [dialogueId, title] \u003d StringUtils.splitWithLimit(dialogueDetails, \u0027,\u0027, 1);","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"    Parser.validator.registerId(dialogueId);","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"    const content \u003d this.parseDialogueContent(dialogueBody);","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"    const dialogue: Dialogue \u003d { title, content };","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"    // Add fallback title","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"    if (!dialogue.title) {","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"      dialogue.title \u003d StringUtils.toCapitalizedWords(dialogueId);","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"    Parser.checkpoint.map.setItemInMap(GameItemType.dialogues, dialogueId, dialogue);","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"   * This function parses the dialogue\u0027s body and","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"   * converts each into a Dialogue object.","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"   * This function\u0027s main task is to separate a dialogue into","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"   * parts (or part if just one), and then uses  createDialogueLines to parse each part.","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"   * @param dialogueBody The entire dialogue body","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"  private static parseDialogueContent(dialogueBody: string[]) {","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"    const rawDialogueContent: Map\u003cPartName, string[]\u003e \u003d StringUtils.mapByHeader(","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"      dialogueBody,","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"      isInteger","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"    const dialogueObject: Map\u003cPartName, DialogueLine[]\u003e \u003d mapValues(","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"      rawDialogueContent,","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"      this.createDialogueLines","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"    return dialogueObject;","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"   * This function parses one \"part\" of a dialogue,","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"   * and converts them into a series of DialogueLine\u0027s,","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"   * where DialogueLine encapsulates data on the text,","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"   * (as well as speaker change, actions, gotos and prompts if any)","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"   * @param {Array\u003cstring\u003e} lines the lines inside one part of a dialogue","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"   * @returns {Array\u003cDialogueLine\u003e}","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"  private static createDialogueLines(lines: string[]): DialogueLine[] {","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"    const dialogueLines: DialogueLine[] \u003d [];","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"    let currIndex \u003d 0;","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"    while (currIndex !\u003d\u003d lines.length) {","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"      const rawStr \u003d lines[currIndex];","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"      switch (true) {","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"        case isGotoLabel(rawStr):","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"          const [gotoString, postpend] \u003d StringUtils.splitByChar(rawStr, \u0027if\u0027);","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"          const [conditionalsString, altPart] \u003d postpend","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"            ? StringUtils.splitByChar(postpend, \u0027else\u0027)","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"            : [null, null];","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"          const conditions \u003d conditionalsString","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"            ? StringUtils.splitByChar(conditionalsString, \u0027AND\u0027).map(condition \u003d\u003e","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"                ConditionParser.parse(condition)","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"              )","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"            : [];","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"          dialogueLines[dialogueLines.length - 1].goto \u003d {","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"            conditions,","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"            part: gotoString.split(\u0027 \u0027)[1],","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"            altPart: altPart","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"          };","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"          break;","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"        case isPrompt(rawStr):","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"          const rawTitle \u003d rawStr;","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"          const rawChoices: string[] \u003d [];","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"          while (lines[currIndex + 1] \u0026\u0026 isPromptChoice(lines[currIndex + 1])) {","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"            currIndex++;","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"            rawChoices.push(lines[currIndex].trim());","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"          }","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"          const prompt \u003d PromptParser.parsePrompt(rawTitle, rawChoices);","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"          dialogueLines[dialogueLines.length - 1].prompt \u003d prompt;","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"          break;","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"        case isActionLabel(rawStr):","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"          const lastLine \u003d dialogueLines[dialogueLines.length - 1];","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"          if (!lastLine.actionIds) {","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"            lastLine.actionIds \u003d [];","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"          }","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"          lastLine.actionIds.push(ActionParser.parseAction(rawStr));","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"          break;","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"        case isSpeaker(rawStr):","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"          currIndex++;","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"          const nextLine \u003d lines[currIndex];","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"          if (!nextLine) {","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"            throw new Error(\u0027Parsing error: Cannot change speaker without next line\u0027);","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"          }","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"          dialogueLines.push({ line: nextLine });","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"          dialogueLines[dialogueLines.length - 1].speakerDetail \u003d SpeakerParser.parse(rawStr);","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"          break;","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"        default:","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"          // Dialogue lines without speaker are by default treated as lines by narrator","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"          // This also ensures that lines without speaker are displayed on the dialogue log","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"          dialogueLines.push({ line: rawStr });","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"          dialogueLines[dialogueLines.length - 1].speakerDetail \u003d SpeakerParser.parse(\u0027@narrator\u0027);","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"          break;","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"      currIndex++;","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"    return dialogueLines;","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"CYX22222003"},"content":"   * This function parses a diaglogue written in a quiz as reaction","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"CYX22222003"},"content":"   * and returns a DialogueObject.","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"CYX22222003"},"content":"   * Itis only called by the QuizParser.","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"CYX22222003"},"content":"   * @param {Array\u003cstring\u003e} dialogueBody the lines inside a dialogue","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"CYX22222003"},"content":"  public static parseQuizReaction(dialogueBody: string[]): DialogueObject {","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"CYX22222003"},"content":"    return this.parseDialogueContent(dialogueBody);","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":159,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":160,"author":{"gitId":"-"},"content":"const isInteger \u003d (line: string) \u003d\u003e new RegExp(/^[0-9]+$/).test(line);","isFullCredit":false},{"lineNumber":161,"author":{"gitId":"-"},"content":"const isGotoLabel \u003d (line: string) \u003d\u003e new RegExp(/^goto [0-9]+.*$/).test(line);","isFullCredit":false},{"lineNumber":162,"author":{"gitId":"-"},"content":"const isActionLabel \u003d (line: string) \u003d\u003e line \u0026\u0026 (line[0] \u003d\u003d\u003d \u0027\\t\u0027 || line.slice(0, 4) \u003d\u003d\u003d \u0027    \u0027);","isFullCredit":false},{"lineNumber":163,"author":{"gitId":"-"},"content":"const isSpeaker \u003d (line: string) \u003d\u003e line \u0026\u0026 line[0] \u003d\u003d\u003d \u0027@\u0027;","isFullCredit":false},{"lineNumber":164,"author":{"gitId":"-"},"content":"const isPrompt \u003d (line: string) \u003d\u003e line.trim().startsWith(\u0027prompt:\u0027);","isFullCredit":false},{"lineNumber":165,"author":{"gitId":"-"},"content":"const isPromptChoice \u003d (line: string) \u003d\u003e new RegExp(/-\u003e +goto/).test(line);","isFullCredit":false}],"authorContributionMap":{"CYX22222003":11,"-":154}},{"path":"src/features/game/parser/Parser.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { GameCheckpoint } from \u0027../chapter/GameChapterTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import GameMap from \u0027../location/GameMap\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import GameObjective from \u0027../objective/GameObjective\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import GameTask from \u0027../task/GameTask\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import StringUtils from \u0027../utils/StringUtils\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import ActionParser from \u0027./ActionParser\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import DialoguesParser from \u0027./DialogueParser\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import LocationsParser from \u0027./LocationDetailsParser\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"import LocationParser from \u0027./LocationParser\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"import ParserValidator, { GameEntityType } from \u0027./ParserValidator\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"CYX22222003"},"content":"import QuizParser from \u0027./QuizParser\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"import TasksParser from \u0027./TasksParser\u0027;","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" * This class converts a checkpoint txt file into a Checkpoint","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":" * object.","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":" * A Checkpoint object encapsulates data about the map including all","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":" * the locations inside it, as well as the objectives in that checkpoint,","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":" * basically everything the game engine needs to know to render","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":" * the entire checkpoint for players to play.","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"class Parser {","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"  public static checkpoint: GameCheckpoint;","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"  private static actionIdNum: number;","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"  public static validator: ParserValidator;","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"  public static generateActionId() {","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"    Parser.actionIdNum++;","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"    return `action#${Parser.actionIdNum}`;","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  public static init() {","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"    Parser.actionIdNum \u003d 0;","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"    Parser.checkpoint \u003d {","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"      map: new GameMap(),","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"      startingLoc: \u0027\u0027,","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"      objectives: new GameObjective(),","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"      tasks: new GameTask()","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"    };","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"    Parser.validator \u003d new ParserValidator();","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"  public static parse(chapterText: string, continueParse \u003d false) {","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"    if (!continueParse) {","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"      Parser.init();","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"    const checkPointLines \u003d StringUtils.splitToLinesAndRemoveComments(chapterText);","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"    const checkPointParagraphs \u003d StringUtils.splitToParagraph(checkPointLines);","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"    checkPointParagraphs.forEach(([header, body]: [string, string[]]) \u003d\u003e {","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"      if (body.length \u003d\u003d\u003d 0 \u0026\u0026 header.includes(\u0027:\u0027)) {","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"        Parser.parseCheckpointConfig(header);","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"      } else {","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"        // eslint-disable-next-line @typescript-eslint/no-unused-expressions","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"        Parser.parseCheckpointParagraphs(header, body) || LocationParser.parse(header, body);","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"    Parser.validator.verifyAssertions();","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"  private static parseCheckpointConfig(checkpointConfig: string) {","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"    const [key, value] \u003d StringUtils.splitByChar(checkpointConfig, \u0027:\u0027);","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"    switch (key) {","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"      case \u0027startingLoc\u0027:","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"        Parser.validator.assertEntityType(GameEntityType.locations, value);","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"        Parser.checkpoint.startingLoc \u003d value;","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"      default:","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"        throw new Error(`Invalid checkpoint config key, \"${checkpointConfig}\"`);","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"  private static parseCheckpointParagraphs(header: string, body: string[]) {","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"    switch (header) {","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"      case \u0027objectives\u0027:","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"        Parser.checkpoint.objectives.addObjectives(body);","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"      case \u0027tasks\u0027:","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"        TasksParser.parse(body);","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"      case \u0027locations\u0027:","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"        LocationsParser.parse(body);","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"      case \u0027gameStartActions\u0027:","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"        Parser.checkpoint.map.setGameStartActions(ActionParser.parseActions(body));","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"      case \u0027checkpointCompleteActions\u0027:","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"        Parser.checkpoint.map.setCheckpointCompleteActions(ActionParser.parseActions(body));","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"      case \u0027dialogues\u0027:","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"        DialoguesParser.parse(body);","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"CYX22222003"},"content":"      case \u0027quizzes\u0027:","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"CYX22222003"},"content":"        QuizParser.parse(body);","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"CYX22222003"},"content":"        break;","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"      default:","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"        return false;","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"    return true;","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"export default Parser;","isFullCredit":false}],"authorContributionMap":{"CYX22222003":4,"-":105}},{"path":"src/features/game/parser/ParserConverter.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { GameActionType } from \u0027../action/GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { GamePosition, GameSize } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { GameItemType } from \u0027../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import { GameMode } from \u0027../mode/GameModeTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import { GameStateStorage, UserStateType } from \u0027../state/GameStateTypes\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { mandatory } from \u0027../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"const stringToSizeMap \u003d {","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"  small: GameSize.Small,","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"  medium: GameSize.Medium,","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"  large: GameSize.Large","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"const stringToPositionMap \u003d {","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"  left: GamePosition.Left,","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"  middle: GamePosition.Middle,","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  right: GamePosition.Right","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"const stringToGameModeMap \u003d {","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"  talk: GameMode.Talk,","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"  explore: GameMode.Explore,","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"  move: GameMode.Move,","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"  menu: GameMode.Menu","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"const stringToGameItemMap \u003d {","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  navigation: GameItemType.navigation,","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"  talkTopics: GameItemType.talkTopics,","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"  objects: GameItemType.objects,","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  boundingBoxes: GameItemType.boundingBoxes,","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"  characters: GameItemType.characters,","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  actions: GameItemType.actions,","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  bgmKey: GameItemType.bgmKey,","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  collectibles: GameItemType.collectibles","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"const stringToActionTypeMap \u003d {","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"  move_character: GameActionType.MoveCharacter,","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"  update_character: GameActionType.UpdateCharacter,","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"  obtain_collectible: GameActionType.ObtainCollectible,","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"  complete_objective: GameActionType.CompleteObjective,","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"  complete_task: GameActionType.CompleteTask,","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"  show_task: GameActionType.ShowTask,","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"  add_item: GameActionType.AddItem,","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"  remove_item: GameActionType.RemoveItem,","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"  change_background: GameActionType.ChangeBackground,","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"  start_animation: GameActionType.StartAnimation,","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"  stop_animation: GameActionType.StopAnimation,","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  show_dialogue: GameActionType.ShowDialogue,","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"  add_mode: GameActionType.AddLocationMode,","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"  remove_mode: GameActionType.RemoveLocationMode,","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"  add_popup: GameActionType.AddPopup,","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"  make_object_glow: GameActionType.MakeObjectGlow,","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"  make_object_blink: GameActionType.MakeObjectBlink,","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"  play_bgm: GameActionType.PlayBGM,","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"  play_sfx: GameActionType.PlaySFX,","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"  preview_location: GameActionType.PreviewLocation,","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"  show_object_layer: GameActionType.ShowObjectLayer,","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"  navigate_to_assessment: GameActionType.NavigateToAssessment,","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"  update_assessment_status: GameActionType.UpdateAssessmentStatus,","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"CYX22222003"},"content":"  delay: GameActionType.Delay,","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"CYX22222003"},"content":"  show_quiz: GameActionType.ShowQuiz","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"const stringToGameStateStorageMap \u003d {","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"  checklist: GameStateStorage.ChecklistState,","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"  tasklist: GameStateStorage.TasklistState,","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"  userstate: GameStateStorage.UserState,","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"CYX22222003"},"content":"  attemptedQuiz: GameStateStorage.AttemptedQuizState,","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"CYX22222003"},"content":"  passedQuiz: GameStateStorage.PassedQuizState,","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"CYX22222003"},"content":"  quizScore: GameStateStorage.QuizScoreState","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"const stringToUserStateTypeMap \u003d {","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"  assessments: UserStateType.assessments,","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"  achievements: UserStateType.achievements,","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"  collectibles: UserStateType.collectibles","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":" * This class is in charge of converting strings from","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":" * the txt into enums that can be stored in the Checkpoint","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":" * object, which can be read and played by the game engine.","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":" * This also acts as a validity checker to ensure that","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":" * strings such as action types (eg \u0027show_dialogue\u0027) and","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":" * game modes (eg \u0027explore\u0027) are actually valid enums","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":" * TODO: Investigate if the typing can be improved","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"export default class ParserConverter {","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"  public static stringToSize(str: string) {","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"    return stringToSizeMap[str as keyof typeof stringToSizeMap] || GameSize.Medium;","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"  public static stringToPosition(str: string) {","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"    return stringToPositionMap[str as keyof typeof stringToPositionMap] || GamePosition.Middle;","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"  public static stringToGameMode(str: string) {","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"    return mandatory(","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"      stringToGameModeMap[str as keyof typeof stringToGameModeMap],","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"      `Invalid location mode, ${str}`","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"  public static stringToActionType(str: string) {","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"    return mandatory(","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"      stringToActionTypeMap[str as keyof typeof stringToActionTypeMap],","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"      `Invalid action type, ${str}`","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"  public static stringToGameStateStorage(str: string) {","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"    return mandatory(","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"      stringToGameStateStorageMap[str as keyof typeof stringToGameStateStorageMap],","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"      `Invalid condition type, ${str}`","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"  public static stringToGameItemType(str: string) {","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"    return mandatory(","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"      stringToGameItemMap[str as keyof typeof stringToGameItemMap],","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"      `Invalid entity type, ${str}`","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"  public static stringToBoolean(str: string) {","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"    return str \u003d\u003d\u003d \u0027false\u0027 ? false : true;","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"  public static stringToUserStateType(str: string) {","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"    return mandatory(","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"      stringToUserStateTypeMap[str as keyof typeof stringToUserStateTypeMap],","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"      `Invalid user state type ${str}`","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":6,"-":133}},{"path":"src/features/game/parser/QuizParser.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"CYX22222003"},"content":"import { GameItemType } from \u0027../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"CYX22222003"},"content":"import { Option, Question, Quiz } from \u0027../quiz/GameQuizType\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"CYX22222003"},"content":"import StringUtils from \u0027../utils/StringUtils\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"CYX22222003"},"content":"import DialogueParser from \u0027./DialogueParser\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"CYX22222003"},"content":"import Parser from \u0027./Parser\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"CYX22222003"},"content":"import SpeakerParser from \u0027./SpeakerParser\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"CYX22222003"},"content":"/**","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":" * This class parses quizzes and creates Quiz Objects","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"CYX22222003"},"content":" * which can be read by the Quiz Manager.","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"CYX22222003"},"content":" */","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"CYX22222003"},"content":"export default class QuizParser {","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"CYX22222003"},"content":"   * This function reads the entire text under the \"quizzes\" heading,","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"CYX22222003"},"content":"   * converts quizzes listed underneath into Quiz entities,","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":"   * and stores these quizzes in the game map.","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"CYX22222003"},"content":"   * @param quizText the entire quiz text beneath quizzes heading","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"CYX22222003"},"content":"  public static parse(quizText: string[]) {","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"CYX22222003"},"content":"    const quizParagraphs \u003d StringUtils.splitToParagraph(quizText);","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"CYX22222003"},"content":"    quizParagraphs.forEach(([quizId, quizBody]: [string, string[]]) \u003d\u003e {","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"CYX22222003"},"content":"      if (quizBody.length \u003d\u003d\u003d 0) {","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"CYX22222003"},"content":"        throw new Error(\u0027Parsing error: No quiz content found for quizId\u0027);","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"CYX22222003"},"content":"        return;","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"CYX22222003"},"content":"      }","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"CYX22222003"},"content":"      this.parseQuiz(quizId, quizBody);","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"CYX22222003"},"content":"    });","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"CYX22222003"},"content":"   * This function parses one quiz and stores it into the game map.","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"CYX22222003"},"content":"   * @param quizId the string containing quiz Id","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"CYX22222003"},"content":"   * @param quizBody the body of the dialogue containing its questions and options","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"CYX22222003"},"content":"  private static parseQuiz(quizId: string, quizBody: string[]) {","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"CYX22222003"},"content":"    Parser.validator.registerId(quizId);","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"CYX22222003"},"content":"    const rawQuestions: Map\u003cstring, string[]\u003e \u003d StringUtils.mapByHeader(quizBody, isInteger);","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"CYX22222003"},"content":"    const questions: Question[] \u003d this.parseQuizQuestions(rawQuestions);","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"CYX22222003"},"content":"    const quiz: Quiz \u003d { questions: questions };","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"CYX22222003"},"content":"    Parser.checkpoint.map.setItemInMap(GameItemType.quizzes, quizId, quiz);","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"CYX22222003"},"content":"   * This function parses the quiz\u0027s questions,","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"CYX22222003"},"content":"   * converts each into a Question object,","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"CYX22222003"},"content":"   * and store in an array.","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"CYX22222003"},"content":"   * @param map The map of raw questions that map from index to question body","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"  private static parseQuizQuestions(map: Map\u003cstring, string[]\u003e): Question[] {","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"CYX22222003"},"content":"    const questions: Question[] \u003d new Array(map.size);","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"CYX22222003"},"content":"    map.forEach((value: string[], key: string) \u003d\u003e {","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"CYX22222003"},"content":"      questions[parseInt(key)] \u003d this.createQuestion(value);","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"CYX22222003"},"content":"    });","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"CYX22222003"},"content":"    return questions;","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"CYX22222003"},"content":"   * This function parses a question and","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"CYX22222003"},"content":"   * create a Question object.","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"CYX22222003"},"content":"   * @param questionText The text of a question body","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"CYX22222003"},"content":"   * containing question text, correct answer, and options","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"CYX22222003"},"content":"  private static createQuestion(questionText: string[]): Question {","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"CYX22222003"},"content":"    if (questionText.length \u003c 2) {","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"      throw new Error(\u0027Parsing error: Quiz missing question or answer\u0027);","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"CYX22222003"},"content":"    const question: Question \u003d {","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"CYX22222003"},"content":"      question: questionText[0],","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"CYX22222003"},"content":"      speaker: SpeakerParser.parse(\u0027@narrator\u0027),","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"CYX22222003"},"content":"      answer: this.getQuizAnswer(questionText[1]),","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"CYX22222003"},"content":"      options: this.parseOptions(questionText.slice(2))","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"CYX22222003"},"content":"    };","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"CYX22222003"},"content":"    return question;","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"CYX22222003"},"content":"   * This function parses a answer string and","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"CYX22222003"},"content":"   * converts it into Number.","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"CYX22222003"},"content":"   * @param answer The string containing the correct answer of a question","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"  private static getQuizAnswer(answer: string): number {","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"CYX22222003"},"content":"    const ans \u003d answer.split(\u0027:\u0027);","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"CYX22222003"},"content":"    if (ans.length \u003c 2 || Number.isNaN(parseInt(ans[1]))) {","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"CYX22222003"},"content":"      throw new Error(\u0027Parsing error: Invalid answer for Quiz\u0027);","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"CYX22222003"},"content":"    return parseInt(ans[1]);","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"CYX22222003"},"content":"   * This function parses options of a question and","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"CYX22222003"},"content":"   * store them in an array.","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"CYX22222003"},"content":"   * @param optionsText An Array of string containing all options\u0027 content,","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"CYX22222003"},"content":"   * including option text and reactions","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"CYX22222003"},"content":"  private static parseOptions(optionsText: string[]): Option[] {","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"CYX22222003"},"content":"    const optionsParagraph \u003d StringUtils.splitToParagraph(optionsText);","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"CYX22222003"},"content":"    const options: Option[] \u003d Array(optionsParagraph.length);","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"CYX22222003"},"content":"    optionsParagraph.forEach(([header, content]: [string, string[]], index) \u003d\u003e {","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"CYX22222003"},"content":"      options[index] \u003d this.createOption(content);","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"CYX22222003"},"content":"    });","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"CYX22222003"},"content":"    return options;","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"CYX22222003"},"content":"   * This function creates an Option object.","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"CYX22222003"},"content":"   * @param content An Array of string containing an option\u0027s content,","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"CYX22222003"},"content":"   * including option text and reaction","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"CYX22222003"},"content":"   * @param [noReaction\u003dfalse] Indicates whether this option provides a reaction","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"CYX22222003"},"content":"  private static createOption(content: string[], noReaction: boolean \u003d false): Option {","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"CYX22222003"},"content":"    if (!content) {","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"CYX22222003"},"content":"      throw new Error(\u0027Parsing error: Quiz option not provided\u0027);","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"CYX22222003"},"content":"    if (content.length \u003c\u003d 1) {","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"CYX22222003"},"content":"      noReaction \u003d true;","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"CYX22222003"},"content":"    const option: Option \u003d {","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"CYX22222003"},"content":"      text: content[0],","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"CYX22222003"},"content":"      reaction: noReaction ? undefined : DialogueParser.parseQuizReaction(content.slice(1))","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"CYX22222003"},"content":"    };","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"CYX22222003"},"content":"    return option;","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"CYX22222003"},"content":"}","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"CYX22222003"},"content":"const isInteger \u003d (line: string) \u003d\u003e new RegExp(/^[0-9]+$/).test(line);","isFullCredit":false}],"authorContributionMap":{"CYX22222003":131,"-":1}},{"path":"src/features/game/quiz/GameQuizConstants.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"CYX22222003"},"content":"import FontAssets from \u0027../assets/FontAssets\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"CYX22222003"},"content":"import { screenSize } from \u0027../commons/CommonConstants\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"CYX22222003"},"content":"import { BitmapFontStyle } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"CYX22222003"},"content":"import { Color } from \u0027../utils/StyleUtils\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"CYX22222003"},"content":"export const startPrompt \u003d {","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"CYX22222003"},"content":"  text: \u0027Start the quiz?\u0027,","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"CYX22222003"},"content":"  options: [\u0027Yes\u0027, \u0027No\u0027]","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"CYX22222003"},"content":"export const questionPrompt \u003d \u0027What is the correct answer?\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"CYX22222003"},"content":"export const QuizConstants \u003d {","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"CYX22222003"},"content":"  textPad: 20,","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"CYX22222003"},"content":"  textConfig: { x: 15, y: -15, oriX: 0.5, oriY: 0.5 },","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":"  y: 100,","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"CYX22222003"},"content":"  width: 450,","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"CYX22222003"},"content":"  yInterval: 100,","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"CYX22222003"},"content":"  headerOff: 60,","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"CYX22222003"},"content":"  speakerTextConfig: { x: 320, y: 745, oriX: 0.5, oriY: 0.5 },","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"CYX22222003"},"content":"  optionsYOffSet: 75","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"CYX22222003"},"content":"export const quizTextStyle \u003d {","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"CYX22222003"},"content":"  fontFamily: \u0027Verdana\u0027,","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"CYX22222003"},"content":"  fontSize: \u002720px\u0027,","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"CYX22222003"},"content":"  fill: Color.offWhite,","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"CYX22222003"},"content":"  align: \u0027left\u0027,","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"CYX22222003"},"content":"  lineSpacing: 10,","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"CYX22222003"},"content":"  wordWrap: { width: QuizConstants.width - QuizConstants.textPad * 2 }","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"CYX22222003"},"content":"export const questionTextStyle \u003d {","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"CYX22222003"},"content":"  fontFamily: \u0027Verdana\u0027,","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"CYX22222003"},"content":"  fontSize: \u002730px\u0027,","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"CYX22222003"},"content":"  fill: Color.lightBlue,","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"CYX22222003"},"content":"  align: \u0027left\u0027,","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"CYX22222003"},"content":"  lineSpacing: 10,","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"CYX22222003"},"content":"  wordWrap: { width: screenSize.x - 240 }","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"CYX22222003"},"content":"export const quizOptStyle: BitmapFontStyle \u003d {","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"CYX22222003"},"content":"  key: FontAssets.zektonFont.key,","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"CYX22222003"},"content":"  size: 25,","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"CYX22222003"},"content":"  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"CYX22222003"},"content":"export const speakerTextStyle: BitmapFontStyle \u003d {","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"CYX22222003"},"content":"  key: FontAssets.zektonFont.key,","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"CYX22222003"},"content":"  size: 36,","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"CYX22222003"},"content":"  align: Phaser.GameObjects.BitmapText.ALIGN_CENTER","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false}],"authorContributionMap":{"CYX22222003":52}},{"path":"src/features/game/quiz/GameQuizManager.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"CYX22222003"},"content":"import ImageAssets from \u0027../assets/ImageAssets\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"CYX22222003"},"content":"import SoundAssets from \u0027../assets/SoundAssets\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"CYX22222003"},"content":"import { Constants, screenSize } from \u0027../commons/CommonConstants\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"CYX22222003"},"content":"import { ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"CYX22222003"},"content":"import { createDialogueBox, createTypewriter } from \u0027../dialogue/GameDialogueHelper\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"CYX22222003"},"content":"import { DialogueObject } from \u0027../dialogue/GameDialogueTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"CYX22222003"},"content":"import { fadeAndDestroy } from \u0027../effects/FadeEffect\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"CYX22222003"},"content":"import { rightSideEntryTweenProps, rightSideExitTweenProps } from \u0027../effects/FlyEffect\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":"import { promptWithChoices } from \u0027../effects/Prompt\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"CYX22222003"},"content":"import { Layer } from \u0027../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"CYX22222003"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"CYX22222003"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"CYX22222003"},"content":"import { createButton } from \u0027../utils/ButtonUtils\u0027;","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"CYX22222003"},"content":"import { sleep } from \u0027../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"CYX22222003"},"content":"import { calcListFormatPos, HexColor } from \u0027../utils/StyleUtils\u0027;","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":"import {","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"CYX22222003"},"content":"  questionPrompt,","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"CYX22222003"},"content":"  questionTextStyle,","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"CYX22222003"},"content":"  QuizConstants,","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"CYX22222003"},"content":"  quizOptStyle,","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"CYX22222003"},"content":"  quizTextStyle,","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"CYX22222003"},"content":"  startPrompt","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"CYX22222003"},"content":"} from \u0027./GameQuizConstants\u0027;","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"CYX22222003"},"content":"import GameQuizReactionManager from \u0027./GameQuizReactionManager\u0027;","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"CYX22222003"},"content":"import { Question } from \u0027./GameQuizType\u0027;","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"CYX22222003"},"content":"export default class QuizManager {","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"CYX22222003"},"content":"  private reactionManager?: GameQuizReactionManager;","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"CYX22222003"},"content":"   * Rendering the quiz section inside a dialogue.","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"CYX22222003"},"content":"   * @param quizId The Id of quiz that users will attempt inside a dialogue.","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"CYX22222003"},"content":"  public async showQuiz(quizId: ItemId) {","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"CYX22222003"},"content":"    const quiz \u003d GameGlobalAPI.getInstance().getQuizById(quizId);","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"CYX22222003"},"content":"    const numOfQuestions \u003d quiz.questions.length;","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"CYX22222003"},"content":"    if (numOfQuestions \u003d\u003d\u003d 0) {","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"CYX22222003"},"content":"      return;","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"CYX22222003"},"content":"    if (!(await this.showStartPrompt(GameGlobalAPI.getInstance().getGameManager()))) {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"CYX22222003"},"content":"      await GameGlobalAPI.getInstance().showNextLine(() \u003d\u003e {});","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"CYX22222003"},"content":"      return;","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"CYX22222003"},"content":"    await GameGlobalAPI.getInstance().getGameManager().getDialogueManager().hideAll();","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"CYX22222003"},"content":"    let numOfCorrect \u003d 0;","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"CYX22222003"},"content":"    for (let i \u003d 0; i \u003c numOfQuestions; i++) {","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"CYX22222003"},"content":"      numOfCorrect +\u003d await this.showQuizQuestion(","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"CYX22222003"},"content":"        GameGlobalAPI.getInstance().getGameManager(),","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"CYX22222003"},"content":"        quiz.questions[i]","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"CYX22222003"},"content":"      );","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().setQuizScore(quizId, numOfCorrect);","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"CYX22222003"},"content":"    await GameGlobalAPI.getInstance().showNextLine(() \u003d\u003e {});","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"CYX22222003"},"content":"    await GameGlobalAPI.getInstance().getGameManager().getDialogueManager().showAll();","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"CYX22222003"},"content":"   * Display a prompt before a quiz starts.","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"CYX22222003"},"content":"   * Player can choose to proceed and do the quiz,","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"CYX22222003"},"content":"   * or to not do the quiz and exit.","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"CYX22222003"},"content":"   * @param scene The Game Manager.","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"CYX22222003"},"content":"   * @returns true if the player chooses to start the quiz.","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"CYX22222003"},"content":"  private async showStartPrompt(scene: Phaser.Scene) {","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"CYX22222003"},"content":"    const response \u003d await promptWithChoices(scene, startPrompt.text, startPrompt.options);","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"CYX22222003"},"content":"    return response \u003d\u003d\u003d 0;","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"CYX22222003"},"content":"   * Display the specific quiz question.","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"CYX22222003"},"content":"   * @param scene The game manager.","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"CYX22222003"},"content":"   * @param question The question to be displayed.","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"CYX22222003"},"content":"  public async showQuizQuestion(scene: Phaser.Scene, question: Question) {","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"CYX22222003"},"content":"    const choices \u003d question.options;","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"CYX22222003"},"content":"    const quizContainer \u003d new Phaser.GameObjects.Container(scene, 0, 0);","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"CYX22222003"},"content":"    const selfQuestionPrompt \u003d question.prompt ?? questionPrompt;","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"CYX22222003"},"content":"    const quizPartitions \u003d Math.ceil(choices.length / 5);","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"CYX22222003"},"content":"    const quizHeight \u003d choices.length;","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"CYX22222003"},"content":"    //Create quiz box contains quiz questions","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"CYX22222003"},"content":"    const quizQuestionBox \u003d createDialogueBox(scene);","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"CYX22222003"},"content":"    //Create text writer to display quiz questions","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"CYX22222003"},"content":"    const quizQuestionWriter \u003d createTypewriter(scene, questionTextStyle);","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"CYX22222003"},"content":"    const lineWithName \u003d question.question.replace(\u0027{name}\u0027, this.getUsername());","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"CYX22222003"},"content":"    quizQuestionWriter.changeLine(lineWithName);","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().storeDialogueLine(lineWithName, question.speaker);","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"CYX22222003"},"content":"    //Generate UI components for quizzes","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"CYX22222003"},"content":"    const header \u003d new Phaser.GameObjects.Text(","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"CYX22222003"},"content":"      scene,","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"CYX22222003"},"content":"      screenSize.x - QuizConstants.textPad,","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"CYX22222003"},"content":"      QuizConstants.y,","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"CYX22222003"},"content":"      selfQuestionPrompt,","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"CYX22222003"},"content":"      quizTextStyle","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"CYX22222003"},"content":"    ).setOrigin(1.0, 0.0);","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"CYX22222003"},"content":"    const quizHeaderBg \u003d new Phaser.GameObjects.Rectangle(","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"CYX22222003"},"content":"      scene,","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"CYX22222003"},"content":"      screenSize.x,","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"CYX22222003"},"content":"      QuizConstants.y - QuizConstants.textPad,","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"CYX22222003"},"content":"      QuizConstants.width * quizPartitions,","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"CYX22222003"},"content":"      header.getBounds().bottom * 0.5 + QuizConstants.textPad,","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"CYX22222003"},"content":"      HexColor.darkBlue,","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"CYX22222003"},"content":"      0.8","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"CYX22222003"},"content":"    ).setOrigin(1.0, 0.0);","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"CYX22222003"},"content":"    const quizBg \u003d new Phaser.GameObjects.Rectangle(","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"CYX22222003"},"content":"      scene,","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"CYX22222003"},"content":"      screenSize.x,","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"CYX22222003"},"content":"      QuizConstants.y - QuizConstants.textPad,","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"CYX22222003"},"content":"      QuizConstants.width * quizPartitions,","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"CYX22222003"},"content":"      quizHeaderBg.getBounds().bottom * 0.5 + (quizHeight + 0.5) * QuizConstants.yInterval,","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"CYX22222003"},"content":"      HexColor.lightBlue,","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"CYX22222003"},"content":"      0.2","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"CYX22222003"},"content":"    ).setOrigin(1.0, 0.0);","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"CYX22222003"},"content":"    quizContainer.add([","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"CYX22222003"},"content":"      quizBg,","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"CYX22222003"},"content":"      quizHeaderBg,","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"CYX22222003"},"content":"      header,","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"CYX22222003"},"content":"      quizQuestionBox,","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"CYX22222003"},"content":"      quizQuestionWriter.container","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"CYX22222003"},"content":"    ]);","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"CYX22222003"},"content":"    const buttonPositions \u003d calcListFormatPos({","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"CYX22222003"},"content":"      numOfItems: choices.length,","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"CYX22222003"},"content":"      xSpacing: 0,","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"CYX22222003"},"content":"      ySpacing: QuizConstants.yInterval","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"CYX22222003"},"content":"    });","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().addToLayer(Layer.Dialogue, quizContainer);","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"CYX22222003"},"content":"    //Create options for users to select","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"CYX22222003"},"content":"    const activateQuizContainer: Promise\u003cany\u003e \u003d new Promise(resolve \u003d\u003e {","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"CYX22222003"},"content":"      quizContainer.add(","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"CYX22222003"},"content":"        choices.map((response, index) \u003d\u003e","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"CYX22222003"},"content":"          createButton(scene, {","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"CYX22222003"},"content":"            assetKey: ImageAssets.mediumButton.key,","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"CYX22222003"},"content":"            message: response.text,","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"CYX22222003"},"content":"            textConfig: QuizConstants.textConfig,","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"CYX22222003"},"content":"            bitMapTextStyle: quizOptStyle,","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"CYX22222003"},"content":"            onUp: async () \u003d\u003e {","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"CYX22222003"},"content":"              quizContainer.destroy();","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"CYX22222003"},"content":"              const isCorrect \u003d index \u003d\u003d\u003d question.answer ? 1 : 0;","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"CYX22222003"},"content":"              if (response.reaction) {","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"CYX22222003"},"content":"                await this.showReaction(response.reaction);","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"CYX22222003"},"content":"              }","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"CYX22222003"},"content":"              resolve(isCorrect);","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"CYX22222003"},"content":"            }","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"CYX22222003"},"content":"          }).setPosition(","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"CYX22222003"},"content":"            screenSize.x -","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"CYX22222003"},"content":"              QuizConstants.width / 2 -","isFullCredit":false},{"lineNumber":159,"author":{"gitId":"CYX22222003"},"content":"              QuizConstants.width * (quizPartitions - Math.floor(index / 5) - 1),","isFullCredit":false},{"lineNumber":160,"author":{"gitId":"CYX22222003"},"content":"            (buttonPositions[index][1] % (5 * QuizConstants.yInterval)) +","isFullCredit":false},{"lineNumber":161,"author":{"gitId":"CYX22222003"},"content":"              quizHeaderBg.getBounds().bottom +","isFullCredit":false},{"lineNumber":162,"author":{"gitId":"CYX22222003"},"content":"              QuizConstants.optionsYOffSet","isFullCredit":false},{"lineNumber":163,"author":{"gitId":"CYX22222003"},"content":"          )","isFullCredit":false},{"lineNumber":164,"author":{"gitId":"CYX22222003"},"content":"        )","isFullCredit":false},{"lineNumber":165,"author":{"gitId":"CYX22222003"},"content":"      );","isFullCredit":false},{"lineNumber":166,"author":{"gitId":"CYX22222003"},"content":"    });","isFullCredit":false},{"lineNumber":167,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":168,"author":{"gitId":"CYX22222003"},"content":"    const response \u003d await activateQuizContainer;","isFullCredit":false},{"lineNumber":169,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":170,"author":{"gitId":"CYX22222003"},"content":"    // Animate in","isFullCredit":false},{"lineNumber":171,"author":{"gitId":"CYX22222003"},"content":"    quizContainer.setPosition(screenSize.x, 0);","isFullCredit":false},{"lineNumber":172,"author":{"gitId":"CYX22222003"},"content":"    SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifEnter.key);","isFullCredit":false},{"lineNumber":173,"author":{"gitId":"CYX22222003"},"content":"    scene.add.tween({","isFullCredit":false},{"lineNumber":174,"author":{"gitId":"CYX22222003"},"content":"      targets: quizContainer,","isFullCredit":false},{"lineNumber":175,"author":{"gitId":"CYX22222003"},"content":"      alpha: 1,","isFullCredit":false},{"lineNumber":176,"author":{"gitId":"CYX22222003"},"content":"      ...rightSideEntryTweenProps","isFullCredit":false},{"lineNumber":177,"author":{"gitId":"CYX22222003"},"content":"    });","isFullCredit":false},{"lineNumber":178,"author":{"gitId":"CYX22222003"},"content":"    await sleep(rightSideEntryTweenProps.duration);","isFullCredit":false},{"lineNumber":179,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":180,"author":{"gitId":"CYX22222003"},"content":"    // Animate out","isFullCredit":false},{"lineNumber":181,"author":{"gitId":"CYX22222003"},"content":"    SourceAcademyGame.getInstance().getSoundManager().playSound(SoundAssets.notifExit.key);","isFullCredit":false},{"lineNumber":182,"author":{"gitId":"CYX22222003"},"content":"    scene.add.tween({","isFullCredit":false},{"lineNumber":183,"author":{"gitId":"CYX22222003"},"content":"      targets: quizContainer,","isFullCredit":false},{"lineNumber":184,"author":{"gitId":"CYX22222003"},"content":"      alpha: 1,","isFullCredit":false},{"lineNumber":185,"author":{"gitId":"CYX22222003"},"content":"      ...rightSideExitTweenProps","isFullCredit":false},{"lineNumber":186,"author":{"gitId":"CYX22222003"},"content":"    });","isFullCredit":false},{"lineNumber":187,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":188,"author":{"gitId":"CYX22222003"},"content":"    fadeAndDestroy(scene, quizContainer, { fadeDuration: Constants.fadeDuration });","isFullCredit":false},{"lineNumber":189,"author":{"gitId":"CYX22222003"},"content":"    return response;","isFullCredit":false},{"lineNumber":190,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":191,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":192,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":193,"author":{"gitId":"CYX22222003"},"content":"   * Display the reaction after users selecting an option.","isFullCredit":false},{"lineNumber":194,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":195,"author":{"gitId":"CYX22222003"},"content":"   * @param reaction The reaction to be displayed.","isFullCredit":false},{"lineNumber":196,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":197,"author":{"gitId":"CYX22222003"},"content":"  private async showReaction(reaction: DialogueObject) {","isFullCredit":false},{"lineNumber":198,"author":{"gitId":"CYX22222003"},"content":"    this.reactionManager \u003d new GameQuizReactionManager(reaction);","isFullCredit":false},{"lineNumber":199,"author":{"gitId":"CYX22222003"},"content":"    await this.reactionManager.showReaction();","isFullCredit":false},{"lineNumber":200,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":201,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":202,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":203,"author":{"gitId":"CYX22222003"},"content":"   * Get the number of questions of a quiz.","isFullCredit":false},{"lineNumber":204,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":205,"author":{"gitId":"CYX22222003"},"content":"   * @param quizId The Id of quiz.","isFullCredit":false},{"lineNumber":206,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":207,"author":{"gitId":"CYX22222003"},"content":"  public getNumOfQns(quizId: ItemId): number {","isFullCredit":false},{"lineNumber":208,"author":{"gitId":"CYX22222003"},"content":"    const quiz \u003d GameGlobalAPI.getInstance().getQuizById(quizId);","isFullCredit":false},{"lineNumber":209,"author":{"gitId":"CYX22222003"},"content":"    return quiz.questions.length;","isFullCredit":false},{"lineNumber":210,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":211,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":212,"author":{"gitId":"CYX22222003"},"content":"  private getUsername \u003d () \u003d\u003e SourceAcademyGame.getInstance().getAccountInfo().name;","isFullCredit":false},{"lineNumber":213,"author":{"gitId":"CYX22222003"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":213}},{"path":"src/features/game/quiz/GameQuizReactionManager.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"CYX22222003"},"content":"import SoundAssets from \u0027../assets/SoundAssets\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"CYX22222003"},"content":"import DialogueGenerator from \u0027../dialogue/GameDialogueGenerator\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"CYX22222003"},"content":"import DialogueRenderer from \u0027../dialogue/GameDialogueRenderer\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"CYX22222003"},"content":"import { DialogueObject } from \u0027../dialogue/GameDialogueTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"CYX22222003"},"content":"import { promptWithChoices } from \u0027../effects/Prompt\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"CYX22222003"},"content":"import { Layer } from \u0027../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"CYX22222003"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"CYX22222003"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":"import { questionTextStyle } from \u0027./GameQuizConstants\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"CYX22222003"},"content":"import { QuizSpeakerRenderer } from \u0027./GameQuizSpeakerRenderer\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"CYX22222003"},"content":"/**","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"CYX22222003"},"content":" * A class that manages the reaction after a option is selected or the quiz is complete","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"CYX22222003"},"content":" *","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"CYX22222003"},"content":" */","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":"export default class GameQuizReactionManager {","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"CYX22222003"},"content":"  private dialogue: DialogueObject;","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"CYX22222003"},"content":"  private dialogueRenderer?: DialogueRenderer;","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"CYX22222003"},"content":"  private dialogueGenerator?: DialogueGenerator;","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"CYX22222003"},"content":"  private speakerRenderer?: QuizSpeakerRenderer;","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"CYX22222003"},"content":"  constructor(dialogue: DialogueObject) {","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"CYX22222003"},"content":"    this.dialogue \u003d dialogue;","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"CYX22222003"},"content":"   * It renders the reaction after the selection of an option or the quiz ends","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"CYX22222003"},"content":"   * @returns {Promise} the promise that resolves when the whole reaction is displayed","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"CYX22222003"},"content":"  public async showReaction(): Promise\u003cvoid\u003e {","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"CYX22222003"},"content":"    this.dialogueRenderer \u003d new DialogueRenderer(questionTextStyle);","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"CYX22222003"},"content":"    this.dialogueGenerator \u003d new DialogueGenerator(this.dialogue);","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"CYX22222003"},"content":"    this.speakerRenderer \u003d new QuizSpeakerRenderer();","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().addToLayer(","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"CYX22222003"},"content":"      Layer.Dialogue,","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"CYX22222003"},"content":"      this.dialogueRenderer.getDialogueContainer()","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"CYX22222003"},"content":"    );","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().fadeInLayer(Layer.Dialogue);","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"CYX22222003"},"content":"    await new Promise(resolve \u003d\u003e this.playWholeDialogue(resolve as () \u003d\u003e void));","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"CYX22222003"},"content":"    this.getDialogueRenderer().destroy();","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerRenderer().changeSpeakerTo(null);","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"CYX22222003"},"content":"  private async playWholeDialogue(resolve: () \u003d\u003e void) {","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"CYX22222003"},"content":"    await this.showNextLine(resolve);","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"CYX22222003"},"content":"    this.getDialogueRenderer()","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"CYX22222003"},"content":"      .getDialogueBox()","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"CYX22222003"},"content":"      .on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP, async () \u003d\u003e {","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"CYX22222003"},"content":"        await this.showNextLine(resolve);","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"      });","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"CYX22222003"},"content":"  private async showNextLine(resolve: () \u003d\u003e void) {","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().playSound(SoundAssets.dialogueAdvance.key);","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"CYX22222003"},"content":"    const { line, speakerDetail, actionIds, prompt } \u003d","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"CYX22222003"},"content":"      await this.getDialogueGenerator().generateNextLine();","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"CYX22222003"},"content":"    const lineWithName \u003d line.replace(\u0027{name}\u0027, this.getUsername());","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"CYX22222003"},"content":"    this.getDialogueRenderer().changeText(lineWithName);","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerRenderer().changeSpeakerTo(speakerDetail);","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"CYX22222003"},"content":"    // Store the current line into the storage","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().storeDialogueLine(lineWithName, speakerDetail);","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"CYX22222003"},"content":"    // Disable interactions while processing actions","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(), false);","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"    if (prompt) {","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"CYX22222003"},"content":"      // disable keyboard input to prevent continue dialogue","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"CYX22222003"},"content":"      const response \u003d await promptWithChoices(","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"CYX22222003"},"content":"        GameGlobalAPI.getInstance().getGameManager(),","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"CYX22222003"},"content":"        prompt.promptTitle,","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"CYX22222003"},"content":"        prompt.choices.map(choice \u003d\u003e choice[0])","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"CYX22222003"},"content":"      );","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"CYX22222003"},"content":"      this.getDialogueGenerator().updateCurrPart(prompt.choices[response][1]);","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"CYX22222003"},"content":"    await GameGlobalAPI.getInstance().processGameActionsInSamePhase(actionIds);","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(), true);","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"CYX22222003"},"content":"    if (!line) {","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"CYX22222003"},"content":"      resolve();","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"CYX22222003"},"content":"  private getDialogueGenerator \u003d () \u003d\u003e this.dialogueGenerator as DialogueGenerator;","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"CYX22222003"},"content":"  private getDialogueRenderer \u003d () \u003d\u003e this.dialogueRenderer as DialogueRenderer;","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"CYX22222003"},"content":"  private getSpeakerRenderer \u003d () \u003d\u003e this.speakerRenderer as QuizSpeakerRenderer;","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"CYX22222003"},"content":"  public getUsername \u003d () \u003d\u003e SourceAcademyGame.getInstance().getAccountInfo().name;","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"CYX22222003"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":91}},{"path":"src/features/game/quiz/GameQuizSpeakerRenderer.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"CYX22222003"},"content":"import ImageAssets from \u0027../assets/ImageAssets\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"CYX22222003"},"content":"import { SpeakerDetail } from \u0027../character/GameCharacterTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"CYX22222003"},"content":"import { screenCenter, screenSize } from \u0027../commons/CommonConstants\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"CYX22222003"},"content":"import { GamePosition, ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"CYX22222003"},"content":"import { Layer } from \u0027../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"CYX22222003"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"CYX22222003"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"CYX22222003"},"content":"import StringUtils from \u0027../utils/StringUtils\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":"import { createBitmapText } from \u0027../utils/TextUtils\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"CYX22222003"},"content":"import { QuizConstants, speakerTextStyle } from \u0027./GameQuizConstants\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"CYX22222003"},"content":"/**","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"CYX22222003"},"content":" * Class that manages speaker box portion of the quiz speaker box","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"CYX22222003"},"content":" * render characters in QuizSpeaker Layer","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"CYX22222003"},"content":" *","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":" */","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"CYX22222003"},"content":"export class QuizSpeakerRenderer {","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"CYX22222003"},"content":"  private currentSpeakerId?: string;","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"CYX22222003"},"content":"  private speakerSprite?: Phaser.GameObjects.Image;","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"CYX22222003"},"content":"  private speakerSpriteBox?: Phaser.GameObjects.Container;","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"CYX22222003"},"content":"   * Changes the speaker shown in the speaker box and the speaker rendered on screen","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"CYX22222003"},"content":"   * @param newSpeakerDetail the details about the new speaker,","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"CYX22222003"},"content":"   * including his characaterId, expression and position.","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"CYX22222003"},"content":"   * Undefined - if no speaker changes are involved in the dialogue line.","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"CYX22222003"},"content":"   * Null - if there is no speaker for the line","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"CYX22222003"},"content":"  public changeSpeakerTo(newSpeakerDetail?: SpeakerDetail | null) {","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"CYX22222003"},"content":"    if (newSpeakerDetail \u003d\u003d\u003d undefined) return;","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"    if (this.currentSpeakerId) {","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"CYX22222003"},"content":"      GameGlobalAPI.getInstance().clearSeveralLayers([Layer.QuizSpeaker, Layer.QuizSpeakerBox]);","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"CYX22222003"},"content":"    this.showNewSpeaker(newSpeakerDetail);","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"CYX22222003"},"content":"  private showNewSpeaker(newSpeakerDetail: SpeakerDetail | null) {","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"CYX22222003"},"content":"    if (newSpeakerDetail) {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"CYX22222003"},"content":"      this.drawSpeakerSprite(newSpeakerDetail);","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"CYX22222003"},"content":"      this.drawSpeakerBox(newSpeakerDetail.speakerId);","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"CYX22222003"},"content":"  private drawSpeakerBox(speakerId: ItemId) {","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"CYX22222003"},"content":"    if (speakerId \u003d\u003d\u003d \u0027narrator\u0027) return;","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"CYX22222003"},"content":"    const speakerContainer \u003d","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"CYX22222003"},"content":"      speakerId \u003d\u003d\u003d \u0027you\u0027","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"CYX22222003"},"content":"        ? this.createSpeakerBox(this.getUsername(), GamePosition.Right)","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"CYX22222003"},"content":"        : this.createSpeakerBox(","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"CYX22222003"},"content":"            GameGlobalAPI.getInstance().getCharacterById(speakerId).name,","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"CYX22222003"},"content":"            GamePosition.Left","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"CYX22222003"},"content":"          );","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().addToLayer(Layer.QuizSpeakerBox, speakerContainer);","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"CYX22222003"},"content":"  private drawSpeakerSprite({ speakerId, speakerPosition, expression }: SpeakerDetail) {","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"CYX22222003"},"content":"    this.currentSpeakerId \u003d speakerId;","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"CYX22222003"},"content":"    if (speakerId \u003d\u003d\u003d \u0027you\u0027 || speakerId \u003d\u003d\u003d \u0027narrator\u0027) {","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"CYX22222003"},"content":"      return;","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"CYX22222003"},"content":"    const speakerSprite \u003d GameGlobalAPI.getInstance().createCharacterSprite(","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"CYX22222003"},"content":"      speakerId,","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"CYX22222003"},"content":"      expression,","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"CYX22222003"},"content":"      speakerPosition","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"CYX22222003"},"content":"    );","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"CYX22222003"},"content":"    this.speakerSprite \u003d speakerSprite;","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"CYX22222003"},"content":"    GameGlobalAPI.getInstance().addToLayer(Layer.QuizSpeaker, speakerSprite);","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"CYX22222003"},"content":"  private createSpeakerBox(text: string, position: GamePosition) {","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"CYX22222003"},"content":"    const gameManager \u003d GameGlobalAPI.getInstance().getGameManager();","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"CYX22222003"},"content":"    const container \u003d new Phaser.GameObjects.Container(gameManager, 0, 0);","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"CYX22222003"},"content":"    const rectangle \u003d new Phaser.GameObjects.Image(","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"CYX22222003"},"content":"      gameManager,","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"CYX22222003"},"content":"      screenCenter.x,","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"CYX22222003"},"content":"      screenCenter.y,","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"CYX22222003"},"content":"      ImageAssets.speakerBox.key","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"CYX22222003"},"content":"    ).setAlpha(0.8);","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"CYX22222003"},"content":"    const speakerText \u003d createBitmapText(","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"CYX22222003"},"content":"      gameManager,","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"CYX22222003"},"content":"      \u0027\u0027,","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"CYX22222003"},"content":"      QuizConstants.speakerTextConfig,","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"CYX22222003"},"content":"      speakerTextStyle","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"CYX22222003"},"content":"    );","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"CYX22222003"},"content":"    if (position \u003d\u003d\u003d GamePosition.Right) {","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"CYX22222003"},"content":"      rectangle.displayWidth *\u003d -1;","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"CYX22222003"},"content":"      speakerText.x \u003d screenSize.x - speakerText.x;","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"CYX22222003"},"content":"    }","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"CYX22222003"},"content":"    container.add([rectangle, speakerText]);","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"CYX22222003"},"content":"    speakerText.text \u003d StringUtils.capitalize(text);","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"CYX22222003"},"content":"    this.speakerSpriteBox \u003d container;","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"CYX22222003"},"content":"    return container;","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"CYX22222003"},"content":"   * Hide the speaker box and sprite","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"CYX22222003"},"content":"  public async hide() {","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSprite().setVisible(false);","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSpriteBox().setVisible(false);","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"CYX22222003"},"content":"   * Show the hidden speaker box and sprite","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"CYX22222003"},"content":"  public async show() {","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSprite().setVisible(true);","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"CYX22222003"},"content":"    this.getSpeakerSpriteBox().setVisible(true);","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"CYX22222003"},"content":"  public getUsername \u003d () \u003d\u003e SourceAcademyGame.getInstance().getAccountInfo().name;","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"CYX22222003"},"content":"  private getSpeakerSprite \u003d () \u003d\u003e this.speakerSprite as Phaser.GameObjects.Image;","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"CYX22222003"},"content":"  private getSpeakerSpriteBox \u003d () \u003d\u003e this.speakerSpriteBox as Phaser.GameObjects.Container;","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"CYX22222003"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":118,"-":2}},{"path":"src/features/game/quiz/GameQuizType.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"CYX22222003"},"content":"import { SpeakerDetail } from \u0027../character/GameCharacterTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"CYX22222003"},"content":"import { DialogueObject } from \u0027../dialogue/GameDialogueTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"CYX22222003"},"content":"export type Quiz \u003d {","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"CYX22222003"},"content":"  questions: Question[];","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"CYX22222003"},"content":"export type Question \u003d {","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":"  question: string;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"CYX22222003"},"content":"  prompt?: string;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"CYX22222003"},"content":"  speaker: SpeakerDetail;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"  answer: number;","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"CYX22222003"},"content":"  options: Option[];","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":"export type Option \u003d {","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"CYX22222003"},"content":"  text: string;","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"CYX22222003"},"content":"  reaction?: DialogueObject;","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"CYX22222003"},"content":"};","isFullCredit":false}],"authorContributionMap":{"CYX22222003":18,"-":1}},{"path":"src/features/game/save/GameSaveHelper.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { GamePhaseType } from \u0027../phase/GamePhaseTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import { FullSaveState, GameSaveState } from \u0027./GameSaveTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":" * Function that saves game data as a \u0027snapshot\u0027 in FullSaveState","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":" * json format by collecting game data from game manager,","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":" * game state manager, user state manager, and phase manager","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":" * @param prevGameState - the snapshot of the game the during the last save point","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":" * @param chapterNum - the chapterNumber of the game","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":" * @param checkpointNUm - the checkpoint of the game","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":" * @returns {FullSaveState} - the new \u0027snapshot\u0027 of the game","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"export function gameStateToJson(","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  prevGameState: FullSaveState,","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"  chapterNum: number,","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"  checkpointNum: number","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"): FullSaveState {","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"  const gameManager \u003d GameGlobalAPI.getInstance().getGameManager();","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"  const gameStateManager \u003d gameManager.getStateManager();","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"  const phaseManager \u003d gameManager.getPhaseManager();","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"  return {","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"    gameSaveStates: {","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"      ...prevGameState.gameSaveStates,","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"      [chapterNum]: {","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"        lastCheckpointPlayed: checkpointNum,","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"        currentLocation: gameManager.currentLocationId,","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"        currentPhase: phaseManager.getCurrentPhase(),","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"        chapterNewlyCompleted: gameStateManager.getChapterNewlyCompleted(),","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"        incompleteTasks: gameStateManager.getIncompleteTasks(),","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"        completedTasks: gameStateManager.getCompletedTasks(),","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"        completedObjectives: gameStateManager.getCompletedObjectives(),","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"        triggeredInteractions: gameStateManager.getTriggeredInteractions(),","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"CYX22222003"},"content":"        triggeredStateChangeActions: gameStateManager.getTriggeredStateChangeActions(),","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"CYX22222003"},"content":"        quizScores: gameStateManager.getQuizScores()","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"    },","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"    userSaveState: {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"      settings: prevGameState.userSaveState.settings,","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"      recentlyPlayedCheckpoint: [chapterNum, checkpointNum],","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"      collectibles: SourceAcademyGame.getInstance().getUserStateManager().getCollectibles(),","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"      largestCompletedChapter: prevGameState.userSaveState.largestCompletedChapter","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"  };","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":" * Function to create an empty full save state","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":" * Used for resetting game data of students","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":" * @returns {FullSaveState} - an empty save state for starting players","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"export const createEmptySaveState \u003d (): FullSaveState \u003d\u003e {","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"  return {","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"    gameSaveStates: {},","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"    userSaveState: {","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"      collectibles: [],","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"      settings: { bgmVolume: 1, sfxVolume: 1 },","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"      recentlyPlayedCheckpoint: [-1, -1],","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"      largestCompletedChapter: -1","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"  };","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":" * Function to create an empty game save state","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":" * Used for resetting game data of students","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":" * @returns {GameSaveState} - an empty save state for starting the game","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"export const createEmptyGameSaveState \u003d (): GameSaveState \u003d\u003e {","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"  return {","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"    lastCheckpointPlayed: 0,","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"    currentLocation: undefined,","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"    currentPhase: GamePhaseType.Menu,","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"    chapterNewlyCompleted: false,","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"    incompleteTasks: [],","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"    completedTasks: [],","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"    completedObjectives: [],","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"    triggeredInteractions: [],","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"CYX22222003"},"content":"    triggeredStateChangeActions: [],","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"CYX22222003"},"content":"    quizScores: []","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"  };","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":" * Converts a map, where some items have been triggered","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":" * into an array containing all the items that have been triggered.","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":" * @param completionMap map containing string elements to boolean indicating","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":" *                      which elements have been completed/triggerd","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"export function convertMapToArray(completionMap: Map\u003cstring, boolean\u003e) {","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"  return Array.from(completionMap)","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"    .filter(([_objective, boolean]: [string, boolean]) \u003d\u003e boolean)","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"    .map(([objective]: [string, boolean]) \u003d\u003e objective);","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":4,"-":96}},{"path":"src/features/game/save/GameSaveManager.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import GameManager from \u0027../scenes/gameManager/GameManager\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { mandatory } from \u0027../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import { createEmptyGameSaveState, createEmptySaveState, gameStateToJson } from \u0027./GameSaveHelper\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import { loadData, saveData } from \u0027./GameSaveRequests\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { FullSaveState, GameSaveState, SettingsJson } from \u0027./GameSaveTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":" * The manager provides API for loading and saving data from the backend","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":" * and is in charge of keeping record of the last save point, so that","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":" * players can make new save data based on the last one.","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"export default class GameSaveManager {","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"  private fullSaveState: FullSaveState;","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"  private chapterNum?: number;","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  private checkpointNum?: number;","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"  constructor() {","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"    this.fullSaveState \u003d createEmptySaveState();","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"   * Fetches the FullSaveState of the student at the start of the game","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"   * and stores this internally as full save state","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"  public async loadLastSaveState() {","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"    this.fullSaveState \u003d await loadData();","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"   * Updates the save manager with chapter number and checkpoint number","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"   * if player has chosen a chapter/checkpoint to play with.","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"   * Chapter number and checkpoint number can be -1 if inside the Game Simulator,","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"   * @param chapterNum chapter number","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"   * @param checkpointNum checkpoint number","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"   * @param continueGame whether user wants to continue or restart the chapter.","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"  public registerGameInfo(chapterNum: number, checkpointNum: number, continueGame: boolean) {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"    this.chapterNum \u003d chapterNum;","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"    this.checkpointNum \u003d checkpointNum;","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"    if (!continueGame) {","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"      this.fullSaveState.gameSaveStates[chapterNum] \u003d createEmptyGameSaveState();","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  //          Saving          //","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"   * Save the current game state as a JSON \u0027snapshot\u0027 to the backend.","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"   * Can only be called inside the GameManager scene because this function retrieves","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"   * informtion from GameManager, GameStateManager, or other in-game managers,","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"   * and converts them into JSON format to be saved to backend.","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"   * Only called when playing the Game (not Game Simulator), because Game Simulator","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"   * shouldn\u0027t save game state to backend.","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"  public async saveGame() {","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"    if (SourceAcademyGame.getInstance().getCurrentSceneRef() instanceof GameManager) {","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"      this.fullSaveState \u003d gameStateToJson(","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"        this.fullSaveState,","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"        this.getChapterNum(),","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"        this.getCheckpointNum()","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"      );","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"      await saveData(this.fullSaveState);","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"   * This function is called during CheckpointTransition to update","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"   * and save that largest chapter that the player has completed","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"   * so far.","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"   * @param completedChapter the number of the completed chapter","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"  public async saveChapterComplete(completedChapter: number) {","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"    this.fullSaveState.gameSaveStates[completedChapter].chapterNewlyCompleted \u003d true;","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"    if (completedChapter \u003e this.getLargestCompletedChapterNum()) {","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"      this.fullSaveState.userSaveState.largestCompletedChapter \u003d completedChapter;","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"    await saveData(this.fullSaveState);","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"   * This function is called by the Escape Manager and Settings scene","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"   * to store new user settings to the backend","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"   * @param settingsJson the newest settings of the user","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"  public async saveSettings(settingsJson: SettingsJson) {","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"    this.fullSaveState.userSaveState.settings \u003d settingsJson;","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"    await saveData(this.fullSaveState);","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"  //         Getters           //","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"   * Obtains user settings from full save state","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"   * @returns User settings","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"  public getSettings(): SettingsJson {","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"    return this.fullSaveState.userSaveState.settings;","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"   * Obtains user state from full save state","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"  public getLoadedUserState() {","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"    return this.fullSaveState.userSaveState;","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"   * Obtains the largest completed chapter number by the player","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"  public getLargestCompletedChapterNum(): number {","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"    return this.fullSaveState.userSaveState.largestCompletedChapter;","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"   * Gets user\u0027s gamestate for this chapter","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"  public getGameSaveState(): GameSaveState {","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"    return this.fullSaveState.gameSaveStates[this.getChapterNum()] || createEmptyGameSaveState();","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"   * Gets user\u0027s location for this chapter if chapter has been created","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"  public getLoadedLocation() {","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"    return this.getGameSaveState().currentLocation;","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"   * Returns the save state for a particular chapter, if no data, then create an empty save state","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"  public getChapterSaveState(index: number) {","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"    return this.fullSaveState.gameSaveStates[index] || createEmptyGameSaveState();","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"  public getTriggeredStateChangeActions \u003d () \u003d\u003e this.getGameSaveState().triggeredStateChangeActions;","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"  public getTriggeredInteractions \u003d () \u003d\u003e this.getGameSaveState().triggeredInteractions;","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"-"},"content":"  public getCompletedObjectives \u003d () \u003d\u003e this.getGameSaveState().completedObjectives;","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"-"},"content":"  public getCompletedTasks \u003d () \u003d\u003e this.getGameSaveState().completedTasks;","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"-"},"content":"  public getIncompleteTasks \u003d () \u003d\u003e this.getGameSaveState().incompleteTasks;","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"-"},"content":"  public getLoadedPhase \u003d () \u003d\u003e this.getGameSaveState().currentPhase;","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"-"},"content":"  public getChapterNewlyCompleted \u003d () \u003d\u003e this.getGameSaveState().chapterNewlyCompleted;","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"CYX22222003"},"content":"  public getQuizScores \u003d () \u003d\u003e this.getGameSaveState().quizScores;","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"-"},"content":"  public getChapterNum \u003d () \u003d\u003e mandatory(this.chapterNum);","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"-"},"content":"  public getCheckpointNum \u003d () \u003d\u003e mandatory(this.checkpointNum);","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"-"},"content":"  public getFullSaveState \u003d () \u003d\u003e this.fullSaveState;","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":1,"-":157}},{"path":"src/features/game/save/GameSaveTypes.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":" * @typedef {FullSaveState} - this type encapsulates the the entire json object","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":" * that is being saved in the backend","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":" * @prop {Object\u003cnumber, GameSaveState\u003e} gameSaveStates - the object that stores game stateof player at every last played checkpoint of the chapter","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":" * @prop {UserSaveState} userSaveState - the object that stores settings and information about the player, available regardless of which chapter they are at","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"export type FullSaveState \u003d {","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"  gameSaveStates: { [chapterNum: number]: GameSaveState };","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"  userSaveState: UserSaveState;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":" * @typedef {GameSaveState} - this encapsulates data of students\u0027 progress in the game in one checkpoint","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":" * @prop {number} lastCheckpointPlayed - the last checkpoint played in the chapter","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":" * @prop {string} currentLocation - location of student during save","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":" * @prop {string} currentPhase - phase student is in during last save","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":" * @prop {string[]} incompleteTasks - list of tasks that have been displayed but yet to be completed by player","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":" * @prop {string[]} completedTasks - list of tasks that have been completed by player","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":" * @prop {string[]} completedObjectives - list of objectives that have been completed by player","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":" * @prop {string[]} triggeredInteractions - list of itemIds that have been triggered by player","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":" * @prop {string[]} triggeredActions - list of actions that have been triggered by player","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"CYX22222003"},"content":" * @prop {[string, number][]} quizScores - list of quiz ids and the corresponding quiz scores for a user","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"export type GameSaveState \u003d {","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"  lastCheckpointPlayed: number;","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"  currentLocation: string | undefined;","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  currentPhase: string;","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"  chapterNewlyCompleted: boolean;","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  incompleteTasks: string[];","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"  completedTasks: string[];","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  completedObjectives: string[];","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  triggeredInteractions: string[];","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  triggeredStateChangeActions: string[];","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"CYX22222003"},"content":"  quizScores: [string, number][];","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":" * @typedef {UserSaveState} - this encapsulates data about students player account throughout the game","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":" * @prop {SettingsJson} settings - settings json object that contains user settings","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":" * @prop {[number, number]} recentlyPlayedCheckpoint - the chapter and checkpoint where the student left off (can be used for continue game)","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":" * @prop {string[]} collectibles - the ItemIds of all collectibles that students have completed","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":" * @prop {number} largestCompletedChapter - the largest chapter number which the students have played (used black tinting chapters in chapter select)","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"export type UserSaveState \u003d {","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"  settings: SettingsJson;","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"  recentlyPlayedCheckpoint: [number, number];","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"  collectibles: string[];","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  largestCompletedChapter: number;","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":" * @typedef {SettingsJson} - this encapsulates data about students settings","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":" * @prop {number} volume - volume that students play the game with","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"export type SettingsJson \u003d {","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"  bgmVolume: number;","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"  sfxVolume: number;","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"};","isFullCredit":false}],"authorContributionMap":{"CYX22222003":2,"-":58}},{"path":"src/features/game/scenes/gameManager/GameGlobalAPI.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { GameAction } from \u0027../../action/GameActionTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { SoundAsset } from \u0027../../assets/AssetsTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { getAwardProp } from \u0027../../awards/GameAwardsHelper\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import { BBoxProperty } from \u0027../../boundingBoxes/GameBoundingBoxTypes\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import { Character, SpeakerDetail } from \u0027../../character/GameCharacterTypes\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { AssetKey, GamePosition, GameSize, ItemId } from \u0027../../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import { Dialogue } from \u0027../../dialogue/GameDialogueTypes\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import { displayMiniMessage } from \u0027../../effects/MiniMessage\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"import { displayNotification } from \u0027../../effects/Notification\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"import { promptWithChoices } from \u0027../../effects/Prompt\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"import { Layer } from \u0027../../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"import { AnyId, GameItemType, GameLocation, LocationId } from \u0027../../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"import { GameMode } from \u0027../../mode/GameModeTypes\u0027;","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"import { ObjectProperty } from \u0027../../objects/GameObjectTypes\u0027;","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"import { GamePhaseType } from \u0027../../phase/GamePhaseTypes\u0027;","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"CYX22222003"},"content":"import { Quiz } from \u0027../../quiz/GameQuizType\u0027;","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"import { SettingsJson } from \u0027../../save/GameSaveTypes\u0027;","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"import { StateObserver, UserStateType } from \u0027../../state/GameStateTypes\u0027;","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"import { TaskDetail } from \u0027../../task/GameTaskTypes\u0027;","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"import { courseId, mandatory } from \u0027../../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"import GameManager from \u0027./GameManager\u0027;","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":" * This class exposes all the public API\u0027s of managers","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":" * in the Game Manager scene.","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":" * It allows managers to access services globally","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":" * through GameGlobalAPI.getInstance().function() without","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":" * having to keep a reference to the gameManager.","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"class GameGlobalAPI {","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  private gameManager: GameManager | undefined;","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  static instance: GameGlobalAPI;","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"  private constructor() {","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"    this.gameManager \u003d undefined;","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"  static getInstance() {","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"    if (!GameGlobalAPI.instance) {","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"      GameGlobalAPI.instance \u003d new GameGlobalAPI();","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"    return GameGlobalAPI.instance;","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"  //   Game Manager  //","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"  public getGameManager \u003d () \u003d\u003e mandatory(this.gameManager);","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"  public setGameManager(gameManagerRef: GameManager): void {","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"    this.gameManager \u003d gameManagerRef;","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"  public getCurrLocId(): LocationId {","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"    return this.getGameManager().currentLocationId;","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"  public getLocationAtId(locationId: LocationId): GameLocation {","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().getGameMap().getLocationAtId(locationId);","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"  public async changeLocationTo(locationName: string) {","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"    await this.getGameManager().changeLocationTo(locationName);","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"  //    Game Mode    //","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"  public getLocationModes(locationId: LocationId): GameMode[] {","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().getLocationModes(locationId);","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"  public addLocationMode(locationId: LocationId, mode: GameMode): void {","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().addLocationMode(locationId, mode);","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"  public removeLocationMode(locationId: LocationId, mode: GameMode): void {","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().removeLocationMode(locationId, mode);","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"  //   Interaction   //","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"  public hasTriggeredInteraction(id: string): boolean | undefined {","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().hasTriggeredInteraction(id);","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"  public triggerStateChangeAction(actionId: ItemId): void {","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().triggerStateChangeAction(actionId);","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"  public triggerInteraction(id: string): void {","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().triggerInteraction(id);","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"  //    Game Items   //","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"  public watchGameItemType(gameItemType: GameItemType, stateObserver: StateObserver) {","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().watchGameItemType(gameItemType, stateObserver);","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"  public getGameMap() {","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().getGameMap();","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"  public getGameItemsInLocation(gameItemType: GameItemType, locationId: LocationId): ItemId[] {","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().getGameItemsInLocation(gameItemType, locationId);","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"  public addItem(gameItemType: GameItemType, locationId: LocationId, itemId: ItemId): void {","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().addItem(gameItemType, locationId, itemId);","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"  public removeItem(gameItemType: GameItemType, locationId: LocationId, itemId: ItemId): void {","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().removeItem(gameItemType, locationId, itemId);","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"  //  Game Objects   //","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"  public makeObjectGlow(objectId: ItemId, turnOn: boolean) {","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"    this.getGameManager().getObjectManager().makeObjectGlow(objectId, turnOn);","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"  public makeObjectBlink(objectId: ItemId, turnOn: boolean) {","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"    this.getGameManager().getObjectManager().makeObjectBlink(objectId, turnOn);","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"  public objectHoverGlow(objectId: ItemId, turnOn: boolean) {","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"    this.getGameManager().getObjectManager().objectHoverGlow(objectId, turnOn);","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"  public setObjProperty(id: ItemId, newObjProp: ObjectProperty) {","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().setObjProperty(id, newObjProp);","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"  public renderObjectLayerContainer(locationId: LocationId) {","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"    this.getGameManager().getObjectManager().renderObjectsLayerContainer(locationId);","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"-"},"content":"  public getAllActivatables() {","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"-"},"content":"    return [","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"-"},"content":"      ...this.getGameManager().getObjectManager().getActivatables(),","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"-"},"content":"      ...this.getGameManager().getBBoxManager().getActivatables()","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"-"},"content":"    ];","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"-"},"content":"  //    Game BBox    //","isFullCredit":false},{"lineNumber":159,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":160,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":161,"author":{"gitId":"-"},"content":"  public setBBoxProperty(id: ItemId, newBBoxProp: BBoxProperty) {","isFullCredit":false},{"lineNumber":162,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().setBBoxProperty(id, newBBoxProp);","isFullCredit":false},{"lineNumber":163,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":164,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":165,"author":{"gitId":"-"},"content":"  public renderBBoxLayerContainer(locationId: LocationId) {","isFullCredit":false},{"lineNumber":166,"author":{"gitId":"-"},"content":"    this.getGameManager().getBBoxManager().renderBBoxLayerContainer(locationId);","isFullCredit":false},{"lineNumber":167,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":168,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":169,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":170,"author":{"gitId":"-"},"content":"  //  Game Objective //","isFullCredit":false},{"lineNumber":171,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":172,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":173,"author":{"gitId":"-"},"content":"  public areAllObjectivesComplete(): boolean {","isFullCredit":false},{"lineNumber":174,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().areAllObjectivesComplete();","isFullCredit":false},{"lineNumber":175,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":176,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":177,"author":{"gitId":"-"},"content":"  public isObjectiveComplete(key: string): boolean {","isFullCredit":false},{"lineNumber":178,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().isObjectiveComplete(key);","isFullCredit":false},{"lineNumber":179,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":180,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":181,"author":{"gitId":"-"},"content":"  public areObjectivesComplete(keys: string[]): boolean {","isFullCredit":false},{"lineNumber":182,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().areObjectivesComplete(keys);","isFullCredit":false},{"lineNumber":183,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":184,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":185,"author":{"gitId":"-"},"content":"  public completeObjective(key: string): void {","isFullCredit":false},{"lineNumber":186,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().completeObjective(key);","isFullCredit":false},{"lineNumber":187,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":188,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":189,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":190,"author":{"gitId":"-"},"content":"  //  Game Task      //","isFullCredit":false},{"lineNumber":191,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":192,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":193,"author":{"gitId":"-"},"content":"  public isTaskComplete(key: string): boolean {","isFullCredit":false},{"lineNumber":194,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().isTaskComplete(key);","isFullCredit":false},{"lineNumber":195,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":196,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":197,"author":{"gitId":"-"},"content":"  public areTasksComplete(keys: string[]): boolean {","isFullCredit":false},{"lineNumber":198,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().areTasksComplete(keys);","isFullCredit":false},{"lineNumber":199,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":200,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":201,"author":{"gitId":"-"},"content":"  public completeTask(key: string): void {","isFullCredit":false},{"lineNumber":202,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().completeTask(key);","isFullCredit":false},{"lineNumber":203,"author":{"gitId":"-"},"content":"    displayMiniMessage(this.getGameManager(), \u0027Task completed!\u0027);","isFullCredit":false},{"lineNumber":204,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":205,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":206,"author":{"gitId":"-"},"content":"  public showTask(key: string): void {","isFullCredit":false},{"lineNumber":207,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().showTask(key);","isFullCredit":false},{"lineNumber":208,"author":{"gitId":"-"},"content":"    displayMiniMessage(this.getGameManager(), \u0027New task added\u0027);","isFullCredit":false},{"lineNumber":209,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":210,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":211,"author":{"gitId":"-"},"content":"  public getAllVisibleTaskData(): Array\u003c[TaskDetail, boolean]\u003e {","isFullCredit":false},{"lineNumber":212,"author":{"gitId":"-"},"content":"    return this.getGameManager().getStateManager().getAllVisibleTaskData();","isFullCredit":false},{"lineNumber":213,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":214,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":215,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":216,"author":{"gitId":"-"},"content":"  //   User State    //","isFullCredit":false},{"lineNumber":217,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":218,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":219,"author":{"gitId":"-"},"content":"  public addCollectible(id: string): void {","isFullCredit":false},{"lineNumber":220,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getUserStateManager().addCollectible(id);","isFullCredit":false},{"lineNumber":221,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":222,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":223,"author":{"gitId":"-"},"content":"  public async isInUserState(userStateType: UserStateType, id: string): Promise\u003cboolean\u003e {","isFullCredit":false},{"lineNumber":224,"author":{"gitId":"-"},"content":"    return SourceAcademyGame.getInstance().getUserStateManager().isInUserState(userStateType, id);","isFullCredit":false},{"lineNumber":225,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":226,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":227,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":228,"author":{"gitId":"-"},"content":"  //   Game Layer    //","isFullCredit":false},{"lineNumber":229,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":230,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":231,"author":{"gitId":"-"},"content":"  public clearSeveralLayers(layerTypes: Layer[]) {","isFullCredit":false},{"lineNumber":232,"author":{"gitId":"-"},"content":"    this.getGameManager().getLayerManager().clearSeveralLayers(layerTypes);","isFullCredit":false},{"lineNumber":233,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":234,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":235,"author":{"gitId":"-"},"content":"  public addToLayer(layer: Layer, gameObj: Phaser.GameObjects.GameObject) {","isFullCredit":false},{"lineNumber":236,"author":{"gitId":"-"},"content":"    this.getGameManager().getLayerManager().addToLayer(layer, gameObj);","isFullCredit":false},{"lineNumber":237,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":238,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":239,"author":{"gitId":"-"},"content":"  public showLayer(layer: Layer) {","isFullCredit":false},{"lineNumber":240,"author":{"gitId":"-"},"content":"    this.getGameManager().getLayerManager().showLayer(layer);","isFullCredit":false},{"lineNumber":241,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":242,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":243,"author":{"gitId":"-"},"content":"  public hideLayer(layer: Layer) {","isFullCredit":false},{"lineNumber":244,"author":{"gitId":"-"},"content":"    this.getGameManager().getLayerManager().hideLayer(layer);","isFullCredit":false},{"lineNumber":245,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":246,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":247,"author":{"gitId":"-"},"content":"  public async fadeInLayer(layer: Layer, fadeDuration?: number) {","isFullCredit":false},{"lineNumber":248,"author":{"gitId":"-"},"content":"    await this.getGameManager().getLayerManager().fadeInLayer(layer, fadeDuration);","isFullCredit":false},{"lineNumber":249,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":250,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":251,"author":{"gitId":"-"},"content":"  public async fadeOutLayer(layer: Layer, fadeDuration?: number) {","isFullCredit":false},{"lineNumber":252,"author":{"gitId":"-"},"content":"    await this.getGameManager().getLayerManager().fadeOutLayer(layer, fadeDuration);","isFullCredit":false},{"lineNumber":253,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":254,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":255,"author":{"gitId":"-"},"content":"  //  Location Notif //","isFullCredit":false},{"lineNumber":256,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":257,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":258,"author":{"gitId":"-"},"content":"  public async bringUpUpdateNotif(message: string) {","isFullCredit":false},{"lineNumber":259,"author":{"gitId":"-"},"content":"    await displayNotification(this.getGameManager(), message);","isFullCredit":false},{"lineNumber":260,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":261,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":262,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":263,"author":{"gitId":"-"},"content":"  //   Story Action  //","isFullCredit":false},{"lineNumber":264,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":265,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":266,"author":{"gitId":"-"},"content":"  public async processGameActions(actionIds: ItemId[] | undefined) {","isFullCredit":false},{"lineNumber":267,"author":{"gitId":"-"},"content":"    await this.getGameManager().getPhaseManager().pushPhase(GamePhaseType.Sequence);","isFullCredit":false},{"lineNumber":268,"author":{"gitId":"-"},"content":"    await this.getGameManager().getActionManager().processGameActions(actionIds);","isFullCredit":false},{"lineNumber":269,"author":{"gitId":"-"},"content":"    await this.getGameManager().getPhaseManager().popPhase();","isFullCredit":false},{"lineNumber":270,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":271,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":272,"author":{"gitId":"-"},"content":"  public async processGameActionsInSamePhase(actionIds: ItemId[] | undefined) {","isFullCredit":false},{"lineNumber":273,"author":{"gitId":"-"},"content":"    await this.getGameManager().getActionManager().processGameActions(actionIds);","isFullCredit":false},{"lineNumber":274,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":275,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":276,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":277,"author":{"gitId":"-"},"content":"  //   Dialogue      //","isFullCredit":false},{"lineNumber":278,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":279,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":280,"author":{"gitId":"-"},"content":"  public async showDialogue(dialogueId: ItemId) {","isFullCredit":false},{"lineNumber":281,"author":{"gitId":"-"},"content":"    await this.getGameManager().getPhaseManager().pushPhase(GamePhaseType.Sequence);","isFullCredit":false},{"lineNumber":282,"author":{"gitId":"-"},"content":"    await this.getGameManager().getDialogueManager().showDialogue(dialogueId);","isFullCredit":false},{"lineNumber":283,"author":{"gitId":"-"},"content":"    await this.getGameManager().getPhaseManager().popPhase();","isFullCredit":false},{"lineNumber":284,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":285,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":286,"author":{"gitId":"-"},"content":"  public async showDialogueInSamePhase(dialogueId: ItemId) {","isFullCredit":false},{"lineNumber":287,"author":{"gitId":"-"},"content":"    await this.getGameManager().getDialogueManager().showDialogue(dialogueId);","isFullCredit":false},{"lineNumber":288,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":289,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":290,"author":{"gitId":"CYX22222003"},"content":"  public async showNextLine(resolve: () \u003d\u003e void) {","isFullCredit":false},{"lineNumber":291,"author":{"gitId":"CYX22222003"},"content":"    await this.getGameManager().getDialogueManager().showNextLine(resolve);","isFullCredit":false},{"lineNumber":292,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":293,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":294,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":295,"author":{"gitId":"-"},"content":"  //   Storage      //","isFullCredit":false},{"lineNumber":296,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":297,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":298,"author":{"gitId":"-"},"content":"  public storeDialogueLine(newLine: string, newSpeakerDetail?: SpeakerDetail | null) {","isFullCredit":false},{"lineNumber":299,"author":{"gitId":"-"},"content":"    this.getGameManager().getDialogueStorageManager().storeLine(newLine, newSpeakerDetail);","isFullCredit":false},{"lineNumber":300,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":301,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":302,"author":{"gitId":"-"},"content":"  public getDialogueStorage() {","isFullCredit":false},{"lineNumber":303,"author":{"gitId":"-"},"content":"    return this.getGameManager().getDialogueStorageManager().getDialogueStorage();","isFullCredit":false},{"lineNumber":304,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":305,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":306,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":307,"author":{"gitId":"-"},"content":"  //   Collectible   //","isFullCredit":false},{"lineNumber":308,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":309,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":310,"author":{"gitId":"-"},"content":"  public async obtainCollectible(collectibleId: string) {","isFullCredit":false},{"lineNumber":311,"author":{"gitId":"-"},"content":"    displayMiniMessage(this.getGameManager(), `Obtained ${getAwardProp(collectibleId).title}`);","isFullCredit":false},{"lineNumber":312,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getUserStateManager().addCollectible(collectibleId);","isFullCredit":false},{"lineNumber":313,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":314,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":315,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":316,"author":{"gitId":"-"},"content":"  //     Pop Up      //","isFullCredit":false},{"lineNumber":317,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":318,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":319,"author":{"gitId":"-"},"content":"  public displayPopUp(itemId: ItemId, position: GamePosition, duration?: number, size?: GameSize) {","isFullCredit":false},{"lineNumber":320,"author":{"gitId":"-"},"content":"    this.getGameManager().getPopupManager().displayPopUp(itemId, position, duration, size);","isFullCredit":false},{"lineNumber":321,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":322,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":323,"author":{"gitId":"-"},"content":"  public destroyAllPopUps() {","isFullCredit":false},{"lineNumber":324,"author":{"gitId":"-"},"content":"    this.getGameManager().getPopupManager().destroyAllPopUps();","isFullCredit":false},{"lineNumber":325,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":326,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":327,"author":{"gitId":"-"},"content":"  public async destroyPopUp(position: GamePosition) {","isFullCredit":false},{"lineNumber":328,"author":{"gitId":"-"},"content":"    this.getGameManager().getPopupManager().destroyPopUp(position);","isFullCredit":false},{"lineNumber":329,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":330,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":331,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":332,"author":{"gitId":"-"},"content":"  //    Save Game    //","isFullCredit":false},{"lineNumber":333,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":334,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":335,"author":{"gitId":"-"},"content":"  public async saveGame() {","isFullCredit":false},{"lineNumber":336,"author":{"gitId":"-"},"content":"    await this.getGameManager().getSaveManager().saveGame();","isFullCredit":false},{"lineNumber":337,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":338,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":339,"author":{"gitId":"-"},"content":"  public async saveSettings(settingsJson: SettingsJson) {","isFullCredit":false},{"lineNumber":340,"author":{"gitId":"-"},"content":"    await this.getGameManager().getSaveManager().saveSettings(settingsJson);","isFullCredit":false},{"lineNumber":341,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":342,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":343,"author":{"gitId":"-"},"content":"  public getLoadedUserState() {","isFullCredit":false},{"lineNumber":344,"author":{"gitId":"-"},"content":"    return this.getGameManager().getSaveManager().getLoadedUserState();","isFullCredit":false},{"lineNumber":345,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":346,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":347,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":348,"author":{"gitId":"-"},"content":"  //      Sound      //","isFullCredit":false},{"lineNumber":349,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":350,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":351,"author":{"gitId":"-"},"content":"  public getSoundManager() {","isFullCredit":false},{"lineNumber":352,"author":{"gitId":"-"},"content":"    return SourceAcademyGame.getInstance().getSoundManager();","isFullCredit":false},{"lineNumber":353,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":354,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":355,"author":{"gitId":"-"},"content":"  public playSound(soundKey: AssetKey) {","isFullCredit":false},{"lineNumber":356,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getSoundManager().playSound(soundKey);","isFullCredit":false},{"lineNumber":357,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":358,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":359,"author":{"gitId":"-"},"content":"  public playBgMusic(soundKey: AssetKey) {","isFullCredit":false},{"lineNumber":360,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getSoundManager().playBgMusic(soundKey);","isFullCredit":false},{"lineNumber":361,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":362,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":363,"author":{"gitId":"-"},"content":"  public async stopAllSound() {","isFullCredit":false},{"lineNumber":364,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getSoundManager().stopAllSound();","isFullCredit":false},{"lineNumber":365,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":366,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":367,"author":{"gitId":"-"},"content":"  public pauseCurrBgMusic() {","isFullCredit":false},{"lineNumber":368,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getSoundManager().pauseCurrBgMusic();","isFullCredit":false},{"lineNumber":369,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":370,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":371,"author":{"gitId":"-"},"content":"  public continueCurrBgMusic() {","isFullCredit":false},{"lineNumber":372,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getSoundManager().continueCurrBgMusic();","isFullCredit":false},{"lineNumber":373,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":374,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":375,"author":{"gitId":"-"},"content":"  public applySoundSettings(userSettings: SettingsJson) {","isFullCredit":false},{"lineNumber":376,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getSoundManager().applyUserSettings(userSettings);","isFullCredit":false},{"lineNumber":377,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":378,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":379,"author":{"gitId":"-"},"content":"  public loadSounds(soundAssets: SoundAsset[]) {","isFullCredit":false},{"lineNumber":380,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().getSoundManager().loadSounds(soundAssets);","isFullCredit":false},{"lineNumber":381,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":382,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":383,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":384,"author":{"gitId":"-"},"content":"  //    Animations   //","isFullCredit":false},{"lineNumber":385,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":386,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":387,"author":{"gitId":"-"},"content":"  public startAnimation(id: AnyId, startFrame: number, frameRate: number) {","isFullCredit":false},{"lineNumber":388,"author":{"gitId":"-"},"content":"    const startImage \u003d this.getAssetByKey(this.getGameMap().getAssetKeyFromId(id));","isFullCredit":false},{"lineNumber":389,"author":{"gitId":"-"},"content":"    this.getGameManager().getAnimationManager().displayAnimation(startImage, startFrame, frameRate);","isFullCredit":false},{"lineNumber":390,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":391,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":392,"author":{"gitId":"-"},"content":"  public stopAnimation(id: AnyId) {","isFullCredit":false},{"lineNumber":393,"author":{"gitId":"-"},"content":"    const stopImage \u003d this.getAssetByKey(this.getGameMap().getAssetKeyFromId(id));","isFullCredit":false},{"lineNumber":394,"author":{"gitId":"-"},"content":"    this.getGameManager().getAnimationManager().stopAnimation(stopImage);","isFullCredit":false},{"lineNumber":395,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":396,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":397,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":398,"author":{"gitId":"-"},"content":"  //      Input      //","isFullCredit":false},{"lineNumber":399,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":400,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":401,"author":{"gitId":"-"},"content":"  public setDefaultCursor(cursor: string) {","isFullCredit":false},{"lineNumber":402,"author":{"gitId":"-"},"content":"    this.getGameManager().getInputManager().setDefaultCursor(cursor);","isFullCredit":false},{"lineNumber":403,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":404,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":405,"author":{"gitId":"-"},"content":"  public enableKeyboardInput(active: boolean) {","isFullCredit":false},{"lineNumber":406,"author":{"gitId":"-"},"content":"    this.getGameManager().getInputManager().enableKeyboardInput(active);","isFullCredit":false},{"lineNumber":407,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":408,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":409,"author":{"gitId":"-"},"content":"  public enableMouseInput(active: boolean) {","isFullCredit":false},{"lineNumber":410,"author":{"gitId":"-"},"content":"    this.getGameManager().getInputManager().enableMouseInput(active);","isFullCredit":false},{"lineNumber":411,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":412,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":413,"author":{"gitId":"-"},"content":"  public enableSprite(gameObject: Phaser.GameObjects.GameObject, active: boolean) {","isFullCredit":false},{"lineNumber":414,"author":{"gitId":"-"},"content":"    if (active) {","isFullCredit":false},{"lineNumber":415,"author":{"gitId":"-"},"content":"      this.getGameManager().input.enable(gameObject);","isFullCredit":false},{"lineNumber":416,"author":{"gitId":"-"},"content":"    } else {","isFullCredit":false},{"lineNumber":417,"author":{"gitId":"-"},"content":"      this.getGameManager().input.disable(gameObject);","isFullCredit":false},{"lineNumber":418,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":419,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":420,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":421,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":422,"author":{"gitId":"-"},"content":"  //      Phases     //","isFullCredit":false},{"lineNumber":423,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":424,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":425,"author":{"gitId":"-"},"content":"  public async popPhase() {","isFullCredit":false},{"lineNumber":426,"author":{"gitId":"-"},"content":"    await this.getGameManager().getPhaseManager().popPhase();","isFullCredit":false},{"lineNumber":427,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":428,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":429,"author":{"gitId":"-"},"content":"  public async pushPhase(gamePhaseType: GamePhaseType) {","isFullCredit":false},{"lineNumber":430,"author":{"gitId":"-"},"content":"    await this.getGameManager().getPhaseManager().pushPhase(gamePhaseType);","isFullCredit":false},{"lineNumber":431,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":432,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":433,"author":{"gitId":"-"},"content":"  public async swapPhase(gamePhaseType: GamePhaseType) {","isFullCredit":false},{"lineNumber":434,"author":{"gitId":"-"},"content":"    await this.getGameManager().getPhaseManager().swapPhase(gamePhaseType);","isFullCredit":false},{"lineNumber":435,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":436,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":437,"author":{"gitId":"-"},"content":"  public isCurrentPhase(gamePhaseType: GamePhaseType) {","isFullCredit":false},{"lineNumber":438,"author":{"gitId":"-"},"content":"    return this.getGameManager().getPhaseManager().isCurrentPhase(gamePhaseType);","isFullCredit":false},{"lineNumber":439,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":440,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":441,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":442,"author":{"gitId":"-"},"content":"  //   Background    //","isFullCredit":false},{"lineNumber":443,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":444,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":445,"author":{"gitId":"-"},"content":"  public renderBackgroundLayerContainer(locationId: LocationId) {","isFullCredit":false},{"lineNumber":446,"author":{"gitId":"-"},"content":"    this.getGameManager().getBackgroundManager().renderBackgroundLayerContainer(locationId);","isFullCredit":false},{"lineNumber":447,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":448,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":449,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":450,"author":{"gitId":"-"},"content":"  //    Assessment   //","isFullCredit":false},{"lineNumber":451,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":452,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":453,"author":{"gitId":"-"},"content":"  public async promptNavigateToAssessment(assessmentId: number) {","isFullCredit":false},{"lineNumber":454,"author":{"gitId":"-"},"content":"    const response \u003d await promptWithChoices(","isFullCredit":false},{"lineNumber":455,"author":{"gitId":"-"},"content":"      GameGlobalAPI.getInstance().getGameManager(),","isFullCredit":false},{"lineNumber":456,"author":{"gitId":"-"},"content":"      `Are you ready for the challenge?`,","isFullCredit":false},{"lineNumber":457,"author":{"gitId":"-"},"content":"      [\u0027Yes\u0027, \u0027No\u0027]","isFullCredit":false},{"lineNumber":458,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":459,"author":{"gitId":"-"},"content":"    if (response \u003d\u003d\u003d 0) {","isFullCredit":false},{"lineNumber":460,"author":{"gitId":"-"},"content":"      window.open(`/courses/${courseId()}/missions/${assessmentId}/0`, \u0027blank\u0027);","isFullCredit":false},{"lineNumber":461,"author":{"gitId":"-"},"content":"      window.focus();","isFullCredit":false},{"lineNumber":462,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":463,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":464,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":465,"author":{"gitId":"-"},"content":"  public async updateAssessmentState() {","isFullCredit":false},{"lineNumber":466,"author":{"gitId":"-"},"content":"    await SourceAcademyGame.getInstance().getUserStateManager().loadAssessments();","isFullCredit":false},{"lineNumber":467,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":468,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":469,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":470,"author":{"gitId":"-"},"content":"  //   Characters    //","isFullCredit":false},{"lineNumber":471,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":472,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":473,"author":{"gitId":"-"},"content":"  public createCharacterSprite(","isFullCredit":false},{"lineNumber":474,"author":{"gitId":"-"},"content":"    characterId: ItemId,","isFullCredit":false},{"lineNumber":475,"author":{"gitId":"-"},"content":"    overrideExpression?: string,","isFullCredit":false},{"lineNumber":476,"author":{"gitId":"-"},"content":"    overridePosition?: GamePosition","isFullCredit":false},{"lineNumber":477,"author":{"gitId":"-"},"content":"  ) {","isFullCredit":false},{"lineNumber":478,"author":{"gitId":"-"},"content":"    return this.getGameManager()","isFullCredit":false},{"lineNumber":479,"author":{"gitId":"-"},"content":"      .getCharacterManager()","isFullCredit":false},{"lineNumber":480,"author":{"gitId":"-"},"content":"      .createCharacterSprite(characterId, overrideExpression, overridePosition);","isFullCredit":false},{"lineNumber":481,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":482,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":483,"author":{"gitId":"-"},"content":"  public moveCharacter(id: ItemId, newLocation: LocationId, newPosition: GamePosition) {","isFullCredit":false},{"lineNumber":484,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().moveCharacter(id, newLocation, newPosition);","isFullCredit":false},{"lineNumber":485,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":486,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":487,"author":{"gitId":"-"},"content":"  public updateCharacter(id: ItemId, expression: string) {","isFullCredit":false},{"lineNumber":488,"author":{"gitId":"-"},"content":"    this.getGameManager().getStateManager().updateCharacter(id, expression);","isFullCredit":false},{"lineNumber":489,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":490,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":491,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":492,"author":{"gitId":"-"},"content":"  //  Item retrieval //","isFullCredit":false},{"lineNumber":493,"author":{"gitId":"-"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":494,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":495,"author":{"gitId":"-"},"content":"  public getDialogueById(dialogueId: ItemId): Dialogue {","isFullCredit":false},{"lineNumber":496,"author":{"gitId":"-"},"content":"    return mandatory(this.getGameMap().getDialogueMap().get(dialogueId));","isFullCredit":false},{"lineNumber":497,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":498,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":499,"author":{"gitId":"-"},"content":"  public getCharacterById(characterId: ItemId): Character {","isFullCredit":false},{"lineNumber":500,"author":{"gitId":"-"},"content":"    return mandatory(this.getGameMap().getCharacterMap().get(characterId));","isFullCredit":false},{"lineNumber":501,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":502,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":503,"author":{"gitId":"-"},"content":"  public getActionById(actionId: ItemId): GameAction {","isFullCredit":false},{"lineNumber":504,"author":{"gitId":"-"},"content":"    return mandatory(this.getGameMap().getActionMap().get(actionId));","isFullCredit":false},{"lineNumber":505,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":506,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":507,"author":{"gitId":"-"},"content":"  public getObjectById(objectId: ItemId): ObjectProperty {","isFullCredit":false},{"lineNumber":508,"author":{"gitId":"-"},"content":"    return mandatory(this.getGameMap().getObjectPropMap().get(objectId));","isFullCredit":false},{"lineNumber":509,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":510,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":511,"author":{"gitId":"-"},"content":"  public getBBoxById(bboxId: ItemId): BBoxProperty {","isFullCredit":false},{"lineNumber":512,"author":{"gitId":"-"},"content":"    return mandatory(this.getGameMap().getBBoxPropMap().get(bboxId));","isFullCredit":false},{"lineNumber":513,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":514,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":515,"author":{"gitId":"CYX22222003"},"content":"  public getQuizById(quizId: ItemId): Quiz {","isFullCredit":false},{"lineNumber":516,"author":{"gitId":"CYX22222003"},"content":"    return mandatory(this.getGameMap().getQuizMap().get(quizId));","isFullCredit":false},{"lineNumber":517,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":518,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":519,"author":{"gitId":"-"},"content":"  public getAssetByKey(assetKey: AssetKey) {","isFullCredit":false},{"lineNumber":520,"author":{"gitId":"-"},"content":"    return this.getGameMap().getAssetByKey(assetKey);","isFullCredit":false},{"lineNumber":521,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":522,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":523,"author":{"gitId":"CYX22222003"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":524,"author":{"gitId":"CYX22222003"},"content":"  //      Quiz       //","isFullCredit":false},{"lineNumber":525,"author":{"gitId":"CYX22222003"},"content":"  /////////////////////","isFullCredit":false},{"lineNumber":526,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":527,"author":{"gitId":"CYX22222003"},"content":"  public async showQuiz(quizId: ItemId) {","isFullCredit":false},{"lineNumber":528,"author":{"gitId":"CYX22222003"},"content":"    await this.getGameManager().getQuizManager().showQuiz(quizId);","isFullCredit":false},{"lineNumber":529,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":530,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":531,"author":{"gitId":"CYX22222003"},"content":"  public getQuizLength(quizId: ItemId): number {","isFullCredit":false},{"lineNumber":532,"author":{"gitId":"CYX22222003"},"content":"    return this.getGameManager().getQuizManager().getNumOfQns(quizId);","isFullCredit":false},{"lineNumber":533,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":534,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":535,"author":{"gitId":"CYX22222003"},"content":"  public isQuizAttempted(key: string): boolean {","isFullCredit":false},{"lineNumber":536,"author":{"gitId":"CYX22222003"},"content":"    return this.getGameManager().getStateManager().isQuizAttempted(key);","isFullCredit":false},{"lineNumber":537,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":538,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":539,"author":{"gitId":"CYX22222003"},"content":"  public isQuizComplete(key: string): boolean {","isFullCredit":false},{"lineNumber":540,"author":{"gitId":"CYX22222003"},"content":"    return this.getGameManager().getStateManager().isQuizComplete(key);","isFullCredit":false},{"lineNumber":541,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":542,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":543,"author":{"gitId":"CYX22222003"},"content":"  public setQuizScore(key: string, score: number): void {","isFullCredit":false},{"lineNumber":544,"author":{"gitId":"CYX22222003"},"content":"    this.getGameManager().getStateManager().setQuizScore(key, score);","isFullCredit":false},{"lineNumber":545,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":546,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":547,"author":{"gitId":"CYX22222003"},"content":"  public getQuizScore(key: string): number {","isFullCredit":false},{"lineNumber":548,"author":{"gitId":"CYX22222003"},"content":"    return this.getGameManager().getStateManager().getQuizScore(key);","isFullCredit":false},{"lineNumber":549,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":550,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":551,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":552,"author":{"gitId":"-"},"content":"export default GameGlobalAPI;","isFullCredit":false}],"authorContributionMap":{"CYX22222003":38,"-":514}},{"path":"src/features/game/scenes/gameManager/GameManager.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import GameActionManager from \u0027../../action/GameActionManager\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import GameAnimationManager from \u0027../../animations/GameAnimationManager\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { AssetType, ImageAsset } from \u0027../../assets/AssetsTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import GameAwardsManager from \u0027../../awards/GameAwardsManager\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import GameBackgroundManager from \u0027../../background/GameBackgroundManager\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import GameBBoxManager from \u0027../../boundingBoxes/GameBoundingBoxManager\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import { GameCheckpoint } from \u0027../../chapter/GameChapterTypes\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import GameCharacterManager from \u0027../../character/GameCharacterManager\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"import { Constants } from \u0027../../commons/CommonConstants\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"import { AssetKey } from \u0027../../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"import GameDashboardManager from \u0027../../dashboard/GameDashboardManager\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"import { DashboardPage } from \u0027../../dashboard/GameDashboardTypes\u0027;","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"import GameDialogueManager from \u0027../../dialogue/GameDialogueManager\u0027;","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"import GameDialogueStorageManager from \u0027../../dialogue/GameDialogueStorageManager\u0027;","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"import { blackFade, blackScreen, fadeIn } from \u0027../../effects/FadeEffect\u0027;","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"import { addLoadingScreen } from \u0027../../effects/LoadingScreen\u0027;","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"import GameEscapeManager from \u0027../../escape/GameEscapeManager\u0027;","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"import { keyboardShortcuts } from \u0027../../input/GameInputConstants\u0027;","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"import GameInputManager from \u0027../../input/GameInputManager\u0027;","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"import GameLayerManager from \u0027../../layer/GameLayerManager\u0027;","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"import { Layer } from \u0027../../layer/GameLayerTypes\u0027;","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":"import { LocationId } from \u0027../../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":"import { GameItemType } from \u0027../../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":"import GameLogManager from \u0027../../log/GameLogManager\u0027;","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"import { GameMode } from \u0027../../mode/GameModeTypes\u0027;","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"import GameObjectManager from \u0027../../objects/GameObjectManager\u0027;","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"import GamePhaseManager from \u0027../../phase/GamePhaseManager\u0027;","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"import { GamePhaseType } from \u0027../../phase/GamePhaseTypes\u0027;","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"import GamePopUpManager from \u0027../../popUp/GamePopUpManager\u0027;","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"CYX22222003"},"content":"import GameQuizManager from \u0027../../quiz/GameQuizManager\u0027;","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"import GameStateManager from \u0027../../state/GameStateManager\u0027;","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"import GameTaskLogManager from \u0027../../task/GameTaskLogManager\u0027;","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"import GameToolbarManager from \u0027../../toolbar/GameToolbarManager\u0027;","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"import { mandatory, sleep, toS3Path } from \u0027../../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027./GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"import { createGamePhases } from \u0027./GameManagerHelper\u0027;","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"type GameManagerProps \u003d {","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"  continueGame: boolean;","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"  chapterNum: number;","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"  checkpointNum: number;","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"  gameCheckpoint: GameCheckpoint;","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"};","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":" * Main scene that plays the checkpoint.","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":" * It processes checkpoint objects and loads","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"-"},"content":" * the chapter exclusive assets (location image, sounds).","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":" * It also handles main gameplay loop, e.g. switching between modes,","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":" * activation of escape or collectible menu, location switching,","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":" * triggering actions, etc.","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"class GameManager extends Phaser.Scene {","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"  public currentLocationId: LocationId;","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"  public hasTransitioned: boolean;","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"  private stateManager?: GameStateManager;","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"  private layerManager?: GameLayerManager;","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"  private objectManager?: GameObjectManager;","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"  private characterManager?: GameCharacterManager;","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"  private dialogueManager?: GameDialogueManager;","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"  private actionManager?: GameActionManager;","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"  private boundingBoxManager?: GameBBoxManager;","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"  private popUpManager?: GamePopUpManager;","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"  private phaseManager?: GamePhaseManager;","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"  private backgroundManager?: GameBackgroundManager;","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"  private animationManager?: GameAnimationManager;","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"  private inputManager?: GameInputManager;","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"  private escapeManager?: GameEscapeManager;","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"  private collectibleManager?: GameAwardsManager;","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"  private achievementManager?: GameAwardsManager;","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"  private logManager?: GameLogManager;","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"  private dialogueStorageManager?: GameDialogueStorageManager;","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"  private toolbarManager?: GameToolbarManager;","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"  private taskLogManager?: GameTaskLogManager;","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"  private dashboardManager?: GameDashboardManager;","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"CYX22222003"},"content":"  private quizManager?: GameQuizManager;","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"  constructor() {","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"    super(\u0027GameManager\u0027);","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"    this.currentLocationId \u003d Constants.nullInteractionId;","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"    this.hasTransitioned \u003d false;","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"-"},"content":"  public init({ gameCheckpoint, continueGame, chapterNum, checkpointNum }: GameManagerProps) {","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().setGameManager(this);","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"    SourceAcademyGame.getInstance().setCurrentSceneRef(this);","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"    this.getSaveManager().registerGameInfo(chapterNum, checkpointNum, continueGame);","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"    this.currentLocationId \u003d","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"      this.getSaveManager().getLoadedLocation() || gameCheckpoint.startingLoc;","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"    this.hasTransitioned \u003d false;","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"    this.stateManager \u003d new GameStateManager(gameCheckpoint);","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"    this.layerManager \u003d new GameLayerManager(this);","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"    this.inputManager \u003d new GameInputManager(this);","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"    this.phaseManager \u003d new GamePhaseManager(createGamePhases(), this.inputManager);","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"    this.characterManager \u003d new GameCharacterManager();","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"    this.objectManager \u003d new GameObjectManager();","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"    this.dialogueManager \u003d new GameDialogueManager();","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"    this.actionManager \u003d new GameActionManager();","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"    this.boundingBoxManager \u003d new GameBBoxManager();","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"    this.backgroundManager \u003d new GameBackgroundManager();","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"    this.animationManager \u003d new GameAnimationManager();","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"    this.popUpManager \u003d new GamePopUpManager();","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"    this.escapeManager \u003d new GameEscapeManager(this);","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"    this.collectibleManager \u003d new GameAwardsManager(","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"      this,","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"      SourceAcademyGame.getInstance().getUserStateManager().getCollectibles","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"    this.achievementManager \u003d new GameAwardsManager(","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"      this,","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"      SourceAcademyGame.getInstance().getUserStateManager().getAchievements","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"    this.logManager \u003d new GameLogManager(this);","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"    this.dialogueStorageManager \u003d new GameDialogueStorageManager();","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"    this.toolbarManager \u003d new GameToolbarManager(this);","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"    this.taskLogManager \u003d new GameTaskLogManager(this);","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"    this.dashboardManager \u003d new GameDashboardManager(","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"      this,","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"      [","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"        DashboardPage.Log,","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"        DashboardPage.Tasks,","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"        DashboardPage.Collectibles,","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"        DashboardPage.Achievements","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"      ],","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"      [this.logManager, this.taskLogManager, this.collectibleManager, this.achievementManager]","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"CYX22222003"},"content":"    this.quizManager \u003d new GameQuizManager();","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"  //////////////////////","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"  //    Preload       //","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"  //////////////////////","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"  public preload() {","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"    addLoadingScreen(this);","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"    this.getPhaseManager().setInterruptCheckCallback(","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"      (prevPhase: GamePhaseType, newPhase: GamePhaseType) \u003d\u003e","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"        this.transitionChecker(prevPhase, newPhase)","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"    this.getPhaseManager().setInterruptCallback(","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"      async (prevPhase: GamePhaseType, newPhase: GamePhaseType) \u003d\u003e await this.checkpointTransition()","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"    this.getPhaseManager().setCallback(","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"      async (prevPhase: GamePhaseType, newPhase: GamePhaseType) \u003d\u003e","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"-"},"content":"        await this.handleCharacterLayer(prevPhase, newPhase)","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"-"},"content":"    this.preloadLocationsAssets();","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"-"},"content":"    this.bindKeyboardTriggers();","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"-"},"content":"   * Preload all assets (image and sounds) exclusive to the checkpoint\u0027s gamemap.","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"-"},"content":"  private preloadLocationsAssets() {","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"-"},"content":"    const gameMap \u003d this.getStateManager().getGameMap();","isFullCredit":false},{"lineNumber":159,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().loadSounds(gameMap.getSoundAssets());","isFullCredit":false},{"lineNumber":160,"author":{"gitId":"-"},"content":"    gameMap.getMapAssets().forEach((image, assetKey) \u003d\u003e {","isFullCredit":false},{"lineNumber":161,"author":{"gitId":"-"},"content":"      this.loadImage(image, assetKey);","isFullCredit":false},{"lineNumber":162,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":163,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":164,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":165,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":166,"author":{"gitId":"-"},"content":"   * Loads each asset type (image, sprite) appropriately","isFullCredit":false},{"lineNumber":167,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":168,"author":{"gitId":"-"},"content":"   * @param image ImageAsset object to be loaded","isFullCredit":false},{"lineNumber":169,"author":{"gitId":"-"},"content":"   * @param assetKey asset key of ImageAsset","isFullCredit":false},{"lineNumber":170,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":171,"author":{"gitId":"-"},"content":"  private loadImage(image: ImageAsset, assetKey: AssetKey) {","isFullCredit":false},{"lineNumber":172,"author":{"gitId":"-"},"content":"    switch (image.type) {","isFullCredit":false},{"lineNumber":173,"author":{"gitId":"-"},"content":"      case AssetType.Image:","isFullCredit":false},{"lineNumber":174,"author":{"gitId":"-"},"content":"        this.load.image(assetKey, toS3Path(image.path, true));","isFullCredit":false},{"lineNumber":175,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":176,"author":{"gitId":"-"},"content":"      case AssetType.Sprite:","isFullCredit":false},{"lineNumber":177,"author":{"gitId":"-"},"content":"        this.load.spritesheet(assetKey, toS3Path(image.path, true), image.config);","isFullCredit":false},{"lineNumber":178,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":179,"author":{"gitId":"-"},"content":"      default:","isFullCredit":false},{"lineNumber":180,"author":{"gitId":"-"},"content":"        break;","isFullCredit":false},{"lineNumber":181,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":182,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":183,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":184,"author":{"gitId":"-"},"content":"  //////////////////////","isFullCredit":false},{"lineNumber":185,"author":{"gitId":"-"},"content":"  // Location Helpers //","isFullCredit":false},{"lineNumber":186,"author":{"gitId":"-"},"content":"  //////////////////////","isFullCredit":false},{"lineNumber":187,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":188,"author":{"gitId":"-"},"content":"  public async create() {","isFullCredit":false},{"lineNumber":189,"author":{"gitId":"-"},"content":"    GameGlobalAPI.getInstance().hideLayer(Layer.Character);","isFullCredit":false},{"lineNumber":190,"author":{"gitId":"-"},"content":"    await this.changeLocationTo(this.currentLocationId, true);","isFullCredit":false},{"lineNumber":191,"author":{"gitId":"-"},"content":"    await GameGlobalAPI.getInstance().saveGame();","isFullCredit":false},{"lineNumber":192,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":193,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":194,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":195,"author":{"gitId":"-"},"content":"   * Render a location, the assets related to it (objects, character);","isFullCredit":false},{"lineNumber":196,"author":{"gitId":"-"},"content":"   * before executing the following in order (if available):","isFullCredit":false},{"lineNumber":197,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":198,"author":{"gitId":"-"},"content":"   * Start Action, Notification, Cutscene","isFullCredit":false},{"lineNumber":199,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":200,"author":{"gitId":"-"},"content":"   * Start action is only played when startAction argument is set to true;","isFullCredit":false},{"lineNumber":201,"author":{"gitId":"-"},"content":"   * commonly only the first time user loads the checkpoint.","isFullCredit":false},{"lineNumber":202,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":203,"author":{"gitId":"-"},"content":"   * @param locationId id of the location to render","isFullCredit":false},{"lineNumber":204,"author":{"gitId":"-"},"content":"   * @param startAction if set to true, startAction will be executed","isFullCredit":false},{"lineNumber":205,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":206,"author":{"gitId":"-"},"content":"  private async renderLocation(locationId: LocationId, startAction: boolean) {","isFullCredit":false},{"lineNumber":207,"author":{"gitId":"-"},"content":"    const gameLocation \u003d GameGlobalAPI.getInstance().getLocationAtId(locationId);","isFullCredit":false},{"lineNumber":208,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":209,"author":{"gitId":"-"},"content":"    // Render the toolbar in every location","isFullCredit":false},{"lineNumber":210,"author":{"gitId":"-"},"content":"    this.getToolbarManager().renderToolbarContainer();","isFullCredit":false},{"lineNumber":211,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":212,"author":{"gitId":"-"},"content":"    // Play the BGM attached to the location","isFullCredit":false},{"lineNumber":213,"author":{"gitId":"-"},"content":"    await GameGlobalAPI.getInstance().playBgMusic(gameLocation.bgmKey);","isFullCredit":false},{"lineNumber":214,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":215,"author":{"gitId":"-"},"content":"    // Render all assets related to the location","isFullCredit":false},{"lineNumber":216,"author":{"gitId":"-"},"content":"    this.getBackgroundManager().renderBackgroundLayerContainer(locationId);","isFullCredit":false},{"lineNumber":217,"author":{"gitId":"-"},"content":"    this.getObjectManager().renderObjectsLayerContainer(locationId);","isFullCredit":false},{"lineNumber":218,"author":{"gitId":"-"},"content":"    this.getBBoxManager().renderBBoxLayerContainer(locationId);","isFullCredit":false},{"lineNumber":219,"author":{"gitId":"-"},"content":"    this.getCharacterManager().renderCharacterLayerContainer(locationId);","isFullCredit":false},{"lineNumber":220,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":221,"author":{"gitId":"-"},"content":"    await this.getPhaseManager().swapPhase(GamePhaseType.Sequence);","isFullCredit":false},{"lineNumber":222,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":223,"author":{"gitId":"-"},"content":"    if (startAction) {","isFullCredit":false},{"lineNumber":224,"author":{"gitId":"-"},"content":"      // Execute fast forward actions","isFullCredit":false},{"lineNumber":225,"author":{"gitId":"-"},"content":"      await this.getActionManager().fastForwardGameActions(","isFullCredit":false},{"lineNumber":226,"author":{"gitId":"-"},"content":"        this.getStateManager().getTriggeredStateChangeActions()","isFullCredit":false},{"lineNumber":227,"author":{"gitId":"-"},"content":"      );","isFullCredit":false},{"lineNumber":228,"author":{"gitId":"-"},"content":"      // Game start actions","isFullCredit":false},{"lineNumber":229,"author":{"gitId":"-"},"content":"      await this.getActionManager().processGameActions(","isFullCredit":false},{"lineNumber":230,"author":{"gitId":"-"},"content":"        this.getStateManager().getGameMap().getGameStartActions()","isFullCredit":false},{"lineNumber":231,"author":{"gitId":"-"},"content":"      );","isFullCredit":false},{"lineNumber":232,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":233,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":234,"author":{"gitId":"-"},"content":"    // Location cutscene","isFullCredit":false},{"lineNumber":235,"author":{"gitId":"-"},"content":"    await this.getActionManager().processGameActions(gameLocation.actionIds);","isFullCredit":false},{"lineNumber":236,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":237,"author":{"gitId":"-"},"content":"    // Location notification","isFullCredit":false},{"lineNumber":238,"author":{"gitId":"-"},"content":"    if (this.getStateManager().hasLocationNotif(locationId)) {","isFullCredit":false},{"lineNumber":239,"author":{"gitId":"-"},"content":"      await GameGlobalAPI.getInstance().bringUpUpdateNotif(gameLocation.name);","isFullCredit":false},{"lineNumber":240,"author":{"gitId":"-"},"content":"      this.getStateManager().removeLocationNotif(locationId);","isFullCredit":false},{"lineNumber":241,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":242,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":243,"author":{"gitId":"-"},"content":"    if (this.getPhaseManager().isCurrentPhase(GamePhaseType.Sequence)) {","isFullCredit":false},{"lineNumber":244,"author":{"gitId":"-"},"content":"      await this.getPhaseManager().swapPhase(GamePhaseType.Menu);","isFullCredit":false},{"lineNumber":245,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":246,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":247,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":248,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":249,"author":{"gitId":"-"},"content":"   * Change the current location to another location, based on the ID.","isFullCredit":false},{"lineNumber":250,"author":{"gitId":"-"},"content":"   * This will properly clean up the previous location. It is highly","isFullCredit":false},{"lineNumber":251,"author":{"gitId":"-"},"content":"   * encouraged to only change location of the game using this method.","isFullCredit":false},{"lineNumber":252,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":253,"author":{"gitId":"-"},"content":"   * @param locationId id of location to be changed into","isFullCredit":false},{"lineNumber":254,"author":{"gitId":"-"},"content":"   * @param startAction if set to true, start action will be triggered","isFullCredit":false},{"lineNumber":255,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":256,"author":{"gitId":"-"},"content":"  public async changeLocationTo(locationId: LocationId, startAction: boolean \u003d false) {","isFullCredit":false},{"lineNumber":257,"author":{"gitId":"-"},"content":"    this.currentLocationId \u003d locationId;","isFullCredit":false},{"lineNumber":258,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":259,"author":{"gitId":"-"},"content":"    // Transition to the new location","isFullCredit":false},{"lineNumber":260,"author":{"gitId":"-"},"content":"    await blackFade(this, 300, 500, async () \u003d\u003e {","isFullCredit":false},{"lineNumber":261,"author":{"gitId":"-"},"content":"      await this.getLayerManager().clearAllLayers();","isFullCredit":false},{"lineNumber":262,"author":{"gitId":"-"},"content":"      await this.renderLocation(locationId, startAction);","isFullCredit":false},{"lineNumber":263,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":264,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":265,"author":{"gitId":"-"},"content":"    // Update state after location is fully rendered, location has been visited","isFullCredit":false},{"lineNumber":266,"author":{"gitId":"-"},"content":"    this.getStateManager().triggerInteraction(locationId);","isFullCredit":false},{"lineNumber":267,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":268,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":269,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":270,"author":{"gitId":"-"},"content":"   * Bind escape menu, dashboard, and mode selections to keyboard triggers.","isFullCredit":false},{"lineNumber":271,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":272,"author":{"gitId":"-"},"content":"  private bindKeyboardTriggers() {","isFullCredit":false},{"lineNumber":273,"author":{"gitId":"-"},"content":"    this.getInputManager().registerKeyboardListener(keyboardShortcuts.Menu, \u0027up\u0027, async () \u003d\u003e {","isFullCredit":false},{"lineNumber":274,"author":{"gitId":"-"},"content":"      if (this.getPhaseManager().isCurrentPhaseTerminal()) {","isFullCredit":false},{"lineNumber":275,"author":{"gitId":"-"},"content":"        await this.getPhaseManager().popPhase();","isFullCredit":false},{"lineNumber":276,"author":{"gitId":"-"},"content":"      } else {","isFullCredit":false},{"lineNumber":277,"author":{"gitId":"-"},"content":"        await this.getPhaseManager().pushPhase(GamePhaseType.EscapeMenu);","isFullCredit":false},{"lineNumber":278,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":279,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":280,"author":{"gitId":"-"},"content":"    this.getInputManager().registerKeyboardListener(keyboardShortcuts.Dashboard, \u0027up\u0027, async () \u003d\u003e {","isFullCredit":false},{"lineNumber":281,"author":{"gitId":"-"},"content":"      if (this.getPhaseManager().isCurrentPhase(GamePhaseType.Dashboard)) {","isFullCredit":false},{"lineNumber":282,"author":{"gitId":"-"},"content":"        await this.getPhaseManager().popPhase();","isFullCredit":false},{"lineNumber":283,"author":{"gitId":"-"},"content":"      } else if (this.getPhaseManager().isCurrentPhaseTerminal()) {","isFullCredit":false},{"lineNumber":284,"author":{"gitId":"-"},"content":"        await this.getPhaseManager().swapPhase(GamePhaseType.Dashboard);","isFullCredit":false},{"lineNumber":285,"author":{"gitId":"-"},"content":"      } else {","isFullCredit":false},{"lineNumber":286,"author":{"gitId":"-"},"content":"        await this.getPhaseManager().pushPhase(GamePhaseType.Dashboard);","isFullCredit":false},{"lineNumber":287,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":288,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":289,"author":{"gitId":"-"},"content":"    this.registerMenuKeyboardListener(","isFullCredit":false},{"lineNumber":290,"author":{"gitId":"-"},"content":"      keyboardShortcuts.Explore,","isFullCredit":false},{"lineNumber":291,"author":{"gitId":"-"},"content":"      GameMode.Explore,","isFullCredit":false},{"lineNumber":292,"author":{"gitId":"-"},"content":"      GamePhaseType.Explore","isFullCredit":false},{"lineNumber":293,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":294,"author":{"gitId":"-"},"content":"    this.registerMenuKeyboardListener(keyboardShortcuts.Move, GameMode.Move, GamePhaseType.Move);","isFullCredit":false},{"lineNumber":295,"author":{"gitId":"-"},"content":"    this.registerMenuKeyboardListener(keyboardShortcuts.Talk, GameMode.Talk, GamePhaseType.Talk);","isFullCredit":false},{"lineNumber":296,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":297,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":298,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":299,"author":{"gitId":"-"},"content":"   * Helper function to register keyboard listeners for mode selections.","isFullCredit":false},{"lineNumber":300,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":301,"author":{"gitId":"-"},"content":"  private registerMenuKeyboardListener(shortcut: number, mode: GameMode, phase: GamePhaseType) {","isFullCredit":false},{"lineNumber":302,"author":{"gitId":"-"},"content":"    this.getInputManager().registerKeyboardListener(shortcut, \u0027up\u0027, async () \u003d\u003e {","isFullCredit":false},{"lineNumber":303,"author":{"gitId":"-"},"content":"      const modes \u003d this.getCurrentLocationModes();","isFullCredit":false},{"lineNumber":304,"author":{"gitId":"-"},"content":"      if (modes.includes(mode) \u0026\u0026 this.getPhaseManager().isCurrentPhase(GamePhaseType.Menu)) {","isFullCredit":false},{"lineNumber":305,"author":{"gitId":"-"},"content":"        await this.getPhaseManager().pushPhase(phase);","isFullCredit":false},{"lineNumber":306,"author":{"gitId":"-"},"content":"      } else if (this.getPhaseManager().isCurrentPhase(phase)) {","isFullCredit":false},{"lineNumber":307,"author":{"gitId":"-"},"content":"        await this.getPhaseManager().swapPhase(GamePhaseType.Menu);","isFullCredit":false},{"lineNumber":308,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":309,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":310,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":311,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":312,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":313,"author":{"gitId":"-"},"content":"   * the same method from GameModeMenu to get the available modes under current location","isFullCredit":false},{"lineNumber":314,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":315,"author":{"gitId":"-"},"content":"  private getCurrentLocationModes() {","isFullCredit":false},{"lineNumber":316,"author":{"gitId":"-"},"content":"    const currLocId \u003d this.currentLocationId;","isFullCredit":false},{"lineNumber":317,"author":{"gitId":"-"},"content":"    let latestModesInLoc \u003d this.getStateManager().getLocationModes(currLocId);","isFullCredit":false},{"lineNumber":318,"author":{"gitId":"-"},"content":"    const talkTopics \u003d GameGlobalAPI.getInstance().getGameItemsInLocation(","isFullCredit":false},{"lineNumber":319,"author":{"gitId":"-"},"content":"      GameItemType.talkTopics,","isFullCredit":false},{"lineNumber":320,"author":{"gitId":"-"},"content":"      currLocId","isFullCredit":false},{"lineNumber":321,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":322,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":323,"author":{"gitId":"-"},"content":"    // Remove talk mode if there is no talk topics","isFullCredit":false},{"lineNumber":324,"author":{"gitId":"-"},"content":"    if (talkTopics.length \u003d\u003d\u003d 0) {","isFullCredit":false},{"lineNumber":325,"author":{"gitId":"-"},"content":"      latestModesInLoc \u003d latestModesInLoc.filter(mode \u003d\u003e mode !\u003d\u003d GameMode.Talk);","isFullCredit":false},{"lineNumber":326,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":327,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":328,"author":{"gitId":"-"},"content":"    return latestModesInLoc;","isFullCredit":false},{"lineNumber":329,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":330,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":331,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":332,"author":{"gitId":"-"},"content":"   * Clean up on related managers","isFullCredit":false},{"lineNumber":333,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":334,"author":{"gitId":"-"},"content":"  public cleanUp() {","isFullCredit":false},{"lineNumber":335,"author":{"gitId":"-"},"content":"    this.getInputManager().clearListeners();","isFullCredit":false},{"lineNumber":336,"author":{"gitId":"-"},"content":"    this.getLayerManager().clearAllLayers();","isFullCredit":false},{"lineNumber":337,"author":{"gitId":"-"},"content":"    this.getDialogueStorageManager().clearDialogueStorage();","isFullCredit":false},{"lineNumber":338,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":339,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":340,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":341,"author":{"gitId":"-"},"content":"   * Checks whether game is able to transition to the next checkpoint.","isFullCredit":false},{"lineNumber":342,"author":{"gitId":"-"},"content":"   * Game is only able to transition to the next checkpoint","isFullCredit":false},{"lineNumber":343,"author":{"gitId":"-"},"content":"   * if all of the objectives of the current checkpoint has been cleared.","isFullCredit":false},{"lineNumber":344,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":345,"author":{"gitId":"-"},"content":"   * We also do not want to go Transition scene if players have just","isFullCredit":false},{"lineNumber":346,"author":{"gitId":"-"},"content":"   * completed the chapter so that they can don\u0027t get kicked out of the","isFullCredit":false},{"lineNumber":347,"author":{"gitId":"-"},"content":"   * chapter if they\u0027ve already finished it before.","isFullCredit":false},{"lineNumber":348,"author":{"gitId":"-"},"content":"   * This is unless they press replay, which sets their chapNewlyCompleted back to false.","isFullCredit":false},{"lineNumber":349,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":350,"author":{"gitId":"-"},"content":"   * Additionally, game will only transition if the newPhase is not Sequence phase;","isFullCredit":false},{"lineNumber":351,"author":{"gitId":"-"},"content":"   * in order to ensure that we don\u0027t transition to the next checkpoint","isFullCredit":false},{"lineNumber":352,"author":{"gitId":"-"},"content":"   * during dialogue/cutscene.","isFullCredit":false},{"lineNumber":353,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":354,"author":{"gitId":"-"},"content":"   * This method is passed to the phase manager, as the interrupt checker.","isFullCredit":false},{"lineNumber":355,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":356,"author":{"gitId":"-"},"content":"   * @param prevPhase previous phase to transition from","isFullCredit":false},{"lineNumber":357,"author":{"gitId":"-"},"content":"   * @param newPhase new phase to transition to","isFullCredit":false},{"lineNumber":358,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":359,"author":{"gitId":"-"},"content":"  public transitionChecker(prevPhase: GamePhaseType, newPhase: GamePhaseType) {","isFullCredit":false},{"lineNumber":360,"author":{"gitId":"-"},"content":"    return (","isFullCredit":false},{"lineNumber":361,"author":{"gitId":"-"},"content":"      !this.hasTransitioned \u0026\u0026","isFullCredit":false},{"lineNumber":362,"author":{"gitId":"-"},"content":"      newPhase !\u003d\u003d GamePhaseType.Sequence \u0026\u0026","isFullCredit":false},{"lineNumber":363,"author":{"gitId":"-"},"content":"      GameGlobalAPI.getInstance().areAllObjectivesComplete() \u0026\u0026","isFullCredit":false},{"lineNumber":364,"author":{"gitId":"-"},"content":"      !this.getStateManager().getChapterNewlyCompleted()","isFullCredit":false},{"lineNumber":365,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":366,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":367,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":368,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":369,"author":{"gitId":"-"},"content":"   * Transition to the next checkpoint and resets the input setting.","isFullCredit":false},{"lineNumber":370,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":371,"author":{"gitId":"-"},"content":"   * This method is passed to the phase manager","isFullCredit":false},{"lineNumber":372,"author":{"gitId":"-"},"content":"   * as the interrupt transition callback.","isFullCredit":false},{"lineNumber":373,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":374,"author":{"gitId":"-"},"content":"  public async checkpointTransition() {","isFullCredit":false},{"lineNumber":375,"author":{"gitId":"-"},"content":"    this.hasTransitioned \u003d true;","isFullCredit":false},{"lineNumber":376,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":377,"author":{"gitId":"-"},"content":"    await this.getActionManager().processGameActions(","isFullCredit":false},{"lineNumber":378,"author":{"gitId":"-"},"content":"      this.getStateManager().getGameMap().getCheckpointCompleteActions()","isFullCredit":false},{"lineNumber":379,"author":{"gitId":"-"},"content":"    );","isFullCredit":false},{"lineNumber":380,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":381,"author":{"gitId":"-"},"content":"    // Reset input and cursor, in case it is changed after story complete actions","isFullCredit":false},{"lineNumber":382,"author":{"gitId":"-"},"content":"    this.getInputManager().setDefaultCursor(Constants.defaultCursor);","isFullCredit":false},{"lineNumber":383,"author":{"gitId":"-"},"content":"    this.getInputManager().enableMouseInput(true);","isFullCredit":false},{"lineNumber":384,"author":{"gitId":"-"},"content":"    this.getInputManager().enableKeyboardInput(true);","isFullCredit":false},{"lineNumber":385,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":386,"author":{"gitId":"-"},"content":"    this.tweens.add(fadeIn([blackScreen(this).setAlpha(0)], Constants.fadeDuration));","isFullCredit":false},{"lineNumber":387,"author":{"gitId":"-"},"content":"    await sleep(Constants.fadeDuration);","isFullCredit":false},{"lineNumber":388,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":389,"author":{"gitId":"-"},"content":"    // Clean up all layers \u0026 current storage","isFullCredit":false},{"lineNumber":390,"author":{"gitId":"-"},"content":"    this.cleanUp();","isFullCredit":false},{"lineNumber":391,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":392,"author":{"gitId":"-"},"content":"    // Start the next Checkpoint","isFullCredit":false},{"lineNumber":393,"author":{"gitId":"-"},"content":"    this.scene.start(\u0027CheckpointTransition\u0027);","isFullCredit":false},{"lineNumber":394,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":395,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":396,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":397,"author":{"gitId":"-"},"content":"   * Handle when character layer should be shown and hidden.","isFullCredit":false},{"lineNumber":398,"author":{"gitId":"-"},"content":"   * Character layer should only be shown when student is at","isFullCredit":false},{"lineNumber":399,"author":{"gitId":"-"},"content":"   * Menu Mode.","isFullCredit":false},{"lineNumber":400,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":401,"author":{"gitId":"-"},"content":"   * This method is passed to the phase manager, to be executed on","isFullCredit":false},{"lineNumber":402,"author":{"gitId":"-"},"content":"   * every phase transition.","isFullCredit":false},{"lineNumber":403,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":404,"author":{"gitId":"-"},"content":"   * @param prevPhase previous phase to transition from","isFullCredit":false},{"lineNumber":405,"author":{"gitId":"-"},"content":"   * @param newPhase new phase to transition to","isFullCredit":false},{"lineNumber":406,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":407,"author":{"gitId":"-"},"content":"  public async handleCharacterLayer(prevPhase: GamePhaseType, newPhase: GamePhaseType) {","isFullCredit":false},{"lineNumber":408,"author":{"gitId":"-"},"content":"    if (prevPhase \u003d\u003d\u003d GamePhaseType.Menu) {","isFullCredit":false},{"lineNumber":409,"author":{"gitId":"-"},"content":"      GameGlobalAPI.getInstance().fadeOutLayer(Layer.Character);","isFullCredit":false},{"lineNumber":410,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":411,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":412,"author":{"gitId":"-"},"content":"    if (newPhase \u003d\u003d\u003d GamePhaseType.Menu) {","isFullCredit":false},{"lineNumber":413,"author":{"gitId":"-"},"content":"      GameGlobalAPI.getInstance().fadeInLayer(Layer.Character);","isFullCredit":false},{"lineNumber":414,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":415,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":416,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":417,"author":{"gitId":"-"},"content":"  public getSaveManager \u003d () \u003d\u003e SourceAcademyGame.getInstance().getSaveManager();","isFullCredit":false},{"lineNumber":418,"author":{"gitId":"-"},"content":"  public getStateManager \u003d () \u003d\u003e mandatory(this.stateManager);","isFullCredit":false},{"lineNumber":419,"author":{"gitId":"-"},"content":"  public getObjectManager \u003d () \u003d\u003e mandatory(this.objectManager);","isFullCredit":false},{"lineNumber":420,"author":{"gitId":"-"},"content":"  public getDialogueManager \u003d () \u003d\u003e mandatory(this.dialogueManager);","isFullCredit":false},{"lineNumber":421,"author":{"gitId":"-"},"content":"  public getCharacterManager \u003d () \u003d\u003e mandatory(this.characterManager);","isFullCredit":false},{"lineNumber":422,"author":{"gitId":"-"},"content":"  public getBBoxManager \u003d () \u003d\u003e mandatory(this.boundingBoxManager);","isFullCredit":false},{"lineNumber":423,"author":{"gitId":"-"},"content":"  public getActionManager \u003d () \u003d\u003e mandatory(this.actionManager);","isFullCredit":false},{"lineNumber":424,"author":{"gitId":"-"},"content":"  public getInputManager \u003d () \u003d\u003e mandatory(this.inputManager);","isFullCredit":false},{"lineNumber":425,"author":{"gitId":"-"},"content":"  public getLayerManager \u003d () \u003d\u003e mandatory(this.layerManager);","isFullCredit":false},{"lineNumber":426,"author":{"gitId":"-"},"content":"  public getPhaseManager \u003d () \u003d\u003e mandatory(this.phaseManager);","isFullCredit":false},{"lineNumber":427,"author":{"gitId":"-"},"content":"  public getBackgroundManager \u003d () \u003d\u003e mandatory(this.backgroundManager);","isFullCredit":false},{"lineNumber":428,"author":{"gitId":"-"},"content":"  public getAnimationManager \u003d () \u003d\u003e mandatory(this.animationManager);","isFullCredit":false},{"lineNumber":429,"author":{"gitId":"-"},"content":"  public getPopupManager \u003d () \u003d\u003e mandatory(this.popUpManager);","isFullCredit":false},{"lineNumber":430,"author":{"gitId":"-"},"content":"  public getEscapeManager \u003d () \u003d\u003e mandatory(this.escapeManager);","isFullCredit":false},{"lineNumber":431,"author":{"gitId":"-"},"content":"  public getCollectibleManager \u003d () \u003d\u003e mandatory(this.collectibleManager);","isFullCredit":false},{"lineNumber":432,"author":{"gitId":"-"},"content":"  public getAchievementManager \u003d () \u003d\u003e mandatory(this.achievementManager);","isFullCredit":false},{"lineNumber":433,"author":{"gitId":"-"},"content":"  public getLogManager \u003d () \u003d\u003e mandatory(this.logManager);","isFullCredit":false},{"lineNumber":434,"author":{"gitId":"-"},"content":"  public getDialogueStorageManager \u003d () \u003d\u003e mandatory(this.dialogueStorageManager);","isFullCredit":false},{"lineNumber":435,"author":{"gitId":"-"},"content":"  public getToolbarManager \u003d () \u003d\u003e mandatory(this.toolbarManager);","isFullCredit":false},{"lineNumber":436,"author":{"gitId":"-"},"content":"  public getTaskLogManager \u003d () \u003d\u003e mandatory(this.taskLogManager);","isFullCredit":false},{"lineNumber":437,"author":{"gitId":"-"},"content":"  public getDashboardManager \u003d () \u003d\u003e mandatory(this.dashboardManager);","isFullCredit":false},{"lineNumber":438,"author":{"gitId":"CYX22222003"},"content":"  public getQuizManager \u003d () \u003d\u003e mandatory(this.quizManager);","isFullCredit":false},{"lineNumber":439,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":440,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":441,"author":{"gitId":"-"},"content":"export default GameManager;","isFullCredit":false}],"authorContributionMap":{"CYX22222003":4,"-":437}},{"path":"src/features/game/state/GameStateManager.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { BBoxProperty } from \u0027../boundingBoxes/GameBoundingBoxTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"import { GameCheckpoint } from \u0027../chapter/GameChapterTypes\u0027;","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"import { GamePosition, ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"import GameMap from \u0027../location/GameMap\u0027;","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"import { GameItemType, LocationId } from \u0027../location/GameMapTypes\u0027;","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"-"},"content":"import { GameMode } from \u0027../mode/GameModeTypes\u0027;","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"-"},"content":"import GameObjective from \u0027../objective/GameObjective\u0027;","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"-"},"content":"import { ObjectProperty } from \u0027../objects/GameObjectTypes\u0027;","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"-"},"content":"import { convertMapToArray } from \u0027../save/GameSaveHelper\u0027;","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"import GameGlobalAPI from \u0027../scenes/gameManager/GameGlobalAPI\u0027;","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"import SourceAcademyGame from \u0027../SourceAcademyGame\u0027;","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"import GameTask from \u0027../task/GameTask\u0027;","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":"import { TaskDetail } from \u0027../task/GameTaskTypes\u0027;","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":"import { mandatory } from \u0027../utils/GameUtils\u0027;","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"import { StateObserver } from \u0027./GameStateTypes\u0027;","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":" * Manages all states related to story, chapter, or checkpoint;","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":" * e.g. checkpoint objectives, objects\u0027 property, bboxes\u0027 property.","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":" * Other than this manager, all other manager should not need to","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":" * manage their own state.","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":" *","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":" * Employs observer pattern, and notifies its subjects on state update.","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"class GameStateManager {","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  // Subscribers","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"  private subscribers: Map\u003cGameItemType, StateObserver\u003e;","isFullCredit":false},{"lineNumber":30,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":31,"author":{"gitId":"-"},"content":"  // Game State","isFullCredit":false},{"lineNumber":32,"author":{"gitId":"-"},"content":"  private gameMap: GameMap;","isFullCredit":false},{"lineNumber":33,"author":{"gitId":"-"},"content":"  private checkpointObjective: GameObjective;","isFullCredit":false},{"lineNumber":34,"author":{"gitId":"-"},"content":"  private checkpointTask: GameTask;","isFullCredit":false},{"lineNumber":35,"author":{"gitId":"-"},"content":"  private chapterNewlyCompleted: boolean;","isFullCredit":false},{"lineNumber":36,"author":{"gitId":"CYX22222003"},"content":"  private quizScores: Map\u003cItemId, number\u003e;","isFullCredit":false},{"lineNumber":37,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":38,"author":{"gitId":"-"},"content":"  // Triggered Interactions","isFullCredit":false},{"lineNumber":39,"author":{"gitId":"-"},"content":"  private updatedLocations: Set\u003cLocationId\u003e;","isFullCredit":false},{"lineNumber":40,"author":{"gitId":"-"},"content":"  private triggeredInteractions: Map\u003cItemId, boolean\u003e;","isFullCredit":false},{"lineNumber":41,"author":{"gitId":"-"},"content":"  private triggeredStateChangeActions: ItemId[];","isFullCredit":false},{"lineNumber":42,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":43,"author":{"gitId":"-"},"content":"  constructor(gameCheckpoint: GameCheckpoint) {","isFullCredit":false},{"lineNumber":44,"author":{"gitId":"-"},"content":"    this.subscribers \u003d new Map\u003cGameItemType, StateObserver\u003e();","isFullCredit":false},{"lineNumber":45,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":46,"author":{"gitId":"-"},"content":"    this.gameMap \u003d gameCheckpoint.map;","isFullCredit":false},{"lineNumber":47,"author":{"gitId":"-"},"content":"    this.checkpointObjective \u003d gameCheckpoint.objectives;","isFullCredit":false},{"lineNumber":48,"author":{"gitId":"-"},"content":"    this.checkpointTask \u003d gameCheckpoint.tasks;","isFullCredit":false},{"lineNumber":49,"author":{"gitId":"-"},"content":"    this.chapterNewlyCompleted \u003d false;","isFullCredit":false},{"lineNumber":50,"author":{"gitId":"CYX22222003"},"content":"    this.quizScores \u003d new Map\u003cItemId, number\u003e();","isFullCredit":false},{"lineNumber":51,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":52,"author":{"gitId":"-"},"content":"    this.updatedLocations \u003d new Set(this.gameMap.getLocationIds());","isFullCredit":false},{"lineNumber":53,"author":{"gitId":"-"},"content":"    this.triggeredInteractions \u003d new Map\u003cItemId, boolean\u003e();","isFullCredit":false},{"lineNumber":54,"author":{"gitId":"-"},"content":"    this.triggeredStateChangeActions \u003d [];","isFullCredit":false},{"lineNumber":55,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":56,"author":{"gitId":"-"},"content":"    this.loadStatesFromSaveManager();","isFullCredit":false},{"lineNumber":57,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":58,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":59,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":60,"author":{"gitId":"-"},"content":"   * Loads some game states from the save manager","isFullCredit":false},{"lineNumber":61,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":62,"author":{"gitId":"-"},"content":"  private loadStatesFromSaveManager() {","isFullCredit":false},{"lineNumber":63,"author":{"gitId":"-"},"content":"    this.triggeredStateChangeActions \u003d this.getSaveManager().getTriggeredStateChangeActions();","isFullCredit":false},{"lineNumber":64,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":65,"author":{"gitId":"-"},"content":"    this.getSaveManager()","isFullCredit":false},{"lineNumber":66,"author":{"gitId":"-"},"content":"      .getTriggeredInteractions()","isFullCredit":false},{"lineNumber":67,"author":{"gitId":"-"},"content":"      .forEach(interactionId \u003d\u003e this.triggerInteraction(interactionId));","isFullCredit":false},{"lineNumber":68,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":69,"author":{"gitId":"-"},"content":"    this.getSaveManager()","isFullCredit":false},{"lineNumber":70,"author":{"gitId":"-"},"content":"      .getCompletedObjectives()","isFullCredit":false},{"lineNumber":71,"author":{"gitId":"-"},"content":"      .forEach(objective \u003d\u003e this.checkpointObjective.setObjective(objective, true));","isFullCredit":false},{"lineNumber":72,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":73,"author":{"gitId":"-"},"content":"    this.getSaveManager()","isFullCredit":false},{"lineNumber":74,"author":{"gitId":"-"},"content":"      .getCompletedTasks()","isFullCredit":false},{"lineNumber":75,"author":{"gitId":"-"},"content":"      .forEach(task \u003d\u003e {","isFullCredit":false},{"lineNumber":76,"author":{"gitId":"-"},"content":"        this.checkpointTask.setTask(task, true);","isFullCredit":false},{"lineNumber":77,"author":{"gitId":"-"},"content":"        this.checkpointTask.showTask(task);","isFullCredit":false},{"lineNumber":78,"author":{"gitId":"-"},"content":"      });","isFullCredit":false},{"lineNumber":79,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":80,"author":{"gitId":"-"},"content":"    this.getSaveManager()","isFullCredit":false},{"lineNumber":81,"author":{"gitId":"-"},"content":"      .getIncompleteTasks()","isFullCredit":false},{"lineNumber":82,"author":{"gitId":"-"},"content":"      .forEach(task \u003d\u003e {","isFullCredit":false},{"lineNumber":83,"author":{"gitId":"-"},"content":"        this.checkpointTask.setTask(task, false);","isFullCredit":false},{"lineNumber":84,"author":{"gitId":"-"},"content":"        this.checkpointTask.showTask(task);","isFullCredit":false},{"lineNumber":85,"author":{"gitId":"-"},"content":"      });","isFullCredit":false},{"lineNumber":86,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":87,"author":{"gitId":"CYX22222003"},"content":"    this.quizScores \u003d new Map(this.getSaveManager().getQuizScores());","isFullCredit":false},{"lineNumber":88,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":89,"author":{"gitId":"-"},"content":"    this.chapterNewlyCompleted \u003d this.getSaveManager().getChapterNewlyCompleted();","isFullCredit":false},{"lineNumber":90,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":91,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":92,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":93,"author":{"gitId":"-"},"content":"  //        Subscribers        //","isFullCredit":false},{"lineNumber":94,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":95,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":96,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":97,"author":{"gitId":"-"},"content":"   * This function is called to set state observers","isFullCredit":false},{"lineNumber":98,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":99,"author":{"gitId":"-"},"content":"   * @param gameItemType Type of game item the observer wants to watch","isFullCredit":false},{"lineNumber":100,"author":{"gitId":"-"},"content":"   * @param stateObserver reference to state observer","isFullCredit":false},{"lineNumber":101,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":102,"author":{"gitId":"-"},"content":"  public watchGameItemType(gameItemType: GameItemType, stateObserver: StateObserver) {","isFullCredit":false},{"lineNumber":103,"author":{"gitId":"-"},"content":"    this.subscribers.set(gameItemType, stateObserver);","isFullCredit":false},{"lineNumber":104,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":105,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":106,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":107,"author":{"gitId":"-"},"content":"   * Obtains the subscriber that watches the game item","isFullCredit":false},{"lineNumber":108,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":109,"author":{"gitId":"-"},"content":"   * @param gameItemType the type of item being watched","isFullCredit":false},{"lineNumber":110,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":111,"author":{"gitId":"-"},"content":"  private getSubscriberForItemType(gameItemType: GameItemType) {","isFullCredit":false},{"lineNumber":112,"author":{"gitId":"-"},"content":"    return this.subscribers.get(gameItemType);","isFullCredit":false},{"lineNumber":113,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":114,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":115,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":116,"author":{"gitId":"-"},"content":"  //        Interaction        //","isFullCredit":false},{"lineNumber":117,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":118,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":119,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":120,"author":{"gitId":"-"},"content":"   * Record that an interaction has been triggered.","isFullCredit":false},{"lineNumber":121,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":122,"author":{"gitId":"-"},"content":"   * @param id id of interaction","isFullCredit":false},{"lineNumber":123,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":124,"author":{"gitId":"-"},"content":"  public triggerInteraction(id: string): void {","isFullCredit":false},{"lineNumber":125,"author":{"gitId":"-"},"content":"    this.triggeredInteractions.set(id, true);","isFullCredit":false},{"lineNumber":126,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":127,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":128,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":129,"author":{"gitId":"-"},"content":"   * Record a state-change action that has been triggered.","isFullCredit":false},{"lineNumber":130,"author":{"gitId":"-"},"content":"   * State-change actions refer to actions that modify the map\u0027s","isFullCredit":false},{"lineNumber":131,"author":{"gitId":"-"},"content":"   * original state","isFullCredit":false},{"lineNumber":132,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":133,"author":{"gitId":"-"},"content":"   * @param actionId actionId of interaction","isFullCredit":false},{"lineNumber":134,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":135,"author":{"gitId":"-"},"content":"  public triggerStateChangeAction(actionId: ItemId): void {","isFullCredit":false},{"lineNumber":136,"author":{"gitId":"-"},"content":"    this.triggeredStateChangeActions.push(actionId);","isFullCredit":false},{"lineNumber":137,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":138,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":139,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":140,"author":{"gitId":"-"},"content":"   * Checks whether an interaction ID has been triggered or not.","isFullCredit":false},{"lineNumber":141,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":142,"author":{"gitId":"-"},"content":"   * @param id id of interaction","isFullCredit":false},{"lineNumber":143,"author":{"gitId":"-"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":144,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":145,"author":{"gitId":"-"},"content":"  public hasTriggeredInteraction(id: string): boolean | undefined {","isFullCredit":false},{"lineNumber":146,"author":{"gitId":"-"},"content":"    return this.triggeredInteractions.get(id);","isFullCredit":false},{"lineNumber":147,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":148,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":149,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":150,"author":{"gitId":"-"},"content":"  //          Notifs          //","isFullCredit":false},{"lineNumber":151,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":152,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":153,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":154,"author":{"gitId":"-"},"content":"   * Adds a location notification for a locationId","isFullCredit":false},{"lineNumber":155,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":156,"author":{"gitId":"-"},"content":"   * @param locationId locationId of location you want to add notif to","isFullCredit":false},{"lineNumber":157,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":158,"author":{"gitId":"-"},"content":"  public addLocationNotif(locationId: LocationId) {","isFullCredit":false},{"lineNumber":159,"author":{"gitId":"-"},"content":"    this.updatedLocations.add(locationId);","isFullCredit":false},{"lineNumber":160,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":161,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":162,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":163,"author":{"gitId":"-"},"content":"   * Removes a location notification for a locationId","isFullCredit":false},{"lineNumber":164,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":165,"author":{"gitId":"-"},"content":"   * @param locationId locationId of location you want to remove notif of","isFullCredit":false},{"lineNumber":166,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":167,"author":{"gitId":"-"},"content":"  public removeLocationNotif(locationId: LocationId) {","isFullCredit":false},{"lineNumber":168,"author":{"gitId":"-"},"content":"    this.updatedLocations.delete(locationId);","isFullCredit":false},{"lineNumber":169,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":170,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":171,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":172,"author":{"gitId":"-"},"content":"   * Gets whether or not the location has a notif","isFullCredit":false},{"lineNumber":173,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":174,"author":{"gitId":"-"},"content":"   * @param locationId locationId of location you want to find out if got notif","isFullCredit":false},{"lineNumber":175,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":176,"author":{"gitId":"-"},"content":"  public hasLocationNotif(locationId: LocationId) {","isFullCredit":false},{"lineNumber":177,"author":{"gitId":"-"},"content":"    return this.updatedLocations.has(locationId);","isFullCredit":false},{"lineNumber":178,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":179,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":180,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":181,"author":{"gitId":"-"},"content":"   * Function to check if current location is the given locationId","isFullCredit":false},{"lineNumber":182,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":183,"author":{"gitId":"-"},"content":"   * @param locationId locationId that you want to check whether is current one","isFullCredit":false},{"lineNumber":184,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":185,"author":{"gitId":"-"},"content":"  public isCurrentLocation(locationId: LocationId) {","isFullCredit":false},{"lineNumber":186,"author":{"gitId":"-"},"content":"    return locationId \u003d\u003d\u003d GameGlobalAPI.getInstance().getCurrLocId();","isFullCredit":false},{"lineNumber":187,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":188,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":189,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":190,"author":{"gitId":"-"},"content":"  //       Location Mode       //","isFullCredit":false},{"lineNumber":191,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":192,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":193,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":194,"author":{"gitId":"-"},"content":"   * Get modes available to a location based on the location ID.","isFullCredit":false},{"lineNumber":195,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":196,"author":{"gitId":"-"},"content":"   * @param locationId location ID","isFullCredit":false},{"lineNumber":197,"author":{"gitId":"-"},"content":"   * @returns {GameMode[]} game modes","isFullCredit":false},{"lineNumber":198,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":199,"author":{"gitId":"-"},"content":"  public getLocationModes(locationId: LocationId): GameMode[] {","isFullCredit":false},{"lineNumber":200,"author":{"gitId":"-"},"content":"    return Array.from(this.gameMap.getLocationAtId(locationId).modes) || [];","isFullCredit":false},{"lineNumber":201,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":202,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":203,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":204,"author":{"gitId":"-"},"content":"   * Add a mode to a location. If this is not the current location,","isFullCredit":false},{"lineNumber":205,"author":{"gitId":"-"},"content":"   * then add a notification.","isFullCredit":false},{"lineNumber":206,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":207,"author":{"gitId":"-"},"content":"   * @param locationId location ID","isFullCredit":false},{"lineNumber":208,"author":{"gitId":"-"},"content":"   * @param mode game mode to add","isFullCredit":false},{"lineNumber":209,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":210,"author":{"gitId":"-"},"content":"  public addLocationMode(locationId: LocationId, mode: GameMode) {","isFullCredit":false},{"lineNumber":211,"author":{"gitId":"-"},"content":"    this.gameMap.getLocationAtId(locationId).modes.add(mode);","isFullCredit":false},{"lineNumber":212,"author":{"gitId":"-"},"content":"    if (!this.isCurrentLocation(locationId)) {","isFullCredit":false},{"lineNumber":213,"author":{"gitId":"-"},"content":"      this.addLocationNotif(locationId);","isFullCredit":false},{"lineNumber":214,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":215,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":216,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":217,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":218,"author":{"gitId":"-"},"content":"   * Remove a mode from a location. If this is not the current location,","isFullCredit":false},{"lineNumber":219,"author":{"gitId":"-"},"content":"   * then add a notification.","isFullCredit":false},{"lineNumber":220,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":221,"author":{"gitId":"-"},"content":"   * @param locationId location ID","isFullCredit":false},{"lineNumber":222,"author":{"gitId":"-"},"content":"   * @param mode game mode to remove","isFullCredit":false},{"lineNumber":223,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":224,"author":{"gitId":"-"},"content":"  public removeLocationMode(locationId: LocationId, mode: GameMode) {","isFullCredit":false},{"lineNumber":225,"author":{"gitId":"-"},"content":"    this.gameMap.getLocationAtId(locationId).modes.delete(mode);","isFullCredit":false},{"lineNumber":226,"author":{"gitId":"-"},"content":"    if (!this.isCurrentLocation(locationId)) {","isFullCredit":false},{"lineNumber":227,"author":{"gitId":"-"},"content":"      this.addLocationNotif(locationId);","isFullCredit":false},{"lineNumber":228,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":229,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":230,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":231,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":232,"author":{"gitId":"-"},"content":"  //        State Check        //","isFullCredit":false},{"lineNumber":233,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":234,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":235,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":236,"author":{"gitId":"-"},"content":"   * Get all IDs of a type of game item in a location.","isFullCredit":false},{"lineNumber":237,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":238,"author":{"gitId":"-"},"content":"   * @param gameItemType type of game item","isFullCredit":false},{"lineNumber":239,"author":{"gitId":"-"},"content":"   * @param locationId id of location","isFullCredit":false},{"lineNumber":240,"author":{"gitId":"-"},"content":"   * @returns {ItemId[]} items IDS of all game items of that type in the location","isFullCredit":false},{"lineNumber":241,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":242,"author":{"gitId":"-"},"content":"  public getGameItemsInLocation(gameItemType: GameItemType, locationId: LocationId): ItemId[] {","isFullCredit":false},{"lineNumber":243,"author":{"gitId":"-"},"content":"    const location \u003d this.gameMap.getLocationAtId(locationId);","isFullCredit":false},{"lineNumber":244,"author":{"gitId":"-"},"content":"    const items \u003d location[gameItemType as keyof typeof location];","isFullCredit":false},{"lineNumber":245,"author":{"gitId":"-"},"content":"    // Non-strict equality check to match both null and undefined","isFullCredit":false},{"lineNumber":246,"author":{"gitId":"-"},"content":"    return items \u003d\u003d undefined ? [] : Array.from(items);","isFullCredit":false},{"lineNumber":247,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":248,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":249,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":250,"author":{"gitId":"-"},"content":"   * Add an item ID of a game item type in gamemap\u0027s location.","isFullCredit":false},{"lineNumber":251,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":252,"author":{"gitId":"-"},"content":"   * Either render the change instantly, or place a notification inside another location","isFullCredit":false},{"lineNumber":253,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":254,"author":{"gitId":"-"},"content":"   * @param gameItemType type of game item","isFullCredit":false},{"lineNumber":255,"author":{"gitId":"-"},"content":"   * @param locationId id of location to add items to","isFullCredit":false},{"lineNumber":256,"author":{"gitId":"-"},"content":"   * @param itemId item ID to be added","isFullCredit":false},{"lineNumber":257,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":258,"author":{"gitId":"-"},"content":"  public addItem(gameItemType: GameItemType, locationId: LocationId, itemId: ItemId) {","isFullCredit":false},{"lineNumber":259,"author":{"gitId":"-"},"content":"    const location \u003d this.gameMap.getLocationAtId(locationId);","isFullCredit":false},{"lineNumber":260,"author":{"gitId":"-"},"content":"    const items \u003d location[gameItemType as keyof typeof location];","isFullCredit":false},{"lineNumber":261,"author":{"gitId":"-"},"content":"    (items as Set\u003cany\u003e | undefined)?.add(itemId);","isFullCredit":false},{"lineNumber":262,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":263,"author":{"gitId":"-"},"content":"    if (this.isCurrentLocation(locationId)) {","isFullCredit":false},{"lineNumber":264,"author":{"gitId":"-"},"content":"      this.getSubscriberForItemType(gameItemType)?.handleAdd(itemId);","isFullCredit":false},{"lineNumber":265,"author":{"gitId":"-"},"content":"    } else {","isFullCredit":false},{"lineNumber":266,"author":{"gitId":"-"},"content":"      this.addLocationNotif(locationId);","isFullCredit":false},{"lineNumber":267,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":268,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":269,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":270,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":271,"author":{"gitId":"-"},"content":"   * Remove an item ID from game items in gamemap\u0027s location.","isFullCredit":false},{"lineNumber":272,"author":{"gitId":"-"},"content":"   * If ID is not found within the game item list, nothing will be executed.","isFullCredit":false},{"lineNumber":273,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":274,"author":{"gitId":"-"},"content":"   * Either render the change instantly, or place a notification inside another location","isFullCredit":false},{"lineNumber":275,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":276,"author":{"gitId":"-"},"content":"   * @param gameItemType type of game item to remove","isFullCredit":false},{"lineNumber":277,"author":{"gitId":"-"},"content":"   * @param locationId id of location to remove items from","isFullCredit":false},{"lineNumber":278,"author":{"gitId":"-"},"content":"   * @param itemId item ID to be removed","isFullCredit":false},{"lineNumber":279,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":280,"author":{"gitId":"-"},"content":"  public removeItem(gameItemType: GameItemType, locationId: LocationId, itemId: string) {","isFullCredit":false},{"lineNumber":281,"author":{"gitId":"-"},"content":"    const location \u003d this.gameMap.getLocationAtId(locationId);","isFullCredit":false},{"lineNumber":282,"author":{"gitId":"-"},"content":"    const items \u003d location[gameItemType as keyof typeof location];","isFullCredit":false},{"lineNumber":283,"author":{"gitId":"-"},"content":"    (items as Set\u003cany\u003e | undefined)?.delete(itemId);","isFullCredit":false},{"lineNumber":284,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":285,"author":{"gitId":"-"},"content":"    if (this.isCurrentLocation(locationId)) {","isFullCredit":false},{"lineNumber":286,"author":{"gitId":"-"},"content":"      this.getSubscriberForItemType(gameItemType)?.handleDelete(itemId);","isFullCredit":false},{"lineNumber":287,"author":{"gitId":"-"},"content":"    } else {","isFullCredit":false},{"lineNumber":288,"author":{"gitId":"-"},"content":"      this.addLocationNotif(locationId);","isFullCredit":false},{"lineNumber":289,"author":{"gitId":"-"},"content":"    }","isFullCredit":false},{"lineNumber":290,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":291,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":292,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":293,"author":{"gitId":"-"},"content":"   * Replace an object property of the given ID with the new object","isFullCredit":false},{"lineNumber":294,"author":{"gitId":"-"},"content":"   * property. Commonly used to update a specific object property.","isFullCredit":false},{"lineNumber":295,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":296,"author":{"gitId":"-"},"content":"   * @param id id of object to change","isFullCredit":false},{"lineNumber":297,"author":{"gitId":"-"},"content":"   * @param newObjProp new object property to replace the old one","isFullCredit":false},{"lineNumber":298,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":299,"author":{"gitId":"-"},"content":"  public setObjProperty(id: ItemId, newObjProp: ObjectProperty) {","isFullCredit":false},{"lineNumber":300,"author":{"gitId":"-"},"content":"    this.gameMap.setItemInMap(GameItemType.objects, id, newObjProp);","isFullCredit":false},{"lineNumber":301,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":302,"author":{"gitId":"-"},"content":"    // Update every location that has the object","isFullCredit":false},{"lineNumber":303,"author":{"gitId":"-"},"content":"    this.gameMap.getLocations().forEach((location, locId) \u003d\u003e {","isFullCredit":false},{"lineNumber":304,"author":{"gitId":"-"},"content":"      if (!location.objects.has(id)) return;","isFullCredit":false},{"lineNumber":305,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":306,"author":{"gitId":"-"},"content":"      if (this.isCurrentLocation(locId)) {","isFullCredit":false},{"lineNumber":307,"author":{"gitId":"-"},"content":"        this.getSubscriberForItemType(GameItemType.objects)?.handleMutate(id);","isFullCredit":false},{"lineNumber":308,"author":{"gitId":"-"},"content":"      } else {","isFullCredit":false},{"lineNumber":309,"author":{"gitId":"-"},"content":"        this.addLocationNotif(locId);","isFullCredit":false},{"lineNumber":310,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":311,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":312,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":313,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":314,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":315,"author":{"gitId":"-"},"content":"   * Replace a bbox property of the given ID with the new bbox","isFullCredit":false},{"lineNumber":316,"author":{"gitId":"-"},"content":"   * property. Commonly used to update a specific bbox property.","isFullCredit":false},{"lineNumber":317,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":318,"author":{"gitId":"-"},"content":"   * @param id id of object to change","isFullCredit":false},{"lineNumber":319,"author":{"gitId":"-"},"content":"   * @param newBBoxProp new object property to replace the old one","isFullCredit":false},{"lineNumber":320,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":321,"author":{"gitId":"-"},"content":"  public setBBoxProperty(id: ItemId, newBBoxProp: BBoxProperty) {","isFullCredit":false},{"lineNumber":322,"author":{"gitId":"-"},"content":"    this.gameMap.setItemInMap(GameItemType.boundingBoxes, id, newBBoxProp);","isFullCredit":false},{"lineNumber":323,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":324,"author":{"gitId":"-"},"content":"    // Update every location that has the bbox","isFullCredit":false},{"lineNumber":325,"author":{"gitId":"-"},"content":"    this.gameMap.getLocations().forEach((location, locId) \u003d\u003e {","isFullCredit":false},{"lineNumber":326,"author":{"gitId":"-"},"content":"      if (!location.boundingBoxes.has(id)) return;","isFullCredit":false},{"lineNumber":327,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":328,"author":{"gitId":"-"},"content":"      if (this.isCurrentLocation(locId)) {","isFullCredit":false},{"lineNumber":329,"author":{"gitId":"-"},"content":"        this.getSubscriberForItemType(GameItemType.boundingBoxes)?.handleMutate(id);","isFullCredit":false},{"lineNumber":330,"author":{"gitId":"-"},"content":"      } else {","isFullCredit":false},{"lineNumber":331,"author":{"gitId":"-"},"content":"        this.addLocationNotif(locId);","isFullCredit":false},{"lineNumber":332,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":333,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":334,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":335,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":336,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":337,"author":{"gitId":"-"},"content":"   * Moves a character to another location and another position","isFullCredit":false},{"lineNumber":338,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":339,"author":{"gitId":"-"},"content":"   * @param id id of character to change","isFullCredit":false},{"lineNumber":340,"author":{"gitId":"-"},"content":"   * @param newLocation new location to put this character inside of","isFullCredit":false},{"lineNumber":341,"author":{"gitId":"-"},"content":"   * @param newPosition new position of the character","isFullCredit":false},{"lineNumber":342,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":343,"author":{"gitId":"-"},"content":"  public moveCharacter(id: ItemId, newLocation: LocationId, newPosition: GamePosition) {","isFullCredit":false},{"lineNumber":344,"author":{"gitId":"-"},"content":"    // Move position","isFullCredit":false},{"lineNumber":345,"author":{"gitId":"-"},"content":"    this.getCharacterAtId(id).defaultPosition \u003d newPosition;","isFullCredit":false},{"lineNumber":346,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":347,"author":{"gitId":"-"},"content":"    // Find location with character and remove him","isFullCredit":false},{"lineNumber":348,"author":{"gitId":"-"},"content":"    this.gameMap.getLocations().forEach((location, locId) \u003d\u003e {","isFullCredit":false},{"lineNumber":349,"author":{"gitId":"-"},"content":"      if (!location.characters.has(id)) return;","isFullCredit":false},{"lineNumber":350,"author":{"gitId":"-"},"content":"      this.removeItem(GameItemType.characters, locId, id);","isFullCredit":false},{"lineNumber":351,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":352,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":353,"author":{"gitId":"-"},"content":"    // Add updated character to new location","isFullCredit":false},{"lineNumber":354,"author":{"gitId":"-"},"content":"    this.addItem(GameItemType.characters, newLocation, id);","isFullCredit":false},{"lineNumber":355,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":356,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":357,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":358,"author":{"gitId":"-"},"content":"   * Changes the default expression of a character","isFullCredit":false},{"lineNumber":359,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":360,"author":{"gitId":"-"},"content":"   * @param id id of character to change","isFullCredit":false},{"lineNumber":361,"author":{"gitId":"-"},"content":"   * @param newExpression new expression of the character","isFullCredit":false},{"lineNumber":362,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":363,"author":{"gitId":"-"},"content":"  public updateCharacter(id: ItemId, newExpression: string) {","isFullCredit":false},{"lineNumber":364,"author":{"gitId":"-"},"content":"    this.getCharacterAtId(id).defaultExpression \u003d newExpression;","isFullCredit":false},{"lineNumber":365,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":366,"author":{"gitId":"-"},"content":"    // Update every location that has the character","isFullCredit":false},{"lineNumber":367,"author":{"gitId":"-"},"content":"    this.gameMap.getLocations().forEach((location, locId) \u003d\u003e {","isFullCredit":false},{"lineNumber":368,"author":{"gitId":"-"},"content":"      if (!location.characters.has(id)) return;","isFullCredit":false},{"lineNumber":369,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":370,"author":{"gitId":"-"},"content":"      if (this.isCurrentLocation(locId)) {","isFullCredit":false},{"lineNumber":371,"author":{"gitId":"-"},"content":"        this.getSubscriberForItemType(GameItemType.characters)?.handleMutate(id);","isFullCredit":false},{"lineNumber":372,"author":{"gitId":"-"},"content":"      } else {","isFullCredit":false},{"lineNumber":373,"author":{"gitId":"-"},"content":"        this.addLocationNotif(locId);","isFullCredit":false},{"lineNumber":374,"author":{"gitId":"-"},"content":"      }","isFullCredit":false},{"lineNumber":375,"author":{"gitId":"-"},"content":"    });","isFullCredit":false},{"lineNumber":376,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":377,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":378,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":379,"author":{"gitId":"-"},"content":"  //    Chapter Objectives     //","isFullCredit":false},{"lineNumber":380,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":381,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":382,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":383,"author":{"gitId":"-"},"content":"   * Checks whether all the checkpoint objectives has been completed.","isFullCredit":false},{"lineNumber":384,"author":{"gitId":"-"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":385,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":386,"author":{"gitId":"-"},"content":"  public areAllObjectivesComplete(): boolean {","isFullCredit":false},{"lineNumber":387,"author":{"gitId":"-"},"content":"    return this.checkpointObjective.isAllComplete();","isFullCredit":false},{"lineNumber":388,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":389,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":390,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":391,"author":{"gitId":"-"},"content":"   * Checks whether a specific objective has been completed.","isFullCredit":false},{"lineNumber":392,"author":{"gitId":"-"},"content":"   * If the objective does not exist, this method still returns true.","isFullCredit":false},{"lineNumber":393,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":394,"author":{"gitId":"-"},"content":"   * @param key objective name","isFullCredit":false},{"lineNumber":395,"author":{"gitId":"-"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":396,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":397,"author":{"gitId":"-"},"content":"  public isObjectiveComplete(key: string): boolean {","isFullCredit":false},{"lineNumber":398,"author":{"gitId":"-"},"content":"    return this.checkpointObjective.getObjectiveState(key);","isFullCredit":false},{"lineNumber":399,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":400,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":401,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":402,"author":{"gitId":"-"},"content":"   * Check whether the objectives are complete or not.","isFullCredit":false},{"lineNumber":403,"author":{"gitId":"-"},"content":"   * All specified objectives must be complete for this method","isFullCredit":false},{"lineNumber":404,"author":{"gitId":"-"},"content":"   * to return true.","isFullCredit":false},{"lineNumber":405,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":406,"author":{"gitId":"-"},"content":"   * @param keys objective names","isFullCredit":false},{"lineNumber":407,"author":{"gitId":"-"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":408,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":409,"author":{"gitId":"-"},"content":"  public areObjectivesComplete(keys: string[]): boolean {","isFullCredit":false},{"lineNumber":410,"author":{"gitId":"-"},"content":"    let result \u003d true;","isFullCredit":false},{"lineNumber":411,"author":{"gitId":"-"},"content":"    keys.forEach(key \u003d\u003e (result \u003d result \u0026\u0026 this.isObjectiveComplete(key)));","isFullCredit":false},{"lineNumber":412,"author":{"gitId":"-"},"content":"    return result;","isFullCredit":false},{"lineNumber":413,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":414,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":415,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":416,"author":{"gitId":"-"},"content":"   * Record that an objective has been completed.","isFullCredit":false},{"lineNumber":417,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":418,"author":{"gitId":"-"},"content":"   * @param key objective name","isFullCredit":false},{"lineNumber":419,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":420,"author":{"gitId":"-"},"content":"  public completeObjective(key: string): void {","isFullCredit":false},{"lineNumber":421,"author":{"gitId":"-"},"content":"    this.checkpointObjective.setObjective(key, true);","isFullCredit":false},{"lineNumber":422,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":423,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":424,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":425,"author":{"gitId":"-"},"content":"  //    Chapter Tasks          //","isFullCredit":false},{"lineNumber":426,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":427,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":428,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":429,"author":{"gitId":"-"},"content":"   * Checks whether a specific task has been completed.","isFullCredit":false},{"lineNumber":430,"author":{"gitId":"-"},"content":"   * If the task does not exist, this method still returns true.","isFullCredit":false},{"lineNumber":431,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":432,"author":{"gitId":"-"},"content":"   * @param key task id","isFullCredit":false},{"lineNumber":433,"author":{"gitId":"-"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":434,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":435,"author":{"gitId":"-"},"content":"  public isTaskComplete(key: string): boolean {","isFullCredit":false},{"lineNumber":436,"author":{"gitId":"-"},"content":"    return this.checkpointTask.getTaskState(key);","isFullCredit":false},{"lineNumber":437,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":438,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":439,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":440,"author":{"gitId":"-"},"content":"   * Check whether the tasks are complete or not.","isFullCredit":false},{"lineNumber":441,"author":{"gitId":"-"},"content":"   * All specified tasks must be complete for this method","isFullCredit":false},{"lineNumber":442,"author":{"gitId":"-"},"content":"   * to return true.","isFullCredit":false},{"lineNumber":443,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":444,"author":{"gitId":"-"},"content":"   * @param keys task ids","isFullCredit":false},{"lineNumber":445,"author":{"gitId":"-"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":446,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":447,"author":{"gitId":"-"},"content":"  public areTasksComplete(keys: string[]): boolean {","isFullCredit":false},{"lineNumber":448,"author":{"gitId":"-"},"content":"    let result \u003d true;","isFullCredit":false},{"lineNumber":449,"author":{"gitId":"-"},"content":"    keys.forEach(key \u003d\u003e (result \u003d result \u0026\u0026 this.isTaskComplete(key)));","isFullCredit":false},{"lineNumber":450,"author":{"gitId":"-"},"content":"    return result;","isFullCredit":false},{"lineNumber":451,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":452,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":453,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":454,"author":{"gitId":"-"},"content":"   * Record that a task has been completed.","isFullCredit":false},{"lineNumber":455,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":456,"author":{"gitId":"-"},"content":"   * @param key task id","isFullCredit":false},{"lineNumber":457,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":458,"author":{"gitId":"-"},"content":"  public completeTask(key: string): void {","isFullCredit":false},{"lineNumber":459,"author":{"gitId":"-"},"content":"    this.checkpointTask.setTask(key, true);","isFullCredit":false},{"lineNumber":460,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":461,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":462,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":463,"author":{"gitId":"-"},"content":"   * Indicate that a task should be shown to the user.","isFullCredit":false},{"lineNumber":464,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":465,"author":{"gitId":"-"},"content":"   * @param key task id","isFullCredit":false},{"lineNumber":466,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":467,"author":{"gitId":"-"},"content":"  public showTask(key: string): void {","isFullCredit":false},{"lineNumber":468,"author":{"gitId":"-"},"content":"    this.checkpointTask.showTask(key);","isFullCredit":false},{"lineNumber":469,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":470,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":471,"author":{"gitId":"-"},"content":"  public getAllVisibleTaskData(): Array\u003c[TaskDetail, boolean]\u003e {","isFullCredit":false},{"lineNumber":472,"author":{"gitId":"-"},"content":"    return this.checkpointTask.getAllVisibleTaskData();","isFullCredit":false},{"lineNumber":473,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":474,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":475,"author":{"gitId":"CYX22222003"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":476,"author":{"gitId":"CYX22222003"},"content":"  //          Quiz             //","isFullCredit":false},{"lineNumber":477,"author":{"gitId":"CYX22222003"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":478,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":479,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":480,"author":{"gitId":"CYX22222003"},"content":"   * Checks whether a quiz has been obtained full marks.","isFullCredit":false},{"lineNumber":481,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":482,"author":{"gitId":"CYX22222003"},"content":"   * @param key quiz id","isFullCredit":false},{"lineNumber":483,"author":{"gitId":"CYX22222003"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":484,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":485,"author":{"gitId":"CYX22222003"},"content":"  public isQuizComplete(quizId: string): boolean {","isFullCredit":false},{"lineNumber":486,"author":{"gitId":"CYX22222003"},"content":"    return this.quizScores.get(quizId) \u003d\u003d\u003d GameGlobalAPI.getInstance().getQuizLength(quizId);","isFullCredit":false},{"lineNumber":487,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":488,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":489,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":490,"author":{"gitId":"CYX22222003"},"content":"   * Checks whether a specific quiz has been played.","isFullCredit":false},{"lineNumber":491,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":492,"author":{"gitId":"CYX22222003"},"content":"   * @param key quiz id","isFullCredit":false},{"lineNumber":493,"author":{"gitId":"CYX22222003"},"content":"   * @returns {boolean}","isFullCredit":false},{"lineNumber":494,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":495,"author":{"gitId":"CYX22222003"},"content":"  public isQuizAttempted(quizId: string): boolean {","isFullCredit":false},{"lineNumber":496,"author":{"gitId":"CYX22222003"},"content":"    return this.quizScores.has(quizId);","isFullCredit":false},{"lineNumber":497,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":498,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":499,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":500,"author":{"gitId":"CYX22222003"},"content":"   * Get the score of a quiz.","isFullCredit":false},{"lineNumber":501,"author":{"gitId":"CYX22222003"},"content":"   * Return 0 if the quiz has not been played.","isFullCredit":false},{"lineNumber":502,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":503,"author":{"gitId":"CYX22222003"},"content":"   * @param quizId","isFullCredit":false},{"lineNumber":504,"author":{"gitId":"CYX22222003"},"content":"   * @returns","isFullCredit":false},{"lineNumber":505,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":506,"author":{"gitId":"CYX22222003"},"content":"  public getQuizScore(quizId: ItemId): number {","isFullCredit":false},{"lineNumber":507,"author":{"gitId":"CYX22222003"},"content":"    const score \u003d this.quizScores.get(quizId);","isFullCredit":false},{"lineNumber":508,"author":{"gitId":"CYX22222003"},"content":"    return score ?? 0;","isFullCredit":false},{"lineNumber":509,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":510,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":511,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":512,"author":{"gitId":"CYX22222003"},"content":"   * Set the score of a quiz to a given number.","isFullCredit":false},{"lineNumber":513,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":514,"author":{"gitId":"CYX22222003"},"content":"   * @param quizId The id of the quiz.","isFullCredit":false},{"lineNumber":515,"author":{"gitId":"CYX22222003"},"content":"   * @param newScore The new score to be set.","isFullCredit":false},{"lineNumber":516,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":517,"author":{"gitId":"CYX22222003"},"content":"  public setQuizScore(quizId: string, newScore: number) {","isFullCredit":false},{"lineNumber":518,"author":{"gitId":"CYX22222003"},"content":"    this.quizScores.set(quizId, newScore);","isFullCredit":false},{"lineNumber":519,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":520,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":521,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":522,"author":{"gitId":"-"},"content":"  //          Saving           //","isFullCredit":false},{"lineNumber":523,"author":{"gitId":"-"},"content":"  ///////////////////////////////","isFullCredit":false},{"lineNumber":524,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":525,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":526,"author":{"gitId":"-"},"content":"   * Gets array of all objectives that have been completed.","isFullCredit":false},{"lineNumber":527,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":528,"author":{"gitId":"-"},"content":"   * @returns {ItemId[]}","isFullCredit":false},{"lineNumber":529,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":530,"author":{"gitId":"-"},"content":"  public getCompletedObjectives(): ItemId[] {","isFullCredit":false},{"lineNumber":531,"author":{"gitId":"-"},"content":"    return convertMapToArray(this.checkpointObjective.getObjectives());","isFullCredit":false},{"lineNumber":532,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":533,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":534,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":535,"author":{"gitId":"-"},"content":"   * Gets array of all tasks that have been completed.","isFullCredit":false},{"lineNumber":536,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":537,"author":{"gitId":"-"},"content":"   * @returns {ItemId[]}","isFullCredit":false},{"lineNumber":538,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":539,"author":{"gitId":"-"},"content":"  public getCompletedTasks(): ItemId[] {","isFullCredit":false},{"lineNumber":540,"author":{"gitId":"-"},"content":"    return convertMapToArray(this.checkpointTask.getAllTasks());","isFullCredit":false},{"lineNumber":541,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":542,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":543,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":544,"author":{"gitId":"-"},"content":"   * Gets array of all tasks that have been displayed but yet to be completed.","isFullCredit":false},{"lineNumber":545,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":546,"author":{"gitId":"-"},"content":"   * @returns {ItemId[]}","isFullCredit":false},{"lineNumber":547,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":548,"author":{"gitId":"-"},"content":"  public getIncompleteTasks(): ItemId[] {","isFullCredit":false},{"lineNumber":549,"author":{"gitId":"-"},"content":"    return this.checkpointTask.getAllIncompleteTasks();","isFullCredit":false},{"lineNumber":550,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":551,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":552,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":553,"author":{"gitId":"-"},"content":"   * Return an array interactions that have been triggered","isFullCredit":false},{"lineNumber":554,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":555,"author":{"gitId":"-"},"content":"   * @returns {string[]}","isFullCredit":false},{"lineNumber":556,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":557,"author":{"gitId":"-"},"content":"  public getTriggeredInteractions(): string[] {","isFullCredit":false},{"lineNumber":558,"author":{"gitId":"-"},"content":"    return convertMapToArray(this.triggeredInteractions);","isFullCredit":false},{"lineNumber":559,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":560,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":561,"author":{"gitId":"-"},"content":"  /**","isFullCredit":false},{"lineNumber":562,"author":{"gitId":"-"},"content":"   * Return an array interactions of state-change actions that have been triggered","isFullCredit":false},{"lineNumber":563,"author":{"gitId":"-"},"content":"   * State-change actions refer to actions that modify the game map\u0027s original state","isFullCredit":false},{"lineNumber":564,"author":{"gitId":"-"},"content":"   *","isFullCredit":false},{"lineNumber":565,"author":{"gitId":"-"},"content":"   * @returns {string[]}","isFullCredit":false},{"lineNumber":566,"author":{"gitId":"-"},"content":"   */","isFullCredit":false},{"lineNumber":567,"author":{"gitId":"-"},"content":"  public getTriggeredStateChangeActions(): string[] {","isFullCredit":false},{"lineNumber":568,"author":{"gitId":"-"},"content":"    return this.triggeredStateChangeActions;","isFullCredit":false},{"lineNumber":569,"author":{"gitId":"-"},"content":"  }","isFullCredit":false},{"lineNumber":570,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":571,"author":{"gitId":"CYX22222003"},"content":"  /**","isFullCredit":false},{"lineNumber":572,"author":{"gitId":"CYX22222003"},"content":"   * Return an array containing [string, number] pairs","isFullCredit":false},{"lineNumber":573,"author":{"gitId":"CYX22222003"},"content":"   * representing quizzes and the corresponding scores.","isFullCredit":false},{"lineNumber":574,"author":{"gitId":"CYX22222003"},"content":"   *","isFullCredit":false},{"lineNumber":575,"author":{"gitId":"CYX22222003"},"content":"   * @returns {[string, number][]}","isFullCredit":false},{"lineNumber":576,"author":{"gitId":"CYX22222003"},"content":"   */","isFullCredit":false},{"lineNumber":577,"author":{"gitId":"CYX22222003"},"content":"  public getQuizScores(): [string, number][] {","isFullCredit":false},{"lineNumber":578,"author":{"gitId":"CYX22222003"},"content":"    return [...this.quizScores];","isFullCredit":false},{"lineNumber":579,"author":{"gitId":"CYX22222003"},"content":"  }","isFullCredit":false},{"lineNumber":580,"author":{"gitId":"CYX22222003"},"content":"","isFullCredit":false},{"lineNumber":581,"author":{"gitId":"-"},"content":"  public getGameMap \u003d () \u003d\u003e this.gameMap;","isFullCredit":false},{"lineNumber":582,"author":{"gitId":"-"},"content":"  public getCharacterAtId \u003d (id: ItemId) \u003d\u003e mandatory(this.gameMap.getCharacterMap().get(id));","isFullCredit":false},{"lineNumber":583,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":584,"author":{"gitId":"-"},"content":"  private getSaveManager \u003d () \u003d\u003e SourceAcademyGame.getInstance().getSaveManager();","isFullCredit":false},{"lineNumber":585,"author":{"gitId":"-"},"content":"  public getChapterNewlyCompleted \u003d () \u003d\u003e this.chapterNewlyCompleted;","isFullCredit":false},{"lineNumber":586,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":587,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":588,"author":{"gitId":"-"},"content":"export default GameStateManager;","isFullCredit":false}],"authorContributionMap":{"CYX22222003":60,"-":528}},{"path":"src/features/game/state/GameStateTypes.ts","fileType":"ts","lines":[{"lineNumber":1,"author":{"gitId":"-"},"content":"import { ItemId } from \u0027../commons/CommonTypes\u0027;","isFullCredit":false},{"lineNumber":2,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":3,"author":{"gitId":"-"},"content":"export enum GameStateStorage {","isFullCredit":false},{"lineNumber":4,"author":{"gitId":"-"},"content":"  UserState \u003d \u0027UserState\u0027,","isFullCredit":false},{"lineNumber":5,"author":{"gitId":"-"},"content":"  ChecklistState \u003d \u0027ChecklistState\u0027,","isFullCredit":false},{"lineNumber":6,"author":{"gitId":"CYX22222003"},"content":"  TasklistState \u003d \u0027TasklistState\u0027,","isFullCredit":false},{"lineNumber":7,"author":{"gitId":"CYX22222003"},"content":"  AttemptedQuizState \u003d \u0027AttemptedQuizState\u0027,","isFullCredit":false},{"lineNumber":8,"author":{"gitId":"CYX22222003"},"content":"  PassedQuizState \u003d \u0027PassedQuizState\u0027,","isFullCredit":false},{"lineNumber":9,"author":{"gitId":"CYX22222003"},"content":"  QuizScoreState \u003d \u0027QuizScoreState\u0027","isFullCredit":false},{"lineNumber":10,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":11,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":12,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":13,"author":{"gitId":"-"},"content":" * Type of user state list.","isFullCredit":false},{"lineNumber":14,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":15,"author":{"gitId":"-"},"content":"export enum UserStateType {","isFullCredit":false},{"lineNumber":16,"author":{"gitId":"-"},"content":"  collectibles \u003d \u0027collectibles\u0027,","isFullCredit":false},{"lineNumber":17,"author":{"gitId":"-"},"content":"  assessments \u003d \u0027assessments\u0027,","isFullCredit":false},{"lineNumber":18,"author":{"gitId":"-"},"content":"  achievements \u003d \u0027achievements\u0027","isFullCredit":false},{"lineNumber":19,"author":{"gitId":"-"},"content":"}","isFullCredit":false},{"lineNumber":20,"author":{"gitId":"-"},"content":"","isFullCredit":false},{"lineNumber":21,"author":{"gitId":"-"},"content":"/**","isFullCredit":false},{"lineNumber":22,"author":{"gitId":"-"},"content":" * State observer is a renderer that can reflect the changes","isFullCredit":false},{"lineNumber":23,"author":{"gitId":"-"},"content":" * to the current scene","isFullCredit":false},{"lineNumber":24,"author":{"gitId":"-"},"content":" */","isFullCredit":false},{"lineNumber":25,"author":{"gitId":"-"},"content":"export interface StateObserver {","isFullCredit":false},{"lineNumber":26,"author":{"gitId":"-"},"content":"  handleAdd: (itemId: ItemId) \u003d\u003e boolean;","isFullCredit":false},{"lineNumber":27,"author":{"gitId":"-"},"content":"  handleDelete: (itemId: ItemId) \u003d\u003e boolean;","isFullCredit":false},{"lineNumber":28,"author":{"gitId":"-"},"content":"  handleMutate: (itemId: ItemId) \u003d\u003e boolean;","isFullCredit":false},{"lineNumber":29,"author":{"gitId":"-"},"content":"}","isFullCredit":false}],"authorContributionMap":{"CYX22222003":4,"-":25}},{"path":"public/assets/alien_and_cows.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/assets/alien_league.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/assets/pixel.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/assets/zekton.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/assets/zekton_dark.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/icons/android-chrome-192x192.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/icons/android-chrome-256x256.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/icons/apple-touch-icon.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/icons/favicon.ico","fileType":"ico","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"public/icons/maskable.png","fileType":"png","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"src/assets/SA.jpg","fileType":"jpg","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"src/assets/academy_background.jpg","fileType":"jpg","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"src/assets/default_cover_image.jpg","fileType":"jpg","isBinary":true,"lines":[],"authorContributionMap":{"-":0}},{"path":"src/assets/login_background.jpg","fileType":"jpg","isBinary":true,"lines":[],"authorContributionMap":{"-":0}}]
